"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function Workbook(t,e){this.workbook=e||{},this.boxId=t,this.container=document.querySelector("#"+this.boxId),this.container.className="clearfix",this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.boxId+"Canvas"),this.canvas.innerText="检测到您的浏览器版本过低,请升级您的浏览器,以获取更好的体验效果...",this.container.appendChild(this.canvas),this.paddingL=parseInt(this.getStyle(this.container,"paddingLeft")),this.paddingT=parseInt(this.getStyle(this.container,"paddingTop")),this.ctx=this.canvas.getContext("2d"),this.ratio=this.getPixelRatio(),this.scrollbarWidth=this.getScrollBarWidth(),this.totalHeight=0,this.totalWidth=0,this.startTabW=100,this.sheetItemExtraW=10,this.tabArrowPadding=15,this.scrollVMinHeight=30,this.scrollHMinWidth=30,this.startSheet=0,this.endSheet=0,this._tabsHeight=20,this.oncellbuttonclick=null,this.onshoweditor=null,this.ownerdraw=null,this.onclickcellopenlayer=null,this.onopenpopup=null,this.onvaluechange=null,this.onrelevantchange=null,this.onopenmorelist=null,this.onformularesult=null,this.onrowmodedblclick=null,this.onenteraddrow=null,this.onafteraddrow=null,this.onequalsign=null,this.documentHandle=null,this.formatBrushStyle={},this.isHArrow=!1,this.isVArrow=!1,this.percentageV=1,this.percentageH=1,this.tempValue={},this.scrollVLeft=0,this.eButton=0,this.horizontalLine=0,this.verticalLine=0,this.isShowBar=!1,this.drawOne=!0,this.tabSumW=0,this.diffTabsH=0,this.spansRowCount=1,this.spansColCount=1,this.keyDownCount=!0,this.btnArr=[],this.checkBoxBtn=[],this.arrowOne=!0,this.incanvasPath=!0,this.addHeight=0,this.defaultOptions=this.defaultBook(),this.initWorkbook(),this._defaultCellStyle=this.defaultCell(),this.container.style.position="relative",this.container.style.width=this.width+"px",this.container.style.height=this.height+"px",this.activeSheet=this.getActiveSheet(this.workbook.activeSheet),this.popup=window.top.popup?window.top.popup:window.Popup?new Popup:null,this.init(),window.boxId=this.boxId}Workbook.prototype.init=function(){this.contextMenu(),this.getStartSheet(),this.getEndSheet(),this.initTextArea(),this.bindEvent()},Workbook.prototype.defaultBook=function(){return{activeSheet:0,allowDelete:!0,allowResize:!0,allowTabs:!0,showTabs:0,defaultFontName:"宋体",defaultFontSize:14,defaultLineHeight:20,width:window.innerWidth-this.scrollbarWidth,height:window.innerHeight-this.scrollbarWidth,showHScrollBar:1,showVScrollBar:1,behaviorMode:1,scrollMode:2,devScreenWidth:1280,devScreenHeight:720,adaption:!1,showWorkBookBorder:!0,workBookBorderColor:"#ccc",showRowArrow:!1,rowArrowColor:"#000",print:1,printOnSamePaper:!1,printer:"undefined",marginCopies:0,tabsOptions:{fontColor:"#444",font:"14px/20px 宋体",fontSelColor:"#CD853F",selFillColor:"#fff",borderColor:"#DCDCDC",fillColor:"#FFF",showAdd:!0},stopPaintedCount:1,stopEventCount:0,showContextMenu:!1,sheetList:["Sheet1"],sheets:{Sheet1:{sheetName:"Sheet1",activeRow:0,activeCol:0,rangeCol1:0,rangeRow1:0,rangeCol2:0,rangeRow2:0,allowMoveRange:!0,selectMode:0,selHdrTopLeft:!1,startCol:0,startRow:0,endCol:0,endRow:0,showFixedLine:!1,showGridLines:!0,alwaysShowButton:!0,alwaysShowInArea:!0,headeNotLineInFix:!1,canOpenLayer:!0,gridLinesColor:"#ccc",printSetting:{printHeadings:!1,printGridLine:!1,printDirection:1,paper:"A4",orientation:1,isshowfooterpageinfo:0,footpagestyle:"第 &p 页，共 &P 页",printArea:{r1:"",c1:"",r2:"",c2:""},marginTop:5,marginBottom:5,marginLeft:5,marginRight:5},cellPadding:{left:2,right:2,top:2,bottom:2},isSelectionHideBorder:!1,rows:[],columns:[],spans:[],data:{dataTable:{}},fixed:{fixedRow:0,fixedCol:0,fixedRows:0,fixedCols:0,fixedH:0,fixedW:0,hideH:0,hideW:0},rowStyle:{color:"rgb(255,255,224)",oddEven:0,start:0},selectOption:{selectBorderColor:"green",selectFillColor:"rgba(0,0,245,0.1)"},scrollOption:{coordY:0,totalY:0,coordX:0,totalX:0,offsetX:0,offsetY:0},rowHeaderData:{defaultDataNode:{style:{themeFont:"Body",fontColor:"#fff",fillColor:"#008844"}},showRowHeading:!1,defaultW:30},colHeaderData:{defaultDataNode:{style:{themeFont:"Body",fontColor:"#fff",fillColor:"#008844"}},showColHeading:!1,defaultH:30},defaults:{colWidth:60,rowHeight:30}}}}},Workbook.prototype.defaultCell=function(){return{fontColor:"#000",hAlign:1,cellType:{name:0},lock:!1,vAlign:2,formatter:"",font:this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName,wordWrap:!1}},Workbook.prototype.initWorkbook=function(){var t=JSON.parse(JSON.stringify(this.defaultOptions));this.addWorkBookAttr(t,this.workbook),this.addWorkBookAttr(t.tabsOptions,this.workbook.tabsOptions);var e=Object.keys(this.workbook.sheets);this.workbook.sheetList=e;for(var o=0;o<e.length;o++)this.initSheet(e[o],o);return this.workbook},Workbook.prototype.initSheet=function(t,e){var o=JSON.parse(JSON.stringify(this.defaultOptions.sheets.Sheet1)),i=this.workbook.sheets[t],r=this;this.addWorkBookAttr(o,i),i.sheetName=t;var s=["cellPadding","printSetting","printSetting.printArea","data","fixed","selectOption","scrollOption","rowHeaderData","rowHeaderData.defaultDataNode","rowHeaderData.defaultDataNode.style","colHeaderData","colHeaderData.defaultDataNode","colHeaderData.defaultDataNode.style","defaults"];!function t(e){e<s.length&&(r.addWorkBookAttr(o[s[e]],i[s[e]]),t(++e))}(0),i.spans.forEach(function(t){t.row==i.rangeRow1&&t.col==i.rangeCol1&&(i.rangeRow2=t.row+t.rowCount-1,i.rangeCol2=t.col+t.colCount-1)});for(var a=0;a<i.columns.length;a++)this.setNoDefaultW(a,e);for(var n=0;n<i.rows.length;n++)this.setNoDefaultH(n,e);return i},Workbook.prototype.addWorkBookAttr=function(t,e){for(var o in t)!0===t.hasOwnProperty(o)&&!1===e.hasOwnProperty(o)&&(e[o]=t[o])},Workbook.prototype.bindEvent=function(){var a=document.querySelector("#"+this.boxId+" div[menu=contextmenu]"),t=document.querySelector("#"+this.boxId+" .addrow"),e=document.querySelector("#"+this.boxId+" .addcol"),o=document.querySelector("#"+this.boxId+" .delrow"),i=document.querySelector("#"+this.boxId+" .delcol"),r=document.querySelector("#"+this.boxId+" .leftAlign"),s=document.querySelector("#"+this.boxId+" .centerAlign"),n=document.querySelector("#"+this.boxId+" .rightAlign"),h=document.querySelector("#"+this.boxId+" .topAlign"),l=document.querySelector("#"+this.boxId+" .middleAlign"),c=document.querySelector("#"+this.boxId+" .bottomAlign"),d=document.querySelector("#"+this.boxId+" .copy"),g=document.querySelector("#"+this.boxId+" .cut"),p=document.querySelector("#"+this.boxId+" .child"),f=document.querySelector("#"+this.boxId+" .paste"),B=!1,O=!1,N=!1,E=!1,F=!1,L=!1,I=0,D=0,m=0,x=0,P=0,z=0;for(var u in this.addEvent(this.canvas,"mousewheel",this.throttle(this.scrollFun.bind(this),150,200)),this.addEvent(this.canvas,"DOMMouseScroll",this.throttle(this.scrollFun.bind(this),150,200)),this.addEvent(this.canvas,"mousedown",function(t){t=t||window.event;var e,o,i=this.getMousePos(this.canvas,t),r=i.x,s=i.y,a=this.workbook.activeSheet,n=this.workbook.showTabs,h=this.workbook.tabsOptions.showAdd,l=this.workbook.sheetList,c=this.isClickVBar(r,s),d=this.isClickHBar(r,s),g=this.getCellRC(),p="vertical",f=this.getTabArrowX(),u=f.firstX,b=f.previousX,w=f.latterX,k=f.lastX,v=this.tabArrowWidth,m=this.activeSheet.canOpenLayer,x=this.isClickCell(r,s);I=r,D=s,this.eButton=t.button,this.incanvasPath=!0,window.boxId=this.boxId,r>this.tabSumW+10&&r<this.tabSumW+20&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&h&&(this.addSheet(),this.startPaint(!0));var y=this.startTabW;this.ctx.font=this.workbook.tabsOptions.font;for(var S=this.startSheet;S<l.length;S++){var C=this.ctx.measureText(l[S]).width+this.sheetItemExtraW;y<r&&r<y+C&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&(this.sheetIndex(S),this.startPaint(!0)),y+=C}B=!!c,O=!!d,x&&(o=this.getActiveCell(r,s),P=o.r,z=o.c,2==t.button&&P>=g.r1&&P<=g.r2&&z>=g.c1&&z<=g.c2||(N=!0),L=!(!this.isHArrow&&!this.isVArrow)),this.isHArrow&&this.workbook.allowResize&&(F=!0,p="vertical",this.createLine(p)),this.isVArrow&&this.workbook.allowResize&&(p="horizontal",E=!0,this.createLine(p)),u-3<r&&r<u+v+3&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&(this.startSheet=0,this.getEndSheet(),this.drawTabs()),b-3<r&&r<b+v+3&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&1<=this.startSheet&&(this.startSheet--,this.getEndSheet(),this.drawTabs()),w-3<r&&r<w+v+3&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&this.endSheet<l.length-1&&(this.endSheet++,this.getStartSheet(),this.drawTabs()),k-3<r&&r<k+v+3&&s>this.height-this.tabsHeight&&s<this.height&&1==n&&(this.endSheet=l.length-1,this.getStartSheet(),this.drawTabs());var H=this.oncellbuttonclick,W=!1,A=this.getCellType(P,z,P,z,a);A&&(e=A.name),1!=e&&2!=e||0!=t.button||(W=this.isClickBtn(P,z,r,s),"function"==typeof H&&0==this.workbook.stopEventCount&&W&&H(a,P,z)),x&&0==t.button&&-1!=P&&-1!=z&&4==e&&this.openPopup(P,z,a);var T=this.onclickcellopenlayer;if("function"==typeof T&&0==this.workbook.stopEventCount&&m&&x&&0==t.button&&3!=e&&4!=e&&!W&&T(a,P,z),3==e&&0==t.button&&-1!=P&&-1!=z){var R=this.getValue(P,z)?0:1;this.setValue(P,z,R)}}.bind(this)),this.addEvent(this.canvas,"mouseup",this.openContextMenu.bind(this)),this.addEvent(this.canvas,"dblclick",function(t){t=t||window.event;var e,o=this.activeSheet.activeRow,i=this.activeSheet.activeCol,r=this.activeSheet.selectMode,s=this.workbook.behaviorMode,a=(this.workbook.activeSheet,this.getCellType(o,i,o,i)),n=this.getLock(o,i,o,i),h=this.getCanEdit(o,i,o,i),l=this.onrowmodedblclick;a&&(e=a.name),!1===h||n||(this.isEdit=!0),1==s&&this.isEdit&&(1!=e&&2!=e||this.activeSheet.alwaysShowButton?this.openInput(o,i):this.startPaint()),1!=e&&2!=e||this.isClickBtn(o,i,I,D),"function"==typeof l&&0==this.workbook.stopEventCount&&1==r&&t.button}.bind(this)),this.documentHandle={mousedown:function(t){t=t||window.event;var e=this.getMousePos(this.canvas,t),o=e.x,i=e.y;if(a&&(a.className="hidden"),(o<0||o>this.horizontalLine||i<0||i>this.verticalLine)&&0<=this.tempValue.r&&0<=this.tempValue.c){var r=document.querySelector("#"+this.boxId+" .child").innerText,s=this.getValue(this.activeSheet.activeRow,this.activeSheet.activeCol);this.removeTextArea(),r!=s&&""!=r&&this.startPaint()}(o<0||o>this.width||i<0||i>this.height)&&(this.incanvasPath=!1)}.bind(this),mousemove:function(t){t=t||window.event;var e,o,s=this,i=this.canvas.getBoundingClientRect(),a=t.clientX-i.left,n=t.clientY-i.top;if(x=n,(m=a)<this.width&&n<this.height&&this.drawOne&&0<a&&0<n)this.drawOne=!1,e=this.isHasVBar(),o=this.isHasHBar(),(e||o)&&(this.isShowBar=!0,this.startPaint(!0));else if((a>this.width||n>this.height||a<0||n<0)&&!this.drawOne&&!O&&!B&&(this.drawOne=!0,e=this.isHasVBar(),o=this.isHasHBar(),e||o)){this.isShowBar=!1;var r=null;clearTimeout(r),r=setTimeout(function(){s.startPaint(!0)},1500)}0<a&&a<this.width&&0<n&&n<this.numRowH&&0<this.numRowH||0<a&&a<this.numColW&&0<n&&n<this.height&&0<this.numRowH?(this.showArrow(a,n),this.arrowOne=!0):this.arrowOne&&(this.isHArrow=!1,this.isVArrow=!1,this.canvas.style.cursor="default",this.arrowOne=!1),F&&this.workbook.allowResize&&this.changeCellWidth(F,I,a),E&&this.workbook.allowResize&&this.changeCellHeight(E,D,n),B&&this.isShowBar&&this.dragVBar(B,D,x),O&&this.isShowBar&&this.dragHBar(O,I,m),N&&!L&&this.getSelection(m,x,N);var h=this.cellBtnAreaWidth,l=!0,c=this.workbook.behaviorMode,d=this.activeSheet.startRow,g=this.activeSheet.startCol,p=this.activeSheet.fixed.fixedH,f=this.activeSheet.fixed.fixedW,u=this.activeSheet.rangeRow1,b=this.activeSheet.rangeRow2,w=this.activeSheet.rangeCol1,k=this.activeSheet.rangeCol2,v=this.activeSheet.selectMode;this.activeSheet.spans.forEach(function(t){w==t.col&&u==t.row&&k<t.col+t.colCount&&b<t.row+t.rowCount&&(l=!1)}),this.btnArr.forEach(function(t){var e=t.x+t.w-h,o=t.w+t.x,i=t.y,r=t.y+t.h;!(e<a&&a<o&&i<n&&n<r&&r<s.height-s.tabsHeight)||t.row==d&&i<p+s.numRowH||t.col==g&&e<f+s.numColW?!0===t.hover&&(t.hover=!1,1!=c||1!=v&&2!=v&&(u==b&&w==k||!l)?s.drawBtn(t.row,t.col,t.x,t.y,t.w,t.h,t.hover):s.startPaint(!0)):!1===t.hover&&(t.hover=!0,s.drawBtn(t.row,t.col,t.x,t.y,t.w,t.h,t.hover))}),this.checkBoxBtn.forEach(function(t){var e=t.x+t.w/2-s.checkBoxW/2,o=s.checkBoxW+t.x+t.w/2-s.checkBoxW/2,i=t.y+t.h/2-s.checkBoxH/2,r=t.y+t.h/2-s.checkBoxH/2+s.checkBoxH;!(e<a&&a<o&&i<n&&n<r&&r<s.height-s.tabsHeight)||t.row==d&&i<p+s.numRowH||t.col==g&&e<f+s.numColW?!0===t.hover&&(t.hover=!1,1!=c||1!=v&&2!=v&&(u==b&&w==k||!l)?s.drawCheckBox(t.row,t.col,t.x,t.y,t.w,t.h,t.hover):s.startPaint(!0)):!1===t.hover&&(t.hover=!0,s.drawCheckBox(t.row,t.col,t.x,t.y,t.w,t.h,t.hover))})}.bind(this),mouseup:function(t){t=t||window.event,B&&this.isShowBar&&(B=!1,this.dragVBar(B,D,x)),O&&this.isShowBar&&(O=!1,this.dragHBar(O,I,m)),N&&!L&&(N=!1,this.getSelection(m,x,N)),F&&this.workbook.allowResize&&(F=!1,this.changeCellWidth(F,I,m)),E&&this.workbook.allowResize&&(E=!1,this.changeCellHeight(E,D,x))}.bind(this),contextmenu:function(t){this.workbook.showContextMenu&&(t=t||window.event,this.stopDefault(t))}.bind(this),keydown:function(t){if(window.boxId==this.boxId){t=t||window.event;var e,o=this.activeSheet.rangeRow1,i=this.activeSheet.rangeCol1,r=this.workbook.behaviorMode,s=this.activeSheet.rangeRow2,a=this.activeSheet.rangeCol2,n=this.getCellType(o,i,o,i),h=this.getCanEdit(P,z,P,z),l=this.activeSheet.data.dataTable;if(n&&(e=n.name),9==t.keyCode&&this.workbook.allowTabs&&this.stopDefault(t),this.incanvasPath){if(1!=r||(13==t.keyCode||37==t.keyCode||38==t.keyCode||39==t.keyCode||40==t.keyCode||46==t.keyCode||t.ctrlKey||9==t.keyCode||91==t.keyCode||18==t.keyCode||20==t.keyCode||27==t.keyCode||18==t.keyCode||16==t.keyCode||45==t.keyCode||255==t.keyCode||112<=t.keyCode&&t.keyCode<=123)||-1==o||-1==i)this.keyDownCount=!0;else if(this.keyDownCount&&!this.isEdit)this.clearText(o,i),void 0!==this.getCellFormula(o,i)&&(l[o][i].formula=""),!1!==h&&(this.isEdit=!0),this.keyDownCount=!1,1!=e&&2!=e||this.activeSheet.alwaysShowButton?this.openInput(o,i):this.startPaint();46==t.keyCode&&!this.isEdit&&this.workbook.allowDelete&&(this.deleteText(o,i,s,a),this.startPaint(!0)),(13==t.keyCode||37==t.keyCode||38==t.keyCode||39==t.keyCode||40==t.keyCode||9==t.keyCode&&this.workbook.allowTabs)&&(t.altKey&&13==t.keyCode||(this.isEdit||this.stopDefault(t),this.popup&&this.popup.closeAll(),this.swapCell())),t.ctrlKey&&67==t.keyCode&&this.editCopy(),t.ctrlKey&&88==t.keyCode&&this.editCut(),t.ctrlKey&&86==t.keyCode&&(this.editPaste(),this.startPaint(!0)),t.altKey&&13==t.keyCode&&this.insertN(),27==t.keyCode&&(this.tempValue={},this.removeTextArea())}}}.bind(this)},this.documentHandle)this.addEvent(this.document,u,this.documentHandle[u]);this.addEvent(p,"mouseup",function(){var t=window.getSelection?window.getSelection():document.selection.createRange().text();this.clipBoardTxt=t.toString()}.bind(this)),this.addEvent(p,"keydown",function(t){var e=this;setTimeout(function(){"function"==typeof e.onequalsign&&"="==p.innerText&&e.onequalsign(e.activeSheet.activeRow,e.activeSheet.activeCol)},0)}.bind(this)),this.addEvent(t,"mousedown",function(t){0==(t=t||window.event).button&&(this.editInsert("F1ShiftRows"),this.startPaint(!0))}.bind(this)),this.addEvent(e,"mousedown",function(t){0==(t=t||window.event).button&&(this.editInsert("F1ShiftCols"),this.startPaint(!0))}.bind(this)),this.addEvent(o,"mousedown",function(t){0==(t=t||window.event).button&&(this.editDelete("F1ShiftRows"),this.startPaint(!0))}.bind(this)),this.addEvent(i,"mousedown",function(t){0==(t=t||window.event).button&&(this.editDelete("F1ShiftCols"),this.startPaint(!0))}.bind(this)),this.addEvent(d,"mousedown",function(t){0==(t=t||window.event).button&&this.editCopy()}.bind(this)),this.addEvent(g,"mousedown",function(t){0==(t=t||window.event).button&&(this.editCut(),this.startPaint(!0))}.bind(this)),this.addEvent(f,"mousedown",function(t){0==(t=t||window.event).button&&(this.editPaste(),this.startPaint(!0))}.bind(this)),this.addEvent(r,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setHAlignment(e.r1,e.c1,e.r2,e.c2,2),this.startPaint(!0)}}.bind(this)),this.addEvent(s,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setHAlignment(e.r1,e.c1,e.r2,e.c2,3),this.startPaint(!0)}}.bind(this)),this.addEvent(n,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setHAlignment(e.r1,e.c1,e.r2,e.c2,4),this.startPaint(!0)}}.bind(this)),this.addEvent(h,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setVAlignment(e.r1,e.c1,e.r2,e.c2,1),this.startPaint(!0)}}.bind(this)),this.addEvent(l,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setVAlignment(e.r1,e.c1,e.r2,e.c2,2),this.startPaint(!0)}}.bind(this)),this.addEvent(c,"mousedown",function(t){if(0==(t=t||window.event).button){var e=this.getCellRC();this.setVAlignment(e.r1,e.c1,e.r2,e.c2,3),this.startPaint(!0)}}.bind(this))},Workbook.prototype.isClickVBar=function(t,e){var o=this.isHasVBar(),i=this.getScrollVInfo(),r=i.y1,s=i.y2,a=!1;return t<this.horizontalLine&&t>this.horizontalLine-this.scrollSize&&e<s&&r<e&&o&&this.isShowBar&&(a=!0),a},Workbook.prototype.isClickHBar=function(t,e){var o=this.isHasHBar(),i=this.getScrollHInfo(),r=i.x1,s=i.x2,a=!1;return r<t&&t<s&&e<this.verticalLine-this.diffTabsH&&e>this.verticalLine-this.scrollSize-this.diffTabsH&&o&&(a=!0),a},Workbook.prototype.isClickCell=function(t,e){var o=this.isClickVBar(t,e),i=this.isClickHBar(t,e),r=!1;return!o&&!i&&0<e&&e<this.verticalLine-this.diffTabsH&&t<this.horizontalLine&&0<t&&(r=!0),r},Workbook.prototype.isHasVBar=function(){var t=!1;return 1==this.workbook.showVScrollBar&&this.totalHeight+this.numRowH>this.height&&this.percentageV<1&&(t=!0),t},Workbook.prototype.isHasHBar=function(){var t=!1;return 1==this.workbook.showHScrollBar&&this.totalWidth+this.numColW>this.width&&this.percentageH<1&&(t=!0),t},Workbook.prototype.isClickBtn=function(t,e,o,i){var r,s=this.getCellType(t,e,t,e);if(s&&(r=s.name),(1==r||2==r)&&0==this.eButton){var a,n,h,l,c=this.getSelectInfo(t,e),d=this.getBtnAndCutX(t,e).cutX,g=this.activeSheet.alwaysShowButton,p=!1,f=this.cellBtnAreaWidth;a=c.c1w,n=c.r1h,h=c.selectY,(l=c.selectX)+a-f-d<o&&o<a+l-d&&h<i&&i<h+n&&(g||!g&&this.isEdit)&&(p=!0)}return p},Workbook.prototype.getScrollVInfo=function(){var t=2==this.workbook.scrollMode?this.activeSheet.fixed.fixedH:0,e=this.activeSheet.scrollOption.coordY,o=0,i=0;return(o=Math.floor((this.height-this.numRowH-t)*this.percentageV))<this.scrollVMinHeight&&(o=this.scrollVMinHeight),(i=e+this.numRowH+t+this.scrollSize/2)>this.height-this.tabsHeight-this.scrollVMinHeight&&(i=this.height-this.tabsHeight-this.scrollVMinHeight+this.scrollSize/2),{y1:i,y2:o+i-this.scrollSize,x1:this.horizontalLine-this.scrollSize+Math.floor(this.scrollSize/2)}},Workbook.prototype.getScrollHInfo=function(){var t=2==this.workbook.scrollMode?this.activeSheet.fixed.fixedW:0,e=this.activeSheet.scrollOption.coordX,o=0,i=0;return(o=Math.floor((this.width-this.numColW-t)*this.percentageH))<this.scrollHMinWidth&&(o=this.scrollHMinWidth),(i=e+this.numColW+t+this.scrollSize/2)>this.width-this.scrollHMinWidth&&(i=this.width-this.scrollHMinWidth+this.scrollSize/2),{x1:i,x2:o+i-this.scrollSize,y1:this.verticalLine-this.scrollSize+Math.floor(this.scrollSize/2)-this.diffTabsH}},Workbook.prototype.isSpanCell=function(e,o,i,r,t){var s=0<=t?t:this.workbook.activeSheet,a=this.getActiveSheet(s).spans,n=!1;return a.forEach(function(t){e>=t.row&&e<t.row+t.rowCount&&i>=t.row&&i<t.row+t.rowCount&&o>=t.col&&o<t.col+t.colCount&&r>=t.col&&r<t.col+t.colCount&&(n=!0)}),n},Workbook.prototype.getMousePos=function(t,e){var o=t.getBoundingClientRect();return{x:e.clientX-o.left,y:e.clientY-o.top}},Workbook.prototype.drawTable=function(){if(0===this.workbook.stopPaintedCount){var e=this.getActiveSheet(),t=e.rows,o=e.columns;this.totalWidth=0,this.totalHeight=0,this.workbook.width=this.width,this.workbook.height=this.height,this.btnArr=[],this.checkBoxBtn=[],this.canvas.style.width=this.width+"px",this.canvas.style.height=this.height+"px",this.canvas.width=this.width*this.ratio,this.canvas.height=this.height*this.ratio,this.ctx.scale(this.ratio,this.ratio),this.canvas.style.border=this.workbook.showWorkBookBorder?"1px solid "+this.workbook.workBookBorderColor:"1px solid transparent";var i=this.getTotalAndPercent();this.totalHeight=i.totalHeight,this.totalWidth=i.totalWidth,this.percentageV=i.percentageV,this.percentageH=i.percentageH,this.getStartAndEnd();var r=e.startRow,s=e.startCol,a=e.endRow,n=e.endCol,h=e.fixed.fixedRow,l=e.fixed.fixedCol,c=e.fixed.fixedRows,d=e.fixed.fixedCols,g=e.fixed.fixedH,p=e.fixed.fixedW,f=e.activeRow,u=e.activeCol,b=this.workbook.behaviorMode,w=e.showGridLines,k=e.gridLinesColor,v=e.spans;e.selHdrTopLeft&&(e.activeRow=-1,e.activeCol=-1,e.rangeRow1=-1,e.rangeCol1=-1,e.rangeRow2=t.length-1,e.rangeCol2=o.length-1),v.forEach(function(t){t.row==f&&t.col==u&&(e.rangeRow2=t.row+t.rowCount-1,e.rangeCol2=t.col+t.colCount-1)}),this.horizontalLine=i.horizontalLine,this.verticalLine=i.verticalLine,this.scrollVLeft=i.scrollVLeft,2==b&&(e.cellPadding.left||(e.cellPadding.left=5),e.cellPadding.right||(e.cellPadding.right=5),e.cellPadding.top||(e.cellPadding.top=5),e.cellPadding.bottom||(e.cellPadding.bottom=5));var m=this.getCellStatus(f,u).cellTypeName;4!=m&&3!=m||this.setCanEdit(f,u,f,u,!1),2!=b&&3!=b||(this.isEdit=!0),this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#FFF",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore(),this.drawBgFill(1),this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=k,0<c&&(this.ctx.moveTo(this.numColW+p,this.numRowH+g),this.ctx.lineTo(this.horizontalLine,this.numRowH+g),this.ctx.stroke()),0<d&&(this.ctx.moveTo(this.numColW+p,this.numRowH+g),this.ctx.lineTo(this.numColW+p,this.verticalLine),this.ctx.stroke()),this.ctx.restore(),w&&this.drawLine(r,s,a,n),this.drawSpans(r,s,a,n),this.drawCellContent(r,s,a,n),0<d&&(this.drawBgFill(2),this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=k,0<c&&(this.ctx.moveTo(this.numColW,this.numRowH+g),this.ctx.lineTo(this.numColW+p,this.numRowH+g),this.ctx.stroke()),0<d&&!e.headeNotLineInFix&&(this.ctx.moveTo(this.numColW+p,this.numRowH),this.ctx.lineTo(this.numColW+p,this.numRowH+g),this.ctx.stroke()),this.ctx.restore(),w&&this.drawLine(r,l,a,d-1),this.drawSpans(r,l,a,d-1),this.drawCellContent(r,l,a,d-1)),0<c&&(this.drawBgFill(3),w&&this.drawLine(h,s,c-1,n),this.drawSpans(h,s,c-1,n),this.drawCellContent(h,s,c-1,n)),0<d&&0<c&&(this.drawBgFill(4),w&&this.drawLine(h,l,c-1,d-1),this.drawSpans(h,l,c-1,d-1),this.drawCellContent(h,l,c-1,d-1)),this.drawLeftLine(),this.drawTopLine(),this.drawSelectBox(),e.rowHeaderData.showRowHeading&&(this.drawRowHeader(r,a),0<c&&this.drawRowHeader(h,c-1)),this.workbook.showRowArrow&&this.drawRowArrow(),e.colHeaderData.showColHeading&&(this.drawColHeader(s,n),0<d&&this.drawColHeader(l,d-1)),e.rowHeaderData.showRowHeading&&e.colHeaderData.showColHeading&&(1<=t.length||1<=o.length)&&this.drawTriangle(e.colHeaderData.defaultDataNode.style.fillColor,k),this.drawFixLine(c,d,g,p,e.showFixedLine),this.drawTabs(),this.openInput(f,u),this.scrollV(),this.scrollH()}},Workbook.prototype.openInput=function(t,e){var o=this.getBtnAndCutX(t,e),i=this.getCellStatus(t,e),r=this.getSelectInfo(t,e),s=this.workbook.behaviorMode,a=this.activeSheet,n=a.rows,h=a.columns,l=o.disBtn,c=o.cutX,d=i.isCheckBox,g=i.isCanEdit,p=i.isLock;2!=s&&3!=s||(this.isEdit=!0),-1!=t&&-1!=e&&!d&&!1!==g&&!p&&this.isEdit&&0==this.eButton&&1<=n.length&&1<=h.length&&window.boxId==this.boxId&&this.incanvasPath&&this.setCanvasInput(r.c1w-l-2-c,r.r1h-2,r.selectY+2+this.paddingT,r.selectX+2+this.paddingL,t,e)},Workbook.prototype.getCellStatus=function(t,e,o){var i,r=0<=o?o:this.workbook.activeSheet,s=!1,a=!0,n=!1;if(0<=t&&0<=e){var h=this.getCellType(t,e,t,e,r);h&&(3==h.name&&(s=!0),i=h.name),a=this.getCanEdit(t,e,t,e,r),n=this.getLock(t,e,t,e,r)}return{isCheckBox:s,isCanEdit:a,isLock:n,cellTypeName:i}},Workbook.prototype.getBtnAndCutX=function(t,e,o){var i,r=0<=o?o:this.workbook.activeSheet,s=0,a=0,n=this.getSelectInfo(t,e),h=n.selectX,l=n.c1w,c=this.getCellType(t,e,t,e,r),d=this.isHasHBar();return c&&(i=c.name),1!=i&&2!=i&&4!=i||(s=this.cellBtnAreaWidth,d&&this.isShowBar&&h+l>this.scrollVLeft&&h+l-this.cellBtnAreaWidth<this.horizontalLine&&(a=h+l-this.scrollVLeft)),{disBtn:s,cutX:a}},Workbook.prototype.getStartSheet=function(){var t=0;this.ctx.font=this.workbook.tabsOptions.font;for(var e=this.endSheet;0<=e;e--){if((t+=this.ctx.measureText(this.workbook.sheetList[e]).width+this.sheetItemExtraW)>this.width-300){this.startSheet=e;break}this.startSheet=0}return{startSheetName:this.workbook.sheetList[this.startSheet],i:this.startSheet}},Workbook.prototype.getEndSheet=function(){var t=0;this.endSheet=this.workbook.sheetList.length-1,this.ctx.font=this.workbook.tabsOptions.font;for(var e=this.startSheet;e<=this.workbook.sheetList.length-1;e++){if((t+=this.ctx.measureText(this.workbook.sheetList[e]).width+this.sheetItemExtraW)>this.width-300){this.endSheet=e;break}this.endSheet=this.workbook.sheetList.length-1}return{endSheetName:this.workbook.sheetList[this.endSheet],i:this.endSheet}},Workbook.prototype.getTotalAndPercent=function(t){this.getStartAndEnd();var e,o=0<=t?t:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.rows,s=i.columns,a=i.fixed.hideH,n=i.fixed.hideW,h=i.startRow,l=i.endRow,c=i.startCol,d=i.endCol,g=0,p=0,f=0,u=0,b=1,w=1,k=i.fixed.fixedW+this.numColW,v=i.fixed.fixedH+this.numRowH;2==this.workbook.scrollMode&&(g=i.fixed.fixedH,p=i.fixed.fixedW),r.forEach(function(t){t.bHidden&&!t.tempSize&&(t.tempSize=t.size),t.bHidden&&(t.size=0),f+=t.size}),s.forEach(function(t){t.bHidden&&!t.tempSize&&(t.tempSize=t.size),t.bHidden&&(t.size=0),u+=t.size});for(var m=c;m<=d;m++)s[m]&&(k+=s[m].size);for(var x=h;x<=l;x++)r[x]&&(v+=r[x].size);return k=k>this.width?this.width:k,v=v>this.height?this.height:v,e=k-this.scrollSize,v+this.addHeight<this.height-this.tabsHeight?this.diffTabsH=0:(this.diffTabsH=v-(this.height-this.tabsHeight),this.diffTabsH>this.tabsHeight&&(this.diffTabsH=this.tabsHeight)),b=(this.height-this.numRowH-g-this.tabsHeight)/(f-a-g),1<(w=(this.width-this.numColW-p)/(u-n-p))&&(w=1),1<b&&(b=1),w=w.toFixed(5)-0,b=b.toFixed(5)-0,{totalHeight:f,totalWidth:u,percentageV:b,percentageH:w,horizontalLine:k,verticalLine:v,scrollVLeft:e}},Workbook.prototype.drawTabs=function(){if(1==this.workbook.showTabs||2==this.workbook.showTabs)if(this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.workbook.tabsOptions.fillColor,this.ctx.fillRect(0,this.height-this.tabsHeight,this.width,this.tabsHeight),this.ctx.fill(),1==this.workbook.showTabs){var t=this.tabArrowHeight>this.tabsHeight?this.tabsHeight:this.tabArrowHeight,e=this.tabArrowWidth,o=this.getTabArrowX(),i=o.firstX,r=o.previousX,s=o.latterX,a=o.lastX;this.ctx.strokeStyle="#666",this.ctx.fillStyle="#666",this.ctx.moveTo(i,this.height-this.tabsHeight/2),this.ctx.lineTo(i+e,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(i+e,this.height-this.tabsHeight/2+t/2),this.ctx.closePath(),this.ctx.moveTo(i,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(i,this.height-this.tabsHeight/2+t/2),this.ctx.moveTo(r+e,this.height-this.tabsHeight/2),this.ctx.lineTo(r,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(r,this.height-this.tabsHeight/2+t/2),this.ctx.closePath(),this.ctx.moveTo(s+e,this.height-this.tabsHeight/2),this.ctx.lineTo(s,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(s,this.height-this.tabsHeight/2+t/2),this.ctx.closePath(),this.ctx.moveTo(a+e,this.height-this.tabsHeight/2),this.ctx.lineTo(a,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(a,this.height-this.tabsHeight/2+t/2),this.ctx.closePath(),this.ctx.moveTo(a+e,this.height-this.tabsHeight/2-t/2),this.ctx.lineTo(a+e,this.height-this.tabsHeight/2+t/2),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore(),this.startTabW=a+20,this.ctx.save(),this.ctx.beginPath();for(var n=this.startTabW,h=0,l=this.workbook.tabsOptions.fontColor,c=this.startSheet;c<=this.endSheet;c++){this.ctx.font=this.workbook.tabsOptions.font,h=this.ctx.measureText(this.workbook.sheetList[c]).width+this.sheetItemExtraW,this.ctx.strokeStyle=this.workbook.tabsOptions.borderColor,this.ctx.fillStyle=this.workbook.tabsOptions.selFillColor,this.ctx.textAlign="center",this.ctx.textBaseline="middle";var d=0;c!=this.workbook.activeSheet&&(d=3,this.ctx.moveTo(n,this.height-3),this.ctx.lineTo(n+h,this.height-3)),this.ctx.moveTo(n,this.height-this.tabsHeight+d),this.ctx.lineTo(n,this.height-3),this.ctx.moveTo(n+h,this.height-3),this.ctx.lineTo(n+h,this.height-this.tabsHeight+d),l=c==this.workbook.activeSheet?(this.ctx.fillRect(n,this.height-this.tabsHeight,h,this.tabsHeight-3),this.workbook.tabsOptions.fontSelColor):this.workbook.tabsOptions.fontColor,this.ctx.fillStyle=l,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(this.workbook.sheetList[c],n+h/2,this.height-this.tabsHeight/2-2),n+=h}this.ctx.stroke(),this.ctx.restore(),this.endSheet-this.startSheet+1<this.workbook.sheetList.length&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle="#000",this.ctx.moveTo(n+1,this.height-this.tabsHeight),this.ctx.lineTo(n+1,this.height-3),this.ctx.stroke(),this.ctx.restore()),this.workbook.tabsOptions.showAdd&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#666",this.ctx.lineWidth=2,this.ctx.moveTo(n+10,this.height-this.tabsHeight/2),this.ctx.lineTo(n+20,this.height-this.tabsHeight/2),this.ctx.moveTo(n+15,this.height-this.tabsHeight/2-5),this.ctx.lineTo(n+15,this.height-this.tabsHeight/2+5),this.ctx.stroke(),this.ctx.restore()),this.tabSumW=n}else if(2==this.workbook.showTabs&&1<=this.bottomBtn.length){var g=this.width/this.bottomBtn.length,p=-g,f=this.height-this.tabsHeight;for(c=0;c<this.bottomBtn.length;c++)p+=g,this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=this.workbook.tabsOptions.borderColor,this.ctx.moveTo(p,f),this.ctx.lineTo(p+g,f),c!=this.bottomBtn.length-1&&(this.ctx.moveTo(p+g,f),this.ctx.lineTo(p+g,f+this.tabsHeight)),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=this.workbook.tabsOptions.font,this.ctx.fillStyle=this.workbook.tabsOptions.fontColor,this.ctx.fillText(this.bottomBtn[c],p+g/2,f+this.tabsHeight/2),this.ctx.restore()}},Workbook.prototype.getTabArrowX=function(){var t,e,o,i=this.tabArrowWidth,r=this.tabArrowStartX,s=this.tabArrowPadding;return{firstX:t=r,previousX:e=t+i+s,latterX:o=e+i+s,lastX:o+i+s}},Workbook.prototype.drawRowArrow=function(t){if(this.workbook.showRowArrow){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.activeRow,r=o.activeCol,s=o.rows;if(o.rowHeaderData.showRowHeading){var a=this.getSelectInfo(i,r),n=a.selectY,h=s[i]?s[i].size:0,l=a.h;l<h&&(h=l),5<h&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.workbook.rowArrowColor,this.ctx.moveTo(0,n+h/2),this.ctx.lineTo(0,n+h/2+4),this.ctx.lineTo(6,n+h/2),this.ctx.lineTo(0,n+h/2-4),this.ctx.closePath(),this.ctx.fill())}}},Workbook.prototype.drawSelectBox=function(){var t=this.activeSheet,e=t.rangeRow1,o=t.rangeRow2,i=t.rangeCol1,r=t.rangeCol2,s=t.selectMode,a=t.notColSelectionNum,n=t.notRowSelectionNum,h=t.selectOption.selectBorderColor,l=t.selectOption.selectFillColor,c=t.spans,d=this.workbook.behaviorMode,g=this.getLock(e,i),p=this.getSelectInfo(e,i,o,r),f=p.h,u=p.w;if(!t.isSelectionHideBorder&&(1==d||3==d)&&0<p.h&&0<p.w||-1==e||-1==i){if(this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=.5,this.ctx.strokeStyle=h,this.ctx.fillStyle=l,1==s&&e!=n)this.ctx.rect(this.numColW,p.selectY,this.horizontalLine-this.numColW,f),this.ctx.fill();else if(2==s&&i!=a)this.ctx.rect(p.selectX,this.numRowH,u,this.verticalLine-this.numRowH),this.ctx.fill();else if(!((2==s||1==s)&&-1!=e&&-1!=i||g||e==n&&e==o||i==a&&i==r)){var b=!0;this.ctx.moveTo(p.selectX,p.selectY),this.ctx.lineTo(p.selectX,p.selectY+f),this.ctx.lineTo(p.selectX+u,p.selectY+f),this.ctx.lineTo(p.selectX+u,p.selectY),this.ctx.closePath(),c.forEach(function(t){i==t.col&&e==t.row&&r<t.col+t.colCount&&o<t.row+t.rowCount&&(b=!1)}),i==r&&e==o||!b||this.ctx.fill()}this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.drawTriangle=function(t,e){this.ctx.save(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.numColW,this.numRowH),this.ctx.beginPath(),this.ctx.fillStyle="#fff",this.ctx.moveTo(this.numColW-20,this.numRowH-3),this.ctx.lineTo(this.numColW-3,this.numRowH-3),this.ctx.lineTo(this.numColW-3,this.numRowH-20),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle=e,this.ctx.moveTo(0,this.numRowH),this.ctx.lineTo(this.numColW,this.numRowH),this.ctx.moveTo(this.numColW,0),this.ctx.lineTo(this.numColW,this.numRowH),this.ctx.stroke(),this.ctx.restore()},Workbook.prototype.drawFixLine=function(t,e,o,i,r){0<t&&r&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#3C3C3C",this.ctx.lineWidth=.5,this.ctx.moveTo(0,this.numRowH+o),this.ctx.lineTo(this.horizontalLine,this.numRowH+o),this.ctx.stroke(),this.ctx.restore()),0<e&&r&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#3C3C3C",this.ctx.moveTo(this.numColW+i,0),this.ctx.lineTo(this.numColW+i,this.verticalLine),this.ctx.stroke(),this.ctx.restore())},Workbook.prototype.drawRowHeader=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i);if(r.rowHeaderData.showRowHeading){var s=r.rowHeaderData.defaultDataNode.style.fillColor,a=r.rowHeaderData.defaultDataNode.style.fontColor,n=r.rows,h=t,l=r.fixed.fixedRows,c=r.scrollOption.offsetY,d=r.fixed.fixedH,g=r.rowHeaderData.defaultW,p=r.gridLinesColor,f=0<l&&h<l?0:d,u=0<l&&h<l?0:c,b=this.numRowH+f-u,w=0,k=0<l&&h<l?d+1:this.verticalLine-this.numRowH-d,v=0<l&&h<l?this.numRowH:this.numRowH+d;this.ctx.save(),this.ctx.beginPath(),this.ctx.font="14px Microsoft YaHei",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=s,this.ctx.fillRect(0,v,g,k),this.ctx.strokeStyle=p;for(var m=t;m<=e;m++)n[m]&&(n[m].bHidden||n[m].size<=0)||(n[m]&&(w+=n[m].size),1<n.length&&(this.ctx.moveTo(0,w+b),this.ctx.lineTo(g,w+b)),this.ctx.fillStyle=a,n[m]&&5<n[m].size&&(n[m].name?this.ctx.fillText(n[m].name,g/2,w+b-n[m].size/2):this.ctx.fillText(m+1,g/2,w+b-n[m].size/2)));this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.drawColHeader=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i);if(r.colHeaderData.showColHeading){var s=r.colHeaderData.defaultDataNode.style.fillColor,a=r.colHeaderData.defaultDataNode.style.fontColor,n=r.columns,h=t,l=r.fixed.fixedCols,c=r.startCol,d=r.scrollOption.offsetX,g=r.fixed.fixedW,p=r.colHeaderData.defaultH,f=r.colHeaderData.spans,u=r.gridLinesColor,b=0<l&&h<l?0:g,w=0<l&&h<l?0:d,k=this.numColW+b-w,v=0,m=0,x=0,y=0,S=0<l&&h<l?g+1:this.horizontalLine-this.numColW-g,C=0<l&&h<l?this.numColW:this.numColW+g,H="";this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.fillRect(C,0,S,p),this.ctx.font="14px Microsoft YaHei",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeStyle=u;for(var W=t;W<=e;W++)if(!n[W]||!(n[W].bHidden||n[W]<=0)){if(n[W]&&(v+=n[W].size),f&&0!=f.length)for(var A=0;A<f.length;A++)if(W>=f[A].col&&W<f[A].colCount+f[A].col-1&&(m=f[A].height,0<l&&W==l-1&&f[A].colCount+f[A].col-1<c&&(m=0)),W>=f[A].col&&W<f[A].colCount+f[A].col&&(x=f[A].height),W==f[A].col){H=f[A].name;var T=f[A].col,R=f[A].col+f[A].colCount-1,B=this.getSelectInfo(0,f[A].col,0,f[A].col).selectX}if(m>=this.numRowH&&(m=this.numRowH),m<=0&&(m=0),x>=this.numRowH&&(x=this.numRowH),x<=0&&(x=0),this.ctx.beginPath(),1<=n.length&&(this.ctx.moveTo(k+v,0+m),this.ctx.lineTo(k+v,p)),this.ctx.stroke(),0<x&&x<this.numRowH&&n[W]&&(this.ctx.beginPath(),this.ctx.moveTo(k+v,x),this.ctx.lineTo(k+v-n[W].size,x),this.ctx.stroke()),H){this.ctx.beginPath(),this.ctx.fillStyle=a;for(var O=T;O<=R;O++)y+=this.getSelectInfo(0,O,0,O).w;this.ctx.fillText(H,B+y/2,x/2)}if(this.ctx.beginPath(),this.ctx.fillStyle=a,n[W]&&5<n[W].size){var N=this.num2ExcelLetter(W+1);n[W].name&&0<=x&&x<this.numRowH?this.ctx.fillText(n[W].name,v+k-n[W].size/2,(p-x)/2+x):!n[W].name&&0<=x&&x<this.numRowH&&this.ctx.fillText(N,v+k-n[W].size/2,(p-x)/2+x)}N=H="",y=x=m=0}this.ctx.restore()}},Workbook.prototype.drawLine=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s);if(a.showGridLines){var n=a.rows,h=a.columns,l=a.headeNotLineInFix,c=a.fixed.fixedRow,d=a.fixed.fixedRows,g=a.fixed.fixedCols,p=a.fixed.fixedH,f=a.fixed.fixedW,u=a.scrollOption.offsetX,b=a.scrollOption.offsetY,w=a.gridLinesColor,k=a.spans,v=t,m=0,x=0,y=0<d&&v<d?0:p,S=0<g&&e<g?0:f,C=0<d&&v<d?0:b,H=0<g&&e<g?0:u,W=0<g&&e<g?f+this.numColW:this.horizontalLine,A=0<d&&v<d?p+this.numRowH:this.verticalLine,T=this.numColW+S-H,R=this.numRowH+y-C,B=0,O=0,N=this.numColW+S,E=this.numRowH+y;if(l&&v<d&&0<d){m=d-1,k.forEach(function(t){m>=t.row&&m<t.rowCount+t.row&&(m=t.row)});for(var F=c;F<m;F++)n[F]&&(x+=n[F].size)}this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=w;for(F=t;F<=o;F++)n[F]&&(O+=n[F].size),l&&F<d-2||0<d&&F==d-1||(this.ctx.moveTo(N,R+O),this.ctx.lineTo(W,R+O));for(var L=e;L<=i;L++)h[L]&&(B+=h[L].size),0<g&&L==g-1||(this.ctx.moveTo(B+T,E+x),this.ctx.lineTo(B+T,A));this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.drawLeftLine=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.fixed.fixedRows,r=o.fixed.fixedRow,s=o.rows;if(o.showGridLines){var a=0,n=0,h=o.spans,l=o.gridLinesColor;if(o.headeNotLineInFix&&0<i){a=i-1,h.forEach(function(t){a>=t.row&&a<t.rowCount+t.row&&(a=t.row)});for(var c=r;c<a;c++)s[c]&&(n+=s[c].size)}this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=l,this.ctx.moveTo(this.numColW,this.numRowH+n),this.ctx.lineTo(this.numColW,this.verticalLine),this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.drawTopLine=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e);if(o.showGridLines){var i=o.gridLinesColor;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle=i,o.headeNotLineInFix||(this.ctx.moveTo(this.numColW,this.numRowH),this.ctx.lineTo(this.horizontalLine,this.numRowH)),this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.drawSpans=function(c,d,g,p,t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e).spans,f=this;this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#FFF",o.forEach(function(t){var e=t.row,o=t.col,i=t.row+t.rowCount-1,r=t.col+t.colCount-1;if(c<=i&&e<=g&&d<=r&&o<=p){var s=f.getSelectInfo(e,o,i,r),a=s.w,n=s.h,h=s.selectX,l=s.selectY;0<n&&0<a&&f.ctx.fillRect(h+1,l+1,a-2,n-2)}}),this.ctx.restore()},Workbook.prototype.drawBgFill=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.fixed.fixedW,s=i.fixed.fixedH,a=0,n=0,h=0,l=0;switch(t){case 1:a=this.numColW+r+1,n=this.numRowH+s,h=this.horizontalLine-r,l=this.verticalLine-s;break;case 2:a=this.numColW,n=this.numRowH+s,h=r-1,l=this.verticalLine-s;break;case 3:a=this.numColW+r+1,n=this.numRowH,h=this.horizontalLine-r,l=s-1;break;case 4:a=this.numColW,n=this.numRowH,h=r-1,l=s-1}this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#FFF",this.ctx.fillRect(a,n,h,l),this.ctx.restore()},Workbook.prototype.drawCellContent=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.rows,h=a.columns,l=a.fixed.fixedRows,c=a.fixed.fixedCols,d=a.data.dataTable,g=0,p=0,f=/^0*MR?\(?A?(\+(￥|¥|\$|€|￡|₣|₩))?$/,u=/^0*NR?\(?A?(\+thousands)?$/;for(var b in d){for(var w=t;w<parseInt(b);w++)n[w]&&(g+=n[w].size);for(var k in d[b]){for(var v=e;v<parseInt(k);v++)h[v]&&(p+=h[v].size);var m=this.getMergeCount(parseInt(b),parseInt(k),s),x=0!=l?0:m.rowCount-1,y=0!=c?0:m.colCount-1;if(parseInt(b)+x>=t&&parseInt(b)<=o&&-1!=parseInt(b)&&parseInt(k)+y>=e&&parseInt(k)<=i){var S=d[b][k];"{}"!==JSON.stringify(S.style)&&S.style||(S.style=JSON.parse(JSON.stringify(this.defaultCellStyle)));var C=S.style,H=S.style.formatter,W=!1,A=parseInt(b),T=parseInt(k),R=this.getText(A,T,A,T,s);(f.test(H)||u.test(H))&&-1!=H.indexOf("R")&&Number(R)<0&&(W=!0),H&&(S.hasOwnProperty("text")||S.hasOwnProperty("value"))&&(R=this.getFormatValue(R,H)),this.initValue(R,A,T,g+this.numRowH,p+this.numColW,C,W,s)}p=0}g=0}},Workbook.prototype.recalculatePercentage=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.fixed.hideH,r=o.fixed.hideW,s=o.fixed.fixedH,a=o.fixed.fixedW,n=0,h=0;2==this.workbook.scrollMode&&(n=s,h=a),this.percentageV=(this.height-this.numRowH-n-this.tabsHeight)/(this.totalHeight-i-n),this.percentageH=(this.width-this.numColW-h)/(this.totalWidth-r-h),1<this.percentageV&&(this.percentageV=1),1<this.percentageH&&(this.percentageH=1),this.percentageV=this.percentageV.toFixed(5)-0,this.percentageH=this.percentageH.toFixed(5)-0,this.dragVBar(!1,0,0),this.dragHBar(!1,0,0)},Workbook.prototype.getSelectInfo=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.rows,h=a.columns,l=a.startRow,c=a.startCol,d=a.fixed.fixedRow,g=a.fixed.fixedCol,p=a.fixed.fixedRows,f=a.fixed.fixedCols,u=a.scrollOption.offsetX,b=a.scrollOption.offsetY,w=a.fixed.fixedH,k=a.fixed.fixedW,v=a.spans,m=this.handleArg(t,e,o,i,s),x=m.r1,y=m.c1,S=m.r2,C=m.c2,H=0<p&&x<p?0:w,W=0<f&&y<f?0:k,A=0<p&&x<=l?0:b,T=0<f&&y<=c?0:u,R=0<p&&x<p?d:l,B=0<f&&y<f?g:c,O=this.numColW+W-T,N=this.numRowH+H-A;v.forEach(function(t){t.row==x&&t.col==y&&null==i&&null==o&&(C=t.col+t.colCount-1,S=t.row+t.rowCount-1)});for(var E=0,F=0,L=0,I=0,D=f<=C?f-1:C,P=B<y?y:B;P<=D;P++)h[P]&&(E+=h[P].size);for(var z=c<y?y:c;z<=C;z++)h[z]&&(F+=h[z].size);var M=p<=S?p-1:S;for(P=R<x?x:R;P<=M;P++)n[P]&&(L+=n[P].size);for(z=l<x?x:l;z<=S;z++)n[z]&&(I+=n[z].size);for(var V=B;V<y;V++)h[V]&&(O+=h[V].size);for(var X=R;X<x;X++)n[X]&&(N+=n[X].size);(F=f<=y&&y<=c&&0<f||y<f&&f<=C&&0<f||0==f&&y<=c&&c<=C?F-u:F)<=0&&(F=0),(I=p<=x&&x<=l&&0<p||x<p&&p<=S&&0<p||0==p&&x<=l&&l<=S?I-b:I)<=0&&(I=0);var j=E+F<0?0:E+F,Y=L+I<0?0:L+I;return{selectX:O<this.numColW?this.numColW:O,selectY:N<this.numRowH?this.numRowH:N,w:j,h:Y,c1w:j,r1h:Y,r1:x,c1:y,r2:S,c2:C}},Workbook.prototype.handleArg=function(t,e,o,i,r){var s,a,n=0<=r?r:this.workbook.activeSheet,h=this.getActiveSheet(n),l=t,c=e,d=o,g=i,p=h.rows,f=h.columns;return l=void 0===t?h.rangeRow1:t,c=void 0===e?h.rangeCol1:e,d=void 0===o?h.rangeRow2:o,g=void 0===i?h.rangeCol2:i,void 0===o&&void 0!==t&&(d=l),void 0===i&&void 0!==e&&(g=c),l<0&&(l=0),c<0&&(c=0),d<0&&(d=0),g<0&&(g=0),l>p.length-1&&(l=p.length-1),c>f.length-1&&(c=f.length-1),d>p.length-1&&(d=p.length-1),g>f.length-1&&(g=f.length-1),d<l&&(s=l,l=d,d=s),g<c&&(a=c,c=g,g=a),{r1:l,c1:c,r2:d,c2:g}},Workbook.prototype.getSpansInfo=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.spans,r=[],s=0,a=0,n=0,h=0,l=o.rows,c=o.columns,d=o.fixed.fixedCols,g=o.fixed.fixedRows;return i.forEach(function(t){for(var e=t.row;e<t.rowCount+t.row;e++)l[e]&&(s+=l[e].size);for(e=t.col;e<t.colCount+t.col;e++)c[e]&&(a+=c[e].size);for(var o=t.col;o<d;o++)c[o]&&(n+=c[o].size);for(o=t.row;o<g;o++)l[o]&&(h+=l[o].size);r.push({r:t.row,c:t.col,colCount:t.colCount,rowCount:t.rowCount,spansHeight:s,spansWidth:a,toFixedW:n,toFixedH:h}),n=h=a=s=0}),r},Workbook.prototype.getYMaxScroll=function(){var t=((this.totalHeight+this.numRowH-this.height-this.activeSheet.fixed.hideH)*this.percentageV).toFixed(2)-0;return t<0&&(t=0),t},Workbook.prototype.getXMaxScroll=function(){var t=((this.totalWidth+this.numColW-this.width-this.activeSheet.fixed.hideW)*this.percentageH).toFixed(2)-0;return t<0&&(t=0),t},Workbook.prototype.dragVBar=function(t,e,o){var i,r=this.activeSheet,s=this.getYMaxScroll(),a=r.startRow,n=r.scrollOption.offsetY;i=o-e+r.scrollOption.totalY,this.popup&&this.popup.closeAll(),0<=i?r.scrollOption.coordY=i<=s?i:s:i<0&&(r.scrollOption.coordY=0),1<=this.percentageV&&(r.scrollOption.coordY=0),this.getStartAndEnd();var h=r.startRow,l=r.fixed.fixedRows,c=r.fixed.fixedRow,d=r.scrollOption.offsetY,g=0<l?l:c;0<r.scrollOption.coordY&&h==g&&0==d&&(r.scrollOption.coordY=0),t||(r.scrollOption.totalY=r.scrollOption.coordY),a==h&&d==n||this.startPaint(!0)},Workbook.prototype.dragHBar=function(t,e,o){var i,r=this.activeSheet,s=this.getXMaxScroll(),a=r.startCol,n=r.scrollOption.offsetX;i=o-e+r.scrollOption.totalX,this.popup&&this.popup.closeAll(),r.scrollOption.coordX=0<=i?i<=s?i:s:0,1==this.percentageH&&(r.scrollOption.coordX=0),this.getStartAndEnd();var h=r.startCol,l=r.fixed.fixedCols,c=r.fixed.fixedCol,d=0<l?l:c,g=r.scrollOption.offsetX;0<r.scrollOption.coordX&&h==d&&0==g&&(r.scrollOption.coordX=0),t||(r.scrollOption.totalX=r.scrollOption.coordX),a==h&&n==g||this.startPaint(!0)},Workbook.prototype.scrollV=function(){if(this.isHasVBar()&&this.isShowBar){var t=this.getScrollVInfo(),e=t.y1,o=t.y2,i=t.x1;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.lineWidth=this.scrollSize,this.ctx.strokeStyle="rgba(200,200,200,0.7)",this.ctx.moveTo(i,e),this.ctx.lineTo(i,o),this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.scrollH=function(){if(this.isHasHBar()&&this.isShowBar){var t=this.getScrollHInfo(),e=t.x1,o=t.x2,i=t.y1;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineCap="round",this.ctx.lineWidth=this.scrollSize,this.ctx.strokeStyle="rgba(200,200,200,0.7)",this.ctx.moveTo(e,i),this.ctx.lineTo(o,i),this.ctx.stroke(),this.ctx.restore()}},Workbook.prototype.scrollFun=function(t){if(t=t||window.event,this.isHasVBar()&&this.isShowBar){var e=this.activeSheet,o=this.getYMaxScroll(),i=e.rows,r=e.startRow,s=e.scrollOption.offsetY,a=0<=e.startRow-1?e.startRow-1:0,n=0<=e.startRow-3?e.startRow-3:0;if(this.popup&&this.popup.closeAll(),t.wheelDelta){if(0<t.wheelDelta){for(var h=a;n<=h;h--)i[h]&&(e.scrollOption.coordY-=i[h].size*this.percentageV),0==h&&(e.scrollOption.coordY=0);e.scrollOption.coordY=e.scrollOption.coordY.toFixed(5)-0,e.scrollOption.coordY<=0&&(e.scrollOption.coordY=0,e.scrollOption.totalY=0)}if(t.wheelDelta<0){for(h=e.startRow;h<e.startRow+3;h++)i[h]&&(e.scrollOption.coordY+=i[h].size*this.percentageV);e.scrollOption.coordY=e.scrollOption.coordY.toFixed(5)-0,e.scrollOption.coordY>o&&(e.scrollOption.coordY=o),(1<=this.percentageV||e.scrollOption.coordY<0)&&(e.scrollOption.coordY=0)}}else if(t.detail){if(0<t.detail){for(h=e.startRow;h<e.startRow+3;h++)i[h]&&(e.scrollOption.coordY+=i[h].size*this.percentageV);e.scrollOption.coordY=e.scrollOption.coordY.toFixed(5)-0,e.scrollOption.coordY>o&&(e.scrollOption.coordY=o),(1<=this.percentageV||e.scrollOption.coordY<0)&&(e.scrollOption.coordY=0)}if(t.detail<0){for(h=a;n<=h;h--)i[h]&&(e.scrollOption.coordY-=i[h].size*this.percentageV),0==h&&(e.scrollOption.coordY=0);e.scrollOption.coordY=e.scrollOption.coordY.toFixed(5)-0,e.scrollOption.coordY<=0&&(e.scrollOption.coordY=0,e.scrollOption.totalY=0)}}this.getStartAndEnd();var l=e.startRow,c=e.fixed.fixedRows,d=e.fixed.fixedRow,g=e.scrollOption.offsetY,p=0<c?c:d;0<=e.scrollOption.coordY&&l==p&&0==g&&(e.scrollOption.coordY=0),e.scrollOption.totalY=e.scrollOption.coordY,r==l&&g==s||this.startPaint(!0)}},Workbook.prototype.initValue=function(t,r,s,e,o,a,i,n){var h,l,c=this.getActiveSheet(n),d=this.getSpansInfo(n),g=c.startCol,p=c.startRow,f=c.endCol,u=c.endRow,b=c.fixed.fixedW,w=c.fixed.fixedH,k=c.fixed.fixedCols,v=c.fixed.fixedCol,m=c.fixed.fixedRow,x=c.fixed.fixedRows,y=c.scrollOption.offsetX,S=c.scrollOption.offsetY,C=c.data.dataTable,H=c.activeRow,W=c.activeCol,A=c.rows,T=c.columns,R=0,B=0,O=!1,N=this,E=0,F=0,L=0,I=0,D=0,P=0,z=0,M=0,V=0,X=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(A[r]&&(h=A[r].size),T[s]&&(l=T[s].size),d.forEach(function(t){t.r==r&&t.c==s&&(l=t.spansWidth,h=t.spansHeight,E=t.toFixedW,F=t.toFixedH,R=t.rowCount-1,B=t.colCount-1)}),0!=k)if(s<k)if(s+B<k)I=0;else{for(var j=k;j<g;j++)T[j]&&(I+=T[j].size);l=(l=l-I-y)<E?E:l}else{for(j=s;j<g;j++)T[j]&&(I+=T[j].size);D=y,M=b,l=(l-=I)<E?E:l}else{for(j=s;j<g;j++)T[j]&&(I+=T[j].size);D=y,l=(l-=I)<E?E:l,M=0}if(0!=x)if(r<x)if(r+R<x)L=0;else{for(j=x;j<p;j++)A[j]&&(L+=A[j].size);h=(h=h-L-S)<F?F:h}else{for(j=r;j<p;j++)A[j]&&(L+=A[j].size);P=S,z=w,h=(h-=L)<F?F:h}else{for(j=r;j<p;j++)A[j]&&(L+=A[j].size);P=S,h=(h-=L)<F?F:h,z=0}var Y=this.getCellStatus(r,s,n),$=Y.cellTypeName,J=Y.isCheckBox,U=c.alwaysShowButton,G=c.alwaysShowInArea;1!=$&&2!=$||(U&&!G||U&&G&&r==H&&s==W||!U&&r==H&&s==W&&this.isEdit)&&(l-=this.cellBtnAreaWidth,V=this.cellBtnAreaWidth),4==$&&(U&&!G||U&&G&&r==H&&s==W||!U&&r==H&&s==W)&&(l-=this.cellBtnAreaWidth,V=this.cellBtnAreaWidth);var q=-D+M,_=-P+z,K=o+q,Z=o+l/2+q,Q=o+l+q,tt=e+_,et=e+h/2+_,ot=e+h+_;(p<=r+R&&r<=u&&g<=s+B&&s<=f||m<=r+R&&r<x&&v<=s+B&&s<k||m<=r+R&&r<x&&g<=s+B&&s<=f||p<=r+R&&r<=u&&v<=s+B&&s<k)&&(O=!0);var it=!1,rt=!1,st=!1,at=!1;if(a&&A[r]&&!A[r].bHidden&&T[s]&&!T[s].bHidden&&O&&(it=!0),a&&null!=t&&""!=t&&A[r]&&!A[r].bHidden&&T[s]&&!T[s].bHidden&&O&&!J&&(rt=!0),a&&A[r]&&!A[r].bHidden&&T[s]&&!T[s].bHidden&&O&&(at=!0),this.ctx.save(),it&&a.bgColor){var nt,ht,lt,ct;A[r-1]&&(nt=N.getBorder(r-1,s,r-1,s,n)),A[r+1]&&(ct=N.getBorder(r+1,s,r+1,s,n)),T[s-1]&&(ht=N.getBorder(r,s-1,r,s-1,n)),T[s+1]&&(lt=N.getBorder(r,s+1,r,s+1,n));var dt=nt&&nt.borderBottom?1:0,gt=ht&&ht.borderRight?1:0,pt=lt&&lt.borderLeft&&0<k&&s==k-1?2:0,ft=ct&&ct.borderTop&&0<x&&r==x-1?2:0;this.ctx.beginPath(),this.ctx.fillStyle=a.bgColor,this.ctx.fillRect(o-D+M+gt,e-P+z+dt,l+1-gt-pt,h+1-dt-ft)}if(this.ctx.restore(),this.ownerdraw&&"function"==typeof this.ownerdraw&&0==this.workbook.stopEventCount&&(it||rt)&&C[r]&&C[r][s]&&!C[r][s].text&&!C[r][s].value&&(st=this.ownerdraw(this,r,s,n)),this.ctx.save(),!st&&rt){var ut,bt,wt,kt=0,vt=0,mt=!0;X=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;this.ctx.font=a.font||this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+" "+this.workbook.defaultFontName,this.ctx.fillStyle=a.fontColor||"#000",i&&(this.ctx.fillStyle="red");var xt=this.getFontList(r,s,n),yt=xt.originSize,St=xt.originHeight,Ct=xt.originBold,Ht=xt.originItalic,Wt=parseInt(c.cellPadding.left),At=parseInt(c.cellPadding.right),Tt=parseInt(c.cellPadding.top),Rt=parseInt(c.cellPadding.bottom),Bt=Ct||Ht?2:0;switch(a.hAlign){case 1:wt=this.getValue(r,s,r,s,n),kt=X.test(wt)?Q-At:K+Wt,ut=X.test(wt)?"right":"left";break;case 2:kt=K+Wt+Bt,ut="left";break;case 3:kt=Z,ut="center";break;case 4:kt=Q-At-Bt,ut="right";break;default:kt=K+Wt+Bt,ut="left"}switch(a.vAlign){case 1:vt=tt+Tt,bt="top";break;case 2:vt=et,bt="middle";break;case 3:vt=ot-Rt,bt="bottom";break;default:vt=et,bt="middle"}0!=k&&s<k&&k<=s+B&&(mt=!(kt<o)),0!=x&&r<x&&x<=r+R&&(mt=!(vt<e)),this.ctx.textAlign=ut,this.ctx.textBaseline=bt;var Ot,Nt=0,Et=0,Ft=[],Lt=0,It=0,Dt=0,Pt=this.breakLine(t,l-Wt-At,this.ctx);if(a.wordWrap){for(j=0;j<Pt.length;j++)(Et+=St)<=h-Rt-Tt&&Ft.push(Pt[j]);Nt=2==a.vAlign?(Ot=Math.floor(Ft.length/2),Ft.length%2!=0?Ot*St:Ot*St-St/2):3==a.vAlign?(Ft.length-1)*St:0}else Ft.push(Pt[0]);Ft.forEach(function(t,e){if(l>=N.cellBtnAreaWidth)var o=t;else mt=!1;if(mt){switch(N.ctx.beginPath(),N.ctx.fillText(o,kt,vt+St*e-Nt),Lt=N.ctx.measureText(t).width,a.hAlign){case 1:wt=N.getText(r,s,r,s,e),It=X.test(wt)?-Lt:0,Dt=X.test(wt)?0:Lt;break;case 2:It=0,Dt=Lt;break;case 3:It=-Lt/2,Dt=Lt/2;break;case 4:It=-Lt,Dt=0;break;default:It=0,Dt=Lt}var i=1==a.vAlign?yt/2:2==a.vAlign?0:3==a.vAlign?-yt/2:0;N.ctx.beginPath(),N.ctx.strokeStyle="#000",a.fontStrikeout&&(N.ctx.moveTo(kt+It,vt+St*e-Nt+i),N.ctx.lineTo(kt+Dt,vt+St*e-Nt+i)),a.fontUnderline&&(N.ctx.moveTo(kt+It,vt+St*e-Nt+i+yt/2),N.ctx.lineTo(kt+Dt,vt+St*e-Nt+i+yt/2)),N.ctx.stroke()}})}this.ctx.restore();var zt=0;1!=$&&2!=$||!O||(zt=this.getBtnAndCutX(r,s,n).cutX,this.drawBtn(r,s,K-zt,tt,l+V,h,!1,n),this.btnArr.push({row:r,col:s,x:K-zt,y:tt,w:l+V,h:h,hover:!1})),3==$&&O&&(this.drawCheckBox(r,s,K,tt,l,h,!1,n),this.checkBoxBtn.push({row:r,col:s,x:K,y:tt,w:l,h:h,hover:!1})),4==$&&O&&(zt=this.getBtnAndCutX(r,s,n).cutX,this.drawSelectBtn(r,s,K-zt,tt,l+V,h,n)),at&&(a.borderBottom&&this.drawCellBorder(a.borderBottom,K,ot,Q+V,ot),a.borderTop&&this.drawCellBorder(a.borderTop,K,tt,Q+V,tt),a.borderLeft&&this.drawCellBorder(a.borderLeft,K,tt,K,ot),a.borderRight&&this.drawCellBorder(a.borderRight,Q+V,tt,Q+V,ot))},Workbook.prototype.drawCellBorder=function(t,e,o,i,r){this.ctx.save();var s=t.style;this.ctx.beginPath();var a=1==s?.5:2==s?1.5:5==s?2.5:.5,n=(t.color||"#000").toLowerCase();this.ctx.strokeStyle=n;/^(white)$|^#(fff|ffffff)$/.test(n)&&(a=2),this.ctx.lineWidth=a,0!=s&&(this.ctx.moveTo(e,o),this.ctx.lineTo(i,r)),this.ctx.stroke(),this.ctx.restore()},Workbook.prototype.breakLine=function(t,e,o){var i=[];try{var r;r=t.toString().split("");for(var s,a="",n=[],h=new RegExp(/[\n]/),l=0;l<r.length;l++)o.measureText(a).width<e&&o.measureText(a+r[l]).width<=e&&!h.test(r[l])&&!h.test(r[l-1])?a+=r[l]:(n.push(a),a=h.test(r[l])?"<br>":r[l]);n.push(a),""==n[0]&&n.shift();for(var c=0;c<n.length;c++)"<br>"==n[c]&&"<br>"!=n[c-1]&&void 0!==n[c-1]&&"<br>"!=n[c+1]&&void 0!==n[c+1]||(s=n[c],"<br>"==n[c]&&(s=""),i.push(s))}catch(t){}return i},Workbook.prototype.insertN=function(){var t=this.activeSheet,e=t.rangeRow1,o=t.rangeCol1,i=document.querySelector("#"+this.boxId+" .child");this.endEdit(),i&&(this.pasteHtmlAtCaret("<br>"),this.wordWrap(e,o,e,o,!0))},Workbook.prototype.pasteHtmlAtCaret=function(t){var e,o;if(window.getSelection){if((e=window.getSelection()).getRangeAt&&e.rangeCount){(o=e.getRangeAt(e.rangeCount-1)).deleteContents();var i=document.createElement("div");i.innerHTML=t;for(var r,s,a=document.createDocumentFragment();r=i.firstChild;)s=a.appendChild(r);o.insertNode(a),s&&((o=o.cloneRange()).setStartAfter(s),o.collapse(!0),e.removeAllRanges(),e.addRange(o))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(t)},Workbook.prototype.swapCell=function(t){t=t||window.event;var e=this.activeSheet,o=e.rangeRow1,i=e.rangeCol1,r=e.rangeRow2,s=e.rangeCol2,a=e.fixed.fixedRows,n=e.fixed.fixedCols,h=e.endRow,l=e.endCol,c=e.startRow,d=e.startCol,g=e.spans,p=document.querySelector("#"+this.boxId+" .child"),f="",u=this.getFocus();if(p&&(f=p.innerText),37==t.keyCode&&0!=i?0!=window.getSelection().anchorOffset&&u||(e.rangeCol1-=1,e.activeCol-=1,e.rangeCol2=e.rangeCol1,e.rangeRow2=e.rangeRow1,this.removeTextArea()):38==t.keyCode&&0!=o?(e.rangeRow1-=1,e.activeRow-=1,e.rangeRow2=e.rangeRow1,e.rangeCol2=e.rangeCol1,this.removeTextArea()):(39==t.keyCode||9==t.keyCode||this.enterToRight&&13==t.keyCode)&&s<e.columns.length-1?(window.getSelection().anchorOffset==f.length||!u||this.enterToRight&&13==t.keyCode)&&(e.rangeCol2+=1,e.rangeCol1=e.rangeCol2,e.activeCol=e.rangeCol1,e.rangeRow2=e.rangeRow1,this.removeTextArea(t)):(40==t.keyCode||13==t.keyCode&&(!t.altKey||13!=t.keyCode)&&(!this.enterToRight||this.enterToRight&&s>=e.columns.length-1))&&r<e.rows.length-1&&(this.enterToRight&&s>=e.columns.length-1&&13==t.keyCode&&(!t.altKey||13!=t.keyCode)&&(e.rangeCol1=0,e.activeCol=0,e.scrollOption.coordX=0),e.rangeRow2+=1,e.rangeRow1=e.rangeRow2,e.activeRow=e.rangeRow1,e.rangeCol2=e.rangeCol1,this.removeTextArea(t)),13==t.keyCode&&(!t.altKey||13!=t.keyCode)&&r>=e.rows.length-1){var b=this.onenteraddrow,w=p.innerText;"function"==typeof b&&13==t.keyCode&&!0===b(o,i,w)?(this.removeTextArea(t),this.maxRow(e.rows.length+1),e.rangeCol1=0,e.activeCol=0,e.scrollOption.coordX=0,e.rangeRow2+=1,e.rangeRow1=e.rangeRow2,e.activeRow=e.rangeRow1,e.rangeCol2=e.rangeCol1,"function"==typeof this.onafteraddrow&&this.onafteraddrow(e.activeRow,e.activeCol),this.setScrollPosition(e.scrollOption.coordX/this.percentageH,99999)):(this.removeTextArea(t),""!=f.replace(/\s/g,"")&&this.startPaint(!0))}var k=1,v=1;g.forEach(function(t){t.row<=e.rangeRow1&&e.rangeRow1<t.row+t.rowCount&&e.rangeCol1>=t.col&&e.rangeCol1<t.colCount+t.col&&(e.rangeRow1=t.row,e.activeRow=t.row,e.rangeCol1=t.col,e.activeCol=t.col,e.rangeRow2=t.row+t.rowCount-1,e.rangeCol2=t.col+t.colCount-1,k=t.rowCount,v=t.colCount)});var m=this.getYMaxScroll(),x=this.getXMaxScroll(),y=e.scrollOption.coordY,S=e.scrollOption.coordX,C=e.rows,H=e.columns;if(y<m&&e.rangeRow2>=h-1&&this.percentageV<1&&0<this.percentageV&&(40==t.keyCode||13==t.keyCode&&(!t.altKey||13!=t.keyCode)&&!this.enterToRight||this.enterToRight&&s>=e.columns.length-1)){for(var W=0,A=c;A<c+k;A++)C[A]&&(W+=C[A].size*this.percentageV);for(var T=0,R=e.rangeRow1;R<=e.rangeRow2+1;R++)C[R]&&(T+=C[R].size*this.percentageV);W=W.toFixed(5)-0,T=T.toFixed(5)-0,e.scrollOption.coordY+=T<=W?W:T,e.scrollOption.coordY>=m&&(e.scrollOption.coordY=m),e.scrollOption.totalY=e.scrollOption.coordY}if(0<y&&e.rangeRow1<=c+1&&this.percentageV<1&&0<this.percentageV&&38==t.keyCode){var B=0;for(A=h;h-k<A;A--)C[A]&&(B-=C[A].size*this.percentageV);var O=0;for(R=e.rangeRow2;R>=e.rangeRow1-1;R--)C[R]&&(O-=C[R].size*this.percentageV);B=B.toFixed(5)-0,O=O.toFixed(5)-0,e.scrollOption.coordY+=O<=B?O:B,e.scrollOption.coordY<=0&&(e.scrollOption.coordY=0),e.scrollOption.totalY=e.scrollOption.coordY}if(S<x&&e.rangeCol2>=l-1&&this.percentageH<1&&0<this.percentageH&&(39==t.keyCode||9==t.keyCode||this.enterToRight&&13==t.keyCode)){var N=0;for(A=d;A<d+v;A++)H[A]&&(N+=H[A].size*this.percentageH);var E=0;for(R=e.rangeCol1;R<=e.rangeCol2+1;R++)H[R]&&(E+=H[R].size*this.percentageH);N=N.toFixed(5)-0,E=E.toFixed(5)-0,e.scrollOption.coordX+=E<=N?N:E,e.scrollOption.coordX>=x&&(e.scrollOption.coordX=x),e.scrollOption.totalX=e.scrollOption.coordX}if(0<S&&e.rangeCol1<=d+1&&this.percentageH<1&&0<this.percentageH&&37==t.keyCode){var F=0;for(A=l;l-v<A;A--)H[A]&&(F-=H[A].size*this.percentageH);var L=0;for(R=e.rangeCol2;R>=e.rangeCol1-1;R--)H[R]&&(L-=H[R].size*this.percentageH);F=F.toFixed(5)-0,L=L.toFixed(5)-0,e.scrollOption.coordX+=L<=F?L:F,e.scrollOption.coordX<=0&&(e.scrollOption.coordX=0),e.scrollOption.totalX=e.scrollOption.coordX}(o!=e.rangeRow1||i!=e.rangeCol1||n<d&&0==e.scrollOption.coordX||a<c&&0==e.scrollOption.coordY||l<H.length-1&&e.scrollOption.coordX==x||h<C.length-1&&e.scrollOption.coordY==m)&&this.startPaint(!0)},Workbook.prototype.showArrow=function(t,e){for(var o=this.activeSheet,i=this.numRowH,r=this.numColW,s=0,a=0,n=o.rows,h=o.columns,l=this.getStartRC(t,e),c=l.startR,d=l.startC,g=l.fy,p=l.fx,f=l.oy,u=l.ox,b=this.getFocus(),w=0;w<c;w++)n[w]&&(s+=n[w].size);for(w=0;w<d;w++)h[w]&&(a+=h[w].size);for(var k=e+s-g+f,v=t+a-p+u,m=0;m<n.length&&!(n[m]&&k<=(i+=n[m].size)&&k>this.numRowH);m++);for(var x=0;x<h.length&&!(h[x]&&v<=(r+=h[x].size)&&v>this.numColW);x++);t>this.numColW&&e>this.numRowH&&(this.canvas.style.cursor="default",this.isHArrow=!1,this.isVArrow=!1),e<=this.numRowH&&0<t&&0<e&&t<=this.width&&((r-6<v&&v<r||t>this.numColW-6&&t<this.numColW&&0<e&&e<this.numRowH)&&!b?(this.canvas.style.cursor="e-resize",this.isHArrow=!0):(this.canvas.style.cursor="default",this.isHArrow=!1),this.isVArrow=!1),t<this.numColW&&e>this.numRowH-4&&e<this.height-this.tabsHeight&&((i-6<k&&k<i||e>this.numRowH-6&&e<this.numRowH&&0<t&&t<this.numColW)&&!b?(this.canvas.style.cursor="n-resize",this.isVArrow=!0):(this.canvas.style.cursor="default",this.isVArrow=!1),this.isHArrow=!1)},Workbook.prototype.createLine=function(t){var e,o,i,r,s,a,n=this.activeSheet,h=document.getElementById(this.boxId),l=n.activeCol,c=n.activeRow,d=this.numColW,g=this.numRowH,p=n.fixed.fixedRow,f=n.fixed.fixedCol,u=n.fixed.fixedRows,b=n.fixed.fixedCols,w=0,k=0,v=n.rows,m=n.columns,x=this.isHasHBar(),y=this.isHasVBar(),S=x&&this.isShowBar?this.scrollSize:0,C=y&&this.isShowBar?this.scrollSize:0;i=b<=l?(w=n.fixed.fixedW,e=n.startCol,n.scrollOption.offsetX):(e=f,w=0),r=u<=c?(k=n.fixed.fixedH,o=n.startRow,n.scrollOption.offsetY):(o=p,k=0);for(var H=e;H<=l;H++)m[H]&&(d+=m[H].size);for(H=o;H<=c;H++)v[H]&&(g+=v[H].size);s=this.totalWidth+this.numColW>this.width?this.width-C:this.totalWidth+this.numColW-C,a=this.totalHeight+this.numRowH>this.height-this.tabsHeight?this.height-this.tabsHeight-S:this.totalHeight+this.numRowH-S;var W=document.createElement("div");W.style.background="green",W.style.position="absolute",W.setAttribute("class","line"),"vertical"==t&&(W.style.height=a+"px",W.style.top=2+this.paddingT+"px",W.style.left=d+w-i+this.paddingL+"px",W.style.width="1.5px"),"horizontal"==t&&(W.style.height="1.5px",W.style.top=g+k-r+this.paddingT+"px",W.style.left=2+this.paddingL+"px",W.style.width=s+"px"),h.appendChild(W)},Workbook.prototype.changeCellWidth=function(t,e,o){if(this.workbook.allowResize){var i,r=this.activeSheet,s=document.querySelector(".line"),a=this.numColW,n=r.activeCol,h=e,l=o,c=r.fixed.fixedCol,d=r.fixed.fixedCols,g=0,p=0,f=0,u=r.columns;f=d<=n?(g=r.fixed.fixedW,p=r.startCol,r.scrollOption.offsetX):(p=c,g=0);for(var b=p;b<=n;b++)u[b]?a+=u[b].size:-1==n&&(a=r.rowHeaderData.defaultW);i=l-h,s.style.left=a+i+g-f+this.paddingL+"px";var w=document.getElementsByClassName("line"),k=0;if(!t){this.canvas.style.cursor="default";for(var v=w.length-1;0<=v;v--)w[v].parentNode.removeChild(w[v]);-1!=n&&u[n]?Math.abs(i)>=u[n].size&&i<=0?(r.columns[n].bHidden=!0,k=-u[n].size,r.columns[n].tempSize=u[n].size,r.columns[n].size=0,this.setNoDefaultW(n)):(u[n+1]&&u[n+1].bHidden&&0<i?(delete r.columns[n+1].bHidden,r.columns[n+1].size=i,delete r.columns[n+1].tempSize,this.setNoDefaultW(n+1)):(r.columns[n].size=u[n].size+i,this.setNoDefaultW(n)),k=i):-1==n&&(Math.abs(i)>r.rowHeaderData.defaultW&&i<0?r.rowHeaderData.showRowHeading=!1:r.rowHeaderData.defaultW=r.rowHeaderData.defaultW+i,r.selHdrTopLeft=!1),this.totalWidth=this.totalWidth+k,this.recalculatePercentage(),this.startPaint(!0)}}},Workbook.prototype.setNoDefaultW=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.columns,s=i.defaults.colWidth;r[t]&&(r[t].size==s?r[t].hasOwnProperty("noDefaultW")&&delete i.columns[t].noDefaultW:i.columns[t].noDefaultW=!0)},Workbook.prototype.changeCellHeight=function(t,e,o){if(this.workbook.allowResize){var i,r,s,a=this.activeSheet,n=document.querySelector(".line"),h=this.numRowH,l=a.activeRow,c=e,d=o,g=a.fixed.fixedRow,p=a.fixed.fixedRows,f=0,u=a.rows;s=p<=l?(f=a.fixed.fixedH,r=a.startRow,a.scrollOption.offsetY):(r=g,f=0);for(var b=r;b<=l;b++)u[b]?h+=u[b].size:-1==l&&(h=a.colHeaderData.defaultH);i=d-c,n.style.top=h+i+f-s+this.paddingT+"px";var w=document.getElementsByClassName("line"),k=0;if(!t){for(var v=w.length-1;0<=v;v--)w[v].parentNode.removeChild(w[v]);-1!=l&&u[l]?Math.abs(i)>=u[l].size&&i<0?(a.rows[l].bHidden=!0,k=-u[l].size,a.rows[l].tempSize=u[l].size,a.rows[l].size=0,this.setNoDefaultH(l)):(u[l+1]&&u[l+1].bHidden&&0<i?(delete a.rows[l+1].bHidden,a.rows[l+1].size=i,delete a.rows[l+1].tempSize,this.setNoDefaultH(l+1)):(a.rows[l].size=u[l].size+i,this.setNoDefaultH(l)),k=i):-1==l&&(Math.abs(i)>a.colHeaderData.defaultH&&i<0?a.colHeaderData.showColHeading=!1:a.colHeaderData.defaultH=a.colHeaderData.defaultH+i,a.selHdrTopLeft=!1),this.totalHeight=this.totalHeight+k,this.recalculatePercentage(),this.startPaint(!0)}}},Workbook.prototype.setNoDefaultH=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.rows,s=i.defaults.rowHeight;r[t]&&(r[t].size==s?r[t].hasOwnProperty("noDefaultH")&&delete i.rows[t].noDefaultH:i.rows[t].noDefaultH=!0)},Workbook.prototype.contextMenu=function(){var t=document.getElementById(this.boxId),e=document.createElement("div");e.setAttribute("menu","contextmenu"),e.setAttribute("class","hidden"),t.appendChild(e);e.innerHTML="<ul><li><p>复制 剪切：</p><span class='copy'>复制&nbsp;</span><span class='cut'>剪切&nbsp;</span><span class='paste'>粘贴&nbsp;</span></li><li><p>插入：</p><span class='addrow'>整行&nbsp;</span><span class='addcol'>整列&nbsp;</span></li><li><p>删除：</p><span class='delrow'>整行&nbsp;</span><span class='delcol'>整列&nbsp;</span></li><li><p>左右对齐：</p><span class='leftAlign'>左 &nbsp;</span><span class='centerAlign'>中 &nbsp;</span><span class='rightAlign'>右 &nbsp;</span></li><li><p>上下对齐：</p><span class='topAlign'>上 &nbsp;</span><span class='middleAlign'>中 &nbsp;</span><span class='bottomAlign'>下 &nbsp;</span></li></ul>"},Workbook.prototype.openContextMenu=function(t){var e=(t=t||window.event).button;this.getActiveSheet();if(this.workbook.showContextMenu&&2==e){this.popup&&this.popup.closeAll(),this.removeTextArea();var o=document.querySelector("#"+this.boxId+" div[menu=contextmenu]"),i=this.getContextPos(t);o.style.left=i.left+this.paddingL+"px",o.style.top=i.top+this.paddingT+"px",o.className="show"}},Workbook.prototype.getContextPos=function(t){var e=document.querySelector("#"+this.boxId+" div[menu=contextmenu]"),o=this.getMousePos(this.canvas,t),i=o.x,r=o.y,s=parseInt(this.getStyle(e,"width")),a=parseInt(this.getStyle(e,"height"));return{left:i+s>this.width?this.width-s-10:i,top:r+a>this.height?this.height-a-10:r}},Workbook.prototype.getActiveSheet=function(t){var e,o,i=0<=t?t:this.workbook.activeSheet;try{for(var r=0;r<this.workbook.sheetList.length;r++)r==i&&(e=this.workbook.sheetList[r]);for(var s in this.workbook.sheets)e==s&&(o=this.workbook.sheets[s])}catch(t){}return o},Workbook.prototype.sheetIndex=function(t){if(0<=t&&t<this.workbook.sheetList.length){var e=this.getActiveSheet(t);this.popup&&this.popup.closeAll(),this.workbook.activeSheet=t,this.tempValue={},this.activeSheet=e}return this.workbook.activeSheet},Workbook.prototype.sheetName=function(t,e){var o=0<=t?t:this.workbook.activeSheet;if(0<=o&&o<this.workbook.sheetList.length){this.workbook.activeSheet=o;var i=this.getActiveSheet(o),r=e||i.sheetName,s=i.sheetName;if(s!=(i.sheetName=r)){this.workbook.sheets[r]=i,delete this.workbook.sheets[s];for(var a=0;a<this.workbook.sheetList.length;a++)s==this.workbook.sheetList[a]&&(this.workbook.sheetList[a]=r);this.sheetIndex(o)}return i.sheetName}},Workbook.prototype.addSheet=function(t){var e=this.workbook.sheetList.length;if(this.endSheet++,"Object"==this.typeObj(t)){var o=t.sheetName?t.sheetName:"Sheet"+(e+1);this.workbook.sheetList.push(o),this.workbook.sheets[o]=t,this.initSheet(o)}else this.workbook.sheetList.push("Sheet"+(e+1)),this.workbook.sheets["Sheet"+(e+1)]=this.newSheetFormat("Sheet"+(e+1));this.getStartSheet(),this.sheetIndex(e)},Workbook.prototype.newWorkbook=function(t){"Object"==this.typeObj(t)?(this.workbook=t,this.initWorkbook()):this.workbook=JSON.parse(JSON.stringify(this.defaultOptions)),this.activeSheet=this.getActiveSheet()},Workbook.prototype.numSheets=function(t){var e=this.workbook.sheetList.length;if(e<=t){this.endSheet=t-1;for(var o=1;o<=t-e;o++)this.workbook.sheetList.push("Sheet"+(o+e)),this.workbook.sheets["Sheet"+(o+e)]=this.newSheetFormat("Sheet"+(o+e)),this.getStartSheet();this.sheetIndex(t-1)}else{if(!(t<e&&1<=t))throw"至少留有一张表";this.endSheet=t-1;for(var i=e;t<i;i--)this.workbook.sheetList.pop(),delete this.workbook.sheets[this.workbook.sheetList[i-1]],this.getStartSheet();this.workbook.activeSheet>t-1?this.sheetIndex(t-1):this.sheetIndex(this.workbook.activeSheet)}},Workbook.prototype.deleteSheets=function(t,e){var o=this.workbook.sheetList.length,i=0<=t?t:this.workbook.activeSheet,r=e||1;if(o<r+i&&(r=o-i),o<=r&&0==i)throw"至少留有一张表";for(var s=i;s<r+i;s++)"["+this.sheetName(s)+"]";this.endSheet=this.endSheet-r;for(var a=i;a<r+i;a++)delete this.workbook.sheets[this.workbook.sheetList[a]];this.workbook.sheetList.splice(i,r),this.getStartSheet(),o<=i+r?this.sheetIndex(i-1):this.sheetIndex(i)},Workbook.prototype.insertSheets=function(t,e){var o=this.workbook.sheetList.length,i=0<=t?t:this.workbook.activeSheet,r=e||1;this.endSheet=o+r-1;for(var s=1;s<=r;s++)this.workbook.sheetList.splice(i+(s-1),0,"Sheet"+(s+o)),this.workbook.sheets["Sheet"+(s+o)]=this.newSheetFormat("Sheet"+(s+o)),this.getStartSheet();this.sheetIndex(i)},Workbook.prototype.newSheetFormat=function(t){var e=JSON.parse(JSON.stringify(this.defaultOptions.sheets.Sheet1));e.sheetName=t,e.rowHeaderData.showRowHeading=!0,e.colHeaderData.showColHeading=!0;for(var o=e.defaults.colWidth,i=e.defaults.rowHeight,r=0;r<this.newSheetRow;r++)e.rows.push({size:i});for(var s=0;s<this.newSheetCol;s++)e.columns.push({size:o});return e},Workbook.prototype.maxCol=function(e,t){var o=0<=t?t:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.columns.length,s=i.data.dataTable,a=this,n=i.spans;if(e<0&&(e=0),0<=e){if(this.totalWidth=0,r<e)for(var h=0;h<e-r;h++)i.columns.push({size:i.defaults.colWidth});else if(0<=e&&e<r){for(var l=0;l<r-e;l++)i.columns.pop();n.forEach(function(t){t.col+t.colCount>e&&t.col<=e&&(t.colCount=e-t.col)});for(var c=n.length-1;0<=c;c--)(n[c].col>e||n[c].colCount<1||n[c].rowCount<1)&&i.spans.splice(c,1);var d=i.colHeaderData.spans;d&&d.forEach(function(t){t.col+t.colCount>e&&t.col<=e&&(t.colCount=e-t.col)});for(var g=Object.keys(s),p=0;p<g.length;p++){Object.keys(s[g[p]]).forEach(function(t){parseInt(t)>=i.columns.length&&delete s[g[p]][t]}),0==Object.keys(s[g[p]]).length&&delete s[g[p]]}var f=0<=e-1?e-1:0,u=0<=i.activeRow?i.activeRow:0;this.col(f,o),this.row(u,o)}i.columns.forEach(function(t){t.bHidden&&!t.tempSize&&(t.tempSize=t.size),t.bHidden&&(t.size=0),a.totalWidth+=t.size}),this.tempValue={},this.recalculatePercentage(o),0==e&&this.removeTextArea()}return i.columns.length},Workbook.prototype.maxRow=function(e,t){var o=0<=t?t:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.rows.length,s=i.data.dataTable,a=i.spans,n=this;if(e<0&&(e=0),0<=e){if(this.totalHeight=0,r<e)for(var h=0;h<e-r;h++)i.rows.push({size:i.defaults.rowHeight});else if(0<=e&&e<r){for(var l=0;l<r-e;l++)i.rows.pop();a.forEach(function(t){t.row+t.rowCount>e&&t.row<=e&&(t.rowCount=e-t.row)});for(var c=a.length-1;0<=c;c--)(a[c].row>e||a[c].rowCount<1||a[c].colCount<1)&&i.spans.splice(c,1);for(var d=Object.keys(s),g=0;g<d.length;g++)parseInt(d[g])>=i.rows.length&&delete s[d[g]];var p=0<=e-1?e-1:0,f=0<=i.activeCol?i.activeCol:0;this.row(p,o),this.col(f,o)}i.rows.forEach(function(t){t.bHidden&&!t.tempSize&&(t.tempSize=t.size),t.bHidden&&(t.size=0),n.totalHeight+=t.size}),this.tempValue={},this.recalculatePercentage(o),0==e&&this.removeTextArea()}return i.rows.length},Workbook.prototype.wordWrap=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.data.dataTable,l=(n.rows,void 0===r||r),c=this.handleArg(t,e,o,i,a),d=c.r1,g=c.c1,p=c.r2,f=c.c2,u=d;u<=p;u++)for(var b=g;b<=f;b++)this.createData(u,b,a),h[u]&&h[u][b]&&h[u][b].style&&(h[u][b].style.wordWrap=l)},Workbook.prototype.incrementRowheight=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=r.rows,a=this.getWordWrap(t,e,t,e,i),n=this.isSpanCell(t,e,t,e,i);if(s[t]&&!s[t].noDefaultH&&a&!n){var h,l=r.columns,c=this.getFontList(t,e,i).originHeight,d=this.getText(t,e,t,e,i)||"",g=0,p=0,f=r.defaults.rowHeight,u=parseInt(r.cellPadding.left),b=parseInt(r.cellPadding.right),w=parseInt(r.cellPadding.top),k=parseInt(r.cellPadding.bottom),v=this.getCellType(t,e,t,e);v&&(h=v.name),1!=h&&2!=h&&4!=h||(g=this.cellBtnAreaWidth),l[e]&&(p=l[e].size),this.ctx.font=this.getFont(t,e,t,e,i)||this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+" "+this.workbook.defaultFontName;var m=this.breakLine(d,p-b-u-g,this.ctx).length||1,x=f<c*m?c*m+w+k:f;this.setRowHeight(x,t,t,i),this.recalculatePercentage(i)}},Workbook.prototype.getWordWrap=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;if(a[f]&&a[f][u]&&a[f][u].style)a[f][u].style.hasOwnProperty("wordWrap")&&(b=a[f][u].style.wordWrap,n.push({r:f,c:u,wordWrap:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].wordWrap:l==d&&c==g||p?void 0:n},Workbook.prototype.createData=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=r.spans,a=r.data.dataTable;if(a[t]){if(a[t]&&!a[t][e]){var n={style:JSON.parse(JSON.stringify(this.defaultCellStyle))};a[t.toString()][e.toString()]=n}else if(a[t][e]&&!a[t][e].style){var h=JSON.parse(JSON.stringify(this.defaultCellStyle));a[t.toString()][e.toString()].style=h}}else{var l={};l[e.toString()]={style:JSON.parse(JSON.stringify(this.defaultCellStyle))},a[t.toString()]=l}for(var c=0;c<s.length;c++)s[c].row<=t&&t<s[c].row+s[c].rowCount&&s[c].col<=e&&e<s[c].col+s[c].colCount&&(s[c].row==t&&s[c].col==e||delete r.data.dataTable[t][e])},Workbook.prototype.getStartRC=function(t,e){var o=this.getActiveSheet(),i=o.scrollOption.offsetX,r=o.scrollOption.offsetY,s=o.startRow,a=o.startCol,n=o.fixed.fixedW,h=o.fixed.fixedH,l=o.fixed.fixedRow,c=o.fixed.fixedCol,d=o.fixed.fixedRows,g=o.fixed.fixedCols,p=0,f=0,u=0,b=0,w=0,k=0;return 0!=g&&t<n+this.numColW&&0<t?(p=c,k=b=0):0!=g&&t>n+this.numColW&&t<this.totalWidth?(p=a,b=n,k=i):0==g&&(p=a,b=0,k=i),0!=d&&e<h+this.numRowH&&0<e?(f=l,w=u=0):0!=d&&e>h+this.numRowH&&e<this.totalHeight?(f=s,u=h,w=r):0==d&&(f=s,u=0,w=r),{startR:f,startC:p,fy:u,fx:b,oy:w,ox:k}},Workbook.prototype.getActiveCell=function(t,e){for(var o,i,r=this.activeSheet,s=this.getStartRC(t,e),a=s.startR,n=s.startC,h=0,l=0,c=this.numRowH,d=this.numColW,g=0,p=0,f=r.spans,u=r.rows,b=r.columns,w=s.fy,k=s.fx,v=s.oy,m=s.ox,x=0;x<a;x++)u[x]&&(g+=u[x].size);for(x=0;x<n;x++)b[x]&&(p+=b[x].size);if(o=e+g-w+v,i=t+p-k+m,e>this.numRowH&&t>this.numColW&&e<this.totalHeight+this.numRowH&&t<this.totalWidth+this.numColW){for(var y=0;y<u.length;y++)if(u[y]&&!u[y].bHidden){if(o<=(c+=u[y].size)&&o>this.numRowH){h=y;break}h=r.rangeRow1}for(var S=0;S<b.length;S++)if(b[S]){if(i<=(d+=b[S].size)&&i>this.numColW){l=S;break}l=r.rangeCol1}f.forEach(function(t){h>=t.row&&h<t.row+t.rowCount&&l>=t.col&&l<t.col+t.colCount&&-1!=h&&-1!=l&&(h=t.row,l=t.col)}),r.selHdrTopLeft=!1}else if(e<this.numRowH&&t>this.numColW&&t<=this.totalWidth+this.numColW){for(var C=0;C<b.length;C++)if(b[C]&&i<=(d+=b[C].size)&&i>this.numColW){l=C;break}h=-1,r.selHdrTopLeft=!1}else if(e>this.numRowH&&t<this.numColW&&e<=this.totalHeight+this.numRowH){for(var H=0;H<u.length;H++)if(u[H]&&o<=(c+=u[H].size)&&o>this.numRowH){h=H;break}l=-1,r.selHdrTopLeft=!1}else e<this.numRowH&&t<this.numColW&&0<this.numRowH&&0<this.numColW||r.selHdrTopLeft?(h=l=-1,r.selHdrTopLeft=!0):(h=r.rangeRow1,l=r.rangeCol1);return r.activeRow=h,r.activeCol=l,{r:h,c:l}},Workbook.prototype.getSelection=function(t,e,o){for(var i,r,s=this.activeSheet,a=s.rangeRow2,n=s.rangeCol2,h=s.activeRow,l=s.activeCol,c=s.spans,d=this.numRowH,g=this.numColW,p=0,f=0,u=this.getStartRC(t,e),b=u.startR,w=u.startC,k=u.fy,v=u.fx,m=u.oy,x=u.ox,y=s.rows,S=s.columns,C=this.workbook.behaviorMode,H=s.selectMode,W=s.allowMoveRange,A=0;A<b;A++)y[A]&&(p+=y[A].size);for(A=0;A<w;A++)S[A]&&(f+=S[A].size);if(i=e+p-k+m,r=t+f-v+x,t<this.horizontalLine&&e<this.verticalLine||s.selHdrTopLeft){for(var T=0;T<y.length;T++)if(y[T]&&(d+=y[T].size),-1==h)a=y.length-1;else if(i<=d){a=T;break}for(var R=0;R<S.length;R++)if(S[R]&&(g+=S[R].size),-1==l)n=S.length-1;else if(r<=g){n=R;break}}var B,O,N=this.getCellStatus(h,l),E=N.isCheckBox,F=N.isCanEdit,L=N.isLock,I=N.cellTypeName;3!=H&&2!=C&&3!=C&&4!=I&&W&&(a<h&&(B=h,h=a,a=B),n<l&&(O=l,l=n,n=O));for(var D=h;D<=a;D++)for(var P=l;P<=n;P++)c.forEach(function(t){D>=t.row&&D<t.row+t.rowCount&&P>=t.col&&P<t.col+t.colCount&&-1!=l&-1!=h&&1==C&&(l>=t.col&&(l=t.col),n<=t.col+t.colCount-1&&(n=t.col+t.colCount-1),h>=t.row&&(h=t.row),a<=t.row+t.rowCount-1&&(a=t.row+t.rowCount-1))});3!=H&&2!=C&&3!=C&&4!=I&&W||-1==h||-1==l||(a=h,n=l,c.forEach(function(t){t.row<=a&&a<t.row+t.rowCount&&n>=t.col&&n<t.colCount+t.col&&-1!=h&&-1!=l&&(a=t.row+t.rowCount-1,n=t.col+t.colCount-1)}));var z=s.rangeRow1,M=s.rangeCol1,V=s.rangeRow2,X=s.rangeCol2;return s.rangeRow1=h,s.rangeCol1=l,s.rangeRow2=a,s.rangeCol2=n,z==h&&M==l&&V==a&&X==n&&(3!=I||h!=a||l!=n||o)&&("{}"!=JSON.stringify(this.tempValue)||2!=C&&3!=C||-1==h||-1==l||E||!1===F||L)||(this.removeTextArea(),this.startPaint(!0)),{r1:h,c1:l,r2:a,c2:n}},Workbook.prototype.editInsert=function(t,e,o,i,r){var s,a,n,h,l,c=0<=r?r:this.workbook.activeSheet,d=this.getActiveSheet(c),g=d.defaults.rowHeight||30,p=d.defaults.colWidth||60,f=document.querySelector("#"+this.boxId+" .child"),u={size:p},b={size:g},w=d.data.dataTable,k=Object.keys(w);if(s=0<=e?e:d.rangeRow1,a=0<=o?o:d.rangeCol1,n=1<=i?i:1,"F1ShiftRows"==t&&-1!=s){for(var v=0;v<n;v++)d.rows.splice(s+v,0,b);d.spans.forEach(function(t){s<=t.row?t.row+=n:s>t.row&&s<t.row+t.rowCount&&(t.rowCount+=n)});for(var m=k.length-1;0<=m;m--)h=k[m],s<=parseInt(h)&&(w[l=(parseInt(h)+n).toString()]=w[h]),s<=parseInt(h)&&parseInt(h)<parseInt(l)&&delete w[h];this.row(s,c),this.col(0,c),f.innerText="",this.totalHeight=this.totalHeight+g*n,this.recalculatePercentage(c)}else if("F1ShiftCols"==t&&-1!=a){for(v=0;v<n;v++)d.columns.splice(a+v,0,u);d.spans.forEach(function(t){a<=t.col?t.col+=n:a>t.col&&a<t.col+t.colCount&&(t.colCount+=n)});var x=d.colHeaderData.spans;x&&x.forEach(function(t){a<=t.col?t.col+=n:a>t.col&&a<t.col+t.colCount&&(t.colCount+=n)});for(var y=k.length-1;0<=y;y--){var S=Object.keys(w[k[y]]);for(v=S.length-1;0<=v;v--)h=S[v],a<=parseInt(h)&&(l=(parseInt(h)+n).toString(),w[k[y]][l]=w[k[y]][h]),a<=parseInt(h)&&parseInt(h)<parseInt(l)&&delete w[k[y]][h]}this.row(0,c),this.col(a,c),f.innerText="",this.totalWidth=this.totalWidth+p*n,this.recalculatePercentage(c)}},Workbook.prototype.editDelete=function(t,e,o,i,r){var s,a,n,h,l=0<=r?r:this.workbook.activeSheet,c=this.getActiveSheet(l),d=c.data.dataTable,g=Object.keys(d),p=0,f=0;h=0<=e?e:c.rangeRow1,p=0<=o?o:c.rangeCol1,f=1<=i?i:1;var u=c.spans,b=c.rows,w=c.columns;if(h+f>b.length&&(f=b.length-h),p+f>w.length&&(p=w.length-p),"F1ShiftRows"==t&&-1!=e&&b.length>=f){for(var k=f+h-1;h<=k;k--)b[k]&&(this.totalHeight=this.totalHeight-b[k].size,c.rows.splice(k,1));for(var v=u.length-1;0<=v;v--)for(var m=f+h-1;h<=m;m--)u[v].row<=m&&m<=u[v].rowCount+u[v].row-1?c.spans[v].rowCount-=1:u[v].row>m&&(c.spans[v].row-=1),(u[v].rowCount<1||u[v].colCount<1)&&c.spans.splice(v,1);for(var x=0;x<g.length;x++){a=g[x];for(var y=h;y<f+h;y++)y==parseInt(a)&&d[a]&&delete d[a];h+f-1<parseInt(a)&&(d[s=(parseInt(a)-f).toString()]=d[a],delete d[a])}var S=0<=c.activeCol?c.activeCol:0,C=0<=c.activeRow?c.activeRow:0;this.col(S,l),this.row(C,l),this.tempValue={},this.recalculatePercentage(l),c.rows<=0&&this.removeTextArea()}else if("F1ShiftCols"==t&&-1!=o&&w.length>=f){for(k=f+p-1;p<=k;k--)w[k]&&(this.totalWidth=this.totalWidth-w[k].size,c.columns.splice(k,1));for(y=u.length-1;0<=y;y--)for(m=f+p-1;p<=m;m--)u[y].col<=m&&m<=u[y].colCount+u[y].col-1?c.spans[y].colCount-=1:u[y].col>m&&(c.spans[y].col-=1),(u[y].colCount<1||u[y].rowCount<1)&&c.spans.splice(y,1);var H=c.colHeaderData.spans;if(H)for(var W=H.length-1;0<=W;W--)for(var A=f+p-1;p<=A;A--)H[W].col<=A&&A<=H[W].colCount+H[W].col-1?c.colHeaderData.spans[W].colCount-=1:H[W].col>m&&(c.colHeaderData.spans[W].col-=1),H[W].colCount<=1&&c.colHeaderData.spans.splice(W,1);for(var T=0;T<g.length;T++){n=Object.keys(d[g[T]]);for(k=0;k<n.length;k++)a=n[k],parseInt(a)>=p&&parseInt(a)<p+f&&parseInt(a)&&delete d[g[T]][a],p+f<=parseInt(a)&&(s=(parseInt(a)-f).toString(),d[g[T]][s]=d[g[T]][a],delete d[g[T]][a])}var R=0<=c.activeCol?c.activeCol:0,B=0<=c.activeRow?c.activeRow:0;this.col(R,l),this.row(B,l),this.tempValue={},this.recalculatePercentage(l),c.columns<=0&&this.removeTextArea()}},Workbook.prototype.editCopy=function(t,e,o,i,r){var s,a=0<=r?r:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.data.dataTable,l=n.spans,c=this.handleArg(t,e,o,i,a),d=c.r1,g=c.c1,p=c.r2,f=c.c2,u=this.workbook.behaviorMode;this.clipBoard=[];for(var b=d;b<=p;b++)for(var w=g;w<=f;w++)s=h[b]&&h[b][w]?h[b][w]:{},this.clipBoard.push(s);for(var k=0;k<l.length;k++)l[k].row>=d&&l[k].row<=p&&l[k].col>=g&&l[k].col<=f&&this.clipBoard.push(l[k]);var v=!!(this.isEdit&&-1!=n.rangeRow1&&-1!=n.rangeCol1||2==u||3==u);this.clipBoard.push({rangeRow:p-d,rangeCol:f-g,c1:g,r1:d,c2:f,r2:p,operation:"copy",isFocus:v})},Workbook.prototype.editCut=function(t,e,o,i,r){var s,a=0<=r?r:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.data.dataTable,l=n.spans,c=this.handleArg(t,e,o,i,a),d=c.r1,g=c.c1,p=c.r2,f=c.c2,u=this.workbook.behaviorMode;this.clipBoard=[];for(var b=d;b<=p;b++)for(var w=g;w<=f;w++)s=h[b]&&h[b][w]?h[b][w]:{},this.clipBoard.push(s);for(var k=l.length-1;0<=k;k--)l[k].row>=d&&l[k].row<=p&&l[k].col>=g&&l[k].col<=f&&this.clipBoard.push(l[k]);var v=!!(this.isEdit&&-1!=n.rangeRow1&&-1!=n.rangeCol||2==u||3==u);this.clipBoard.push({rangeRow:p-d,rangeCol:f-g,c1:g,r1:d,c2:f,r2:p,operation:"cut",isFocus:v})},Workbook.prototype.editPaste=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=r.data.dataTable,a=0,n=0,h=0,l=0,c=0,d=[],g=r.spans;document.querySelector("#"+this.boxId+" .child");if((a=0<=t?t:r.rangeRow1,(n=0<=e?e:r.rangeCol1)<0&&(n=0),a<0&&(a=0),!this.getLock(a,n,a,n))&&(this.clipBoard&&1<=this.clipBoard.length))if(this.clipBoard[this.clipBoard.length-1].isFocus)this.isEdit||this.setValue(a,n,this.clipBoardTxt);else{h=this.clipBoard[this.clipBoard.length-1].rangeRow,l=this.clipBoard[this.clipBoard.length-1].rangeCol;for(var p=g.length-1;0<=p;p--){if(a+h>=g[p].row&&a<g[p].row+g[p].rowCount&&n+l>=g[p].col&&n<g[p].col+g[p].colCount&&(0!=h||0!=l))this.getLock(g[p].row,g[p].col)||r.spans.splice(p,1)}for(var f=(h+1)*(l+1),u=this.clipBoard.length-1-1;f-1<u;u--)d.push(JSON.parse(JSON.stringify(this.clipBoard[u])));for(var b=this.clipBoard[this.clipBoard.length-1].r1,w=this.clipBoard[this.clipBoard.length-1].c1,k=this.clipBoard[this.clipBoard.length-1].r2,v=this.clipBoard[this.clipBoard.length-1].c2,m=this.clipBoard[this.clipBoard.length-1].operation,x=g.length-1;0<=x;x--)g[x].row>=b&&g[x].row<=k&&g[x].col>=w&&g[x].col<=v&&"cut"==m&&r.spans.splice(x,1);for(var y=b;y<=k;y++){for(var S=w;S<=v;S++)s[y]&&s[y][S]&&"cut"==m&&(s[y][S].style&&s[y][S].style.lock||delete s[y][S]);s[y]&&0==Object.keys(s[y]).length&&"cut"==m&&delete s[y]}for(var C=0;C<d.length;C++){d[C].row=a+d[C].row-b,d[C].col=n+d[C].col-w;for(p=d[C].row+d[C].rowCount-1;p>=d[C].row;p--)for(u=d[C].col+d[C].colCount;u>=d[C].col;u--)s[p]&&s[p][u]&&s[p][u].style&&s[p][u].style.lock&&(d[C].rowCount=1<=p-d[C].col?p-d[C].row:1,d[C].colCount=1<=u-d[C].col?u-d[C].col:1);d[C].colCount<=1&&d[C].rowCount<=1||r.spans.push(d[C])}var H=0,W=0;H=a+h>r.rows.length-1?r.rows.length-1:a+h,W=n+l>r.columns.length-1?r.columns.length-1:n+l;for(var A=a;A<=H;A++){for(var T=n;T<=W;T++)if(s[A]&&s[A][T]&&s[A][T].style&&s[A][T].style.lock)c+=1;else{var R={};R[T]={},this.clipBoard&&s[A]?s[A][T]=JSON.parse(JSON.stringify(this.clipBoard[c])):this.clipBoard&&!s[A]&&(s[A]=R,s[A][T]=JSON.parse(JSON.stringify(this.clipBoard[c]))),c+=1,"{}"===JSON.stringify(s[A][T])&&delete s[A][T]}s[A]&&0==Object.keys(s[A]).length&&delete s[A]}}},Workbook.prototype.clearText=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=a.data.dataTable,p=h;p<=c;p++)for(var f=l;f<=d;f++){var u=this.getCellStatus(p,f),b=u.isCheckBox,w=u.isCanEdit,k=u.isLock;if(!b&&!k&&!1!==w&&g[p]&&g[p][f]){var v=g[p][f];v.hasOwnProperty("value")&&(v.value=""),v.hasOwnProperty("text")&&(v.text="")}}},Workbook.prototype.deleteText=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=a.data.dataTable,p=h;p<=c;p++)for(var f=l;f<=d;f++){var u=this.getCellStatus(p,f),b=u.isCheckBox,w=u.isCanEdit,k=u.isLock;if(!b&&!k&&!1!==w&&g[p]&&g[p][f]){var v=g[p][f];v.hasOwnProperty("value")&&delete v.value,v.hasOwnProperty("text")&&delete v.text}}},Workbook.prototype.deleteCell=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=a.data.dataTable,p=h;p<=c;p++){for(var f=l;f<=d;f++)g[p]&&g[p][f]&&g[p][f]&&delete g[p][f];g[p]&&0==Object.keys(g[p]).length&&delete g[p]}},Workbook.prototype.setRowHeight=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r);if(void 0===o&&(o=e),-1!=e)for(var a=e;a<=o;a++)s.rows[a]&&!s.rows[a].bHidden&&(this.totalHeight-=s.rows[a].size,t<=0?(s.rows[a].size=0,s.rows[a].bHidden=!0):s.rows[a].size=t,this.totalHeight+=s.rows[a].size,this.setNoDefaultH(a,r));this.recalculatePercentage(r)},Workbook.prototype.setColWidth=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r);if(null==o&&(o=e),-1!=e)for(var a=e;a<=o;a++)s.columns[a]&&!s.columns[a].bHidden&&(this.totalWidth-=s.columns[a].size,t<=0?(s.columns[a].size=0,s.columns[a].bHidden=!0):s.columns[a].size=t),this.totalWidth+=s.columns[a].size,this.setNoDefaultW(a,r);this.recalculatePercentage(r)},Workbook.prototype.setHAlignment=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=r||1,h=this.getActiveSheet(a).data.dataTable,l=t;l<=o;l++)for(var c=e;c<=i;c++)this.createData(l,c,a),h[l]&&h[l][c]&&h[l][c].style&&(h[l][c].style.hAlign=n)},Workbook.prototype.setVAlignment=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=r||2,h=this.getActiveSheet(a).data.dataTable,l=t;l<=o;l++)for(var c=e;c<=i;c++)this.createData(l,c,a),h[l]&&h[l][c]&&h[l][c].style&&(h[l][c].style.vAlign=n)},Workbook.prototype.getAlignment=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b={};a[f]&&a[f][u]&&a[f][u].style&&(b.r=f,b.c=u,a[f][u].style.hAlign&&(b.hAlign=a[f][u].style.hAlign),a[f][u].style.vAlign&&(b.vAlign=a[f][u].style.vAlign),n.push(b))}return(l==d&&c==g||p)&&1==n.length?n[0]:l==d&&c==g||p?void 0:n},Workbook.prototype.fontColor=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=r||"black",h=this.getActiveSheet(a).data.dataTable,l=t;l<=o;l++)for(var c=e;c<=i;c++)this.createData(l,c,a),h[l]&&h[l][c]&&h[l][c].style&&(h[l][c].style.fontColor=n)},Workbook.prototype.getFontColor=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.fontColor&&(b=a[f][u].style.fontColor,n.push({r:f,c:u,fontColor:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].fontColor:l==d&&c==g||p?void 0:n},Workbook.prototype.setFontItalic=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0===r||r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)if(this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&n[f][u].style.font){var b=this.getFontList(f,u,a),w=b.originName,k=b.originSize,v=b.originHeight,m=b.originBold;m&&h?n[f][u].style.font="italic bold "+k+"px/"+v+"px "+w:m&&!h?n[f][u].style.font="bold "+k+"px/"+v+"px "+w:!m&&h?n[f][u].style.font="italic "+k+"px/"+v+"px "+w:m||h||(n[f][u].style.font=k+"px/"+v+"px "+w)}},Workbook.prototype.setFontBold=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0===r||r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)if(this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&n[f][u].style.font){var b=this.getFontList(f,u,a),w=b.originName,k=b.originSize,v=b.originHeight,m=b.originItalic;h&&m?n[f][u].style.font="italic bold "+k+"px/"+v+"px "+w:h&&!m?n[f][u].style.font="bold "+k+"px/"+v+"px "+w:!h&&m?n[f][u].style.font="italic "+k+"px/"+v+"px "+w:h||m||(n[f][u].style.font=k+"px/"+v+"px "+w)}},Workbook.prototype.setFontLineH=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.data.dataTable,l=n.rows,c=parseInt(n.cellPadding.bottom),d=parseInt(n.cellPadding.top),g=n.defaults.rowHeight,p=t;p<=o;p++)for(var f=e;f<=i;f++)if(this.createData(p,f,a),h[p]&&h[p][f]&&h[p][f].style&&h[p][f].style.font){var u=this.getFontList(p,f,a),b=u.originName,w=u.originSize,k=u.originHeight,v=u.originBold,m=u.originItalic,x=r||k;if(v&&m?h[p][f].style.font="italic bold "+w+"px/"+x+"px "+b:v&&!m?h[p][f].style.font="bold "+w+"px/"+x+"px "+b:!v&&m?h[p][f].style.font="italic "+w+"px/"+x+"px "+b:v||m||(h[p][f].style.font=w+"px/"+x+"px "+b),l[p]&&!l[p].noDefaultH)if(this.getWordWrap(p,f,p,f,a))this.incrementRowheight(p,f,a);else{var y=g<x?x+c+d:g;this.setRowHeight(y,p,p,a)}}},Workbook.prototype.setFontSize=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.rows,l=n.data.dataTable,c=parseInt(r),d=n.defaults.rowHeight,g=parseInt(n.cellPadding.bottom),p=parseInt(n.cellPadding.top),f=t;f<=o;f++)for(var u=e;u<=i;u++)if(this.createData(f,u,a),l[f]&&l[f][u]&&l[f][u].style&&l[f][u].style.font){var b=this.getFontList(f,u,a),w=b.originName,k=b.originSize,v=b.originHeight,m=b.originBold,x=b.originItalic;c=r||k;if(h[f]&&!h[f].noDefaultH&&(v+=c-k),m&&x?l[f][u].style.font="italic bold "+c+"px/"+v+"px "+w:m&&!x?l[f][u].style.font="bold "+c+"px/"+v+"px "+w:!m&&x?l[f][u].style.font="italic "+c+"px/"+v+"px "+w:m||x||(l[f][u].style.font=c+"px/"+v+"px "+w),h[f]&&!h[f].noDefaultH)if(this.getWordWrap(f,u,f,u,a))this.incrementRowheight(f,u,a);else{var y=d<v?v+g+p:d;this.setRowHeight(y,f,f,a)}}this.recalculatePercentage(a)},Workbook.prototype.setFontName=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=t;h<=o;h++)for(var l=e;l<=i;l++)if(this.createData(h,l,a),n[h]&&n[h][l]&&n[h][l].style&&n[h][l].style.font){var c=this.getFontList(h,l,a),d=c.originName,g=c.originSize,p=c.originHeight,f=c.originBold,u=c.originItalic,b=r||d;f&&u?n[h][l].style.font="italic bold "+g+"px/"+p+"px "+b:f&&!u?n[h][l].style.font="bold "+g+"px/"+p+"px "+b:!f&&u?n[h][l].style.font="italic "+g+"px/"+p+"px "+b:f||u||(n[h][l].style.font=g+"px/"+p+"px "+b)}},Workbook.prototype.getFontList=function(t,e,o){var i,r,s,a,n=0<=o?o:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable;if(h[t]&&h[t][e]&&h[t][e].style&&h[t][e].style.font)try{var l=h[t][e].style.font.trim().split(/\s+/),c=l[l.length-1]||this.workbook.defaultFontName,d=l[l.length-2].split("/");s=parseFloat(d[0])||this.workbook.defaultFontSize,a=parseFloat(d[1])||this.workbook.defaultLineHeight,"italic"!=l[l.length-3]&&"italic"!=l[l.length-4]||(i="italic"),"bold"==l[l.length-3]&&(r="bold")}catch(t){}return{originName:c,originSize:s,originHeight:a,originBold:r,originItalic:i}},Workbook.prototype.getFont=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.font&&(b=a[f][u].style.font,n.push({r:f,c:u,font:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].font:l==d&&c==g||p?void 0:n},Workbook.prototype.clearAllBorder=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=h;g<=c;g++)for(var p=l;p<=d;p++)a[g]&&a[g][p]&&a[g][p].style&&(a[g][p].style.borderLeft&&delete a[g][p].style.borderLeft,a[g][p].style.borderRight&&delete a[g][p].style.borderRight,a[g][p].style.borderBottom&&delete a[g][p].style.borderBottom,a[g][p].style.borderTop&&delete a[g][p].style.borderTop)},Workbook.prototype.setOutBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)if(this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style){var k=this.getMergeCount(b,w,n),v=k.rowCount-1,m=k.colCount-1;w==p&&(h[b][w].style.borderLeft={color:l,style:c}),w+m==u&&(h[b][w].style.borderRight={color:l,style:c}),b==g&&(h[b][w].style.borderTop={color:l,style:c}),b+v==f&&(h[b][w].style.borderBottom={color:l,style:c})}},Workbook.prototype.setINnerBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)if(this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style){var k=this.getMergeCount(b,w,n),v=k.rowCount-1,m=k.colCount-1;w!=p&&(h[b][w].style.borderLeft={color:l,style:c}),w+m!=u&&(h[b][w].style.borderRight={color:l,style:c}),b!=g&&(h[b][w].style.borderTop={color:l,style:c}),b+v!=f&&(h[b][w].style.borderBottom={color:l,style:c})}},Workbook.prototype.setAllBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style&&(h[b][w].style.borderLeft={color:l,style:c},h[b][w].style.borderRight={color:l,style:c},h[b][w].style.borderBottom={color:l,style:c},h[b][w].style.borderTop={color:l,style:c})},Workbook.prototype.setBottomBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style&&(h[b][w].style.borderBottom={color:l,style:c})},Workbook.prototype.setTopBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style&&(h[b][w].style.borderTop={color:l,style:c})},Workbook.prototype.setRightBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style&&(h[b][w].style.borderRight={color:l,style:c})},Workbook.prototype.setLeftBorder=function(t,e,o,i,r,s,a){for(var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n).data.dataTable,l=s||"black",c=r||1,d=this.handleArg(t,e,o,i,n),g=d.r1,p=d.c1,f=d.r2,u=d.c2,b=g;b<=f;b++)for(var w=p;w<=u;w++)this.createData(b,w,n),h[b]&&h[b][w]&&h[b][w].style&&(h[b][w].style.borderLeft={color:l,style:c})},Workbook.prototype.getBorder=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b={};a[f]&&a[f][u]&&a[f][u].style&&(b.r=f,b.c=u,a[f][u].style.borderLeft&&(b.borderLeft=a[f][u].style.borderLeft),a[f][u].style.borderRight&&(b.borderRight=a[f][u].style.borderRight),a[f][u].style.borderTop&&(b.borderTop=a[f][u].style.borderTop),a[f][u].style.borderBottom&&(b.borderBottom=a[f][u].style.borderBottom),(b.borderLeft||b.borderRight||b.borderTop||b.borderBottom)&&n.push(b))}return(l==d&&c==g||p)&&1==n.length?n[0]:l==d&&c==g||p?void 0:n},Workbook.prototype.col=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=parseInt(t);return-1<=r&&(i.activeCol=r,i.rangeCol1=r,i.rangeCol2=i.rangeCol1,i.spans.forEach(function(t){t.row<=i.rangeRow1&&i.rangeRow1<t.row+t.rowCount&&i.rangeCol1>=t.col&&i.rangeCol1<t.colCount+t.col&&(i.rangeCol1=t.col,i.activeCol=t.col,i.rangeCol2=t.col+t.colCount-1,i.rangeRow1=t.row,i.activeRow=t.row,i.rangeRow2=t.row+t.rowCount-1)}),-1==i.rangeCol1&&(i.rangeCol2=i.columns.length-1)),i.activeCol},Workbook.prototype.row=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=parseInt(t);return-1<=r&&(i.activeRow=r,i.rangeRow1=r,i.rangeRow2=i.rangeRow1,i.spans.forEach(function(t){t.row<=i.rangeRow1&&i.rangeRow1<t.row+t.rowCount&&i.rangeCol1>=t.col&&i.rangeCol1<t.colCount+t.col&&(i.rangeRow1=t.row,i.activeRow=t.row,i.rangeRow2=t.row+t.rowCount-1,i.rangeCol2=t.col+t.colCount-1,i.activeCol=t.col,i.rangeCol1=t.col)}),-1==i.rangeRow1&&(i.rangeRow2=i.rows.length-1)),i.activeRow},Workbook.prototype.setActiveEditCell=function(t,e){var o=parseInt(t),i=parseInt(e);0<=o&&0<=i&&(this.row(o),this.col(i),this.tempValue={},this.isEdit=!0,this.incanvasPath=!0,this.eButton=0,this.startPaint())},Workbook.prototype.fontStrikeout=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0===r||r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&(n[f][u].style.fontStrikeout=h)},Workbook.prototype.getFontStrikeout=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.hasOwnProperty("fontStrikeout")&&(b=a[f][u].style.fontStrikeout,n.push({r:f,c:u,fontStrikeout:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].fontStrikeout:l==d&&c==g||p?void 0:n},Workbook.prototype.fontUnderline=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0===r||r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&(n[f][u].style.fontUnderline=h)},Workbook.prototype.getFontUnderline=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.hasOwnProperty("fontUnderline")&&(b=a[f][u].style.fontUnderline,n.push({r:f,c:u,fontUnderline:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].fontUnderline:l==d&&c==g||p?void 0:n},Workbook.prototype.getValue=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&(b=a[f][u].value,n.push({r:f,c:u,value:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].value:l==d&&c==g||p?void 0:n},Workbook.prototype.getText=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;if(a[f]&&a[f][u]){var w=a[f][u];if(w.hasOwnProperty("text"))b=a[f][u].text;else if(!w.hasOwnProperty("text")&&w.hasOwnProperty("value")){var k=w.value;"object"==(void 0===k?"undefined":_typeof(k))?b=JSON.stringify(k):null!=k&&(b=k.toString())}n.push({r:f,c:u,text:b})}}return(l==d&&c==g||p)&&1==n.length?n[0].text:l==d&&c==g||p?void 0:n},Workbook.prototype.hdrHeight=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o);0<t?i.colHeaderData.defaultH=t:(i.colHeaderData.showColHeading=!1,i.colHeaderData.defaultH=0),this.recalculatePercentage(o)},Workbook.prototype.hdrWidth=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o);0<t?i.rowHeaderData.defaultW=t:(i.rowHeaderData.showRowHeading=!1,i.rowHeaderData.defaultW=0),this.recalculatePercentage(o)},Workbook.prototype.showColHeading=function(t,e){var o=0<=e?e:this.workbook.activeSheet;this.getActiveSheet(o).colHeaderData.showColHeading=t,this.recalculatePercentage(o)},Workbook.prototype.showRowHeading=function(t,e){var o=0<=e?e:this.workbook.activeSheet;this.getActiveSheet(o).rowHeaderData.showRowHeading=t,this.recalculatePercentage(o)},Workbook.prototype.setDefaultFontName=function(t){this.workbook.defaultFontName=t,this._defaultCellStyle.font=this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName},Workbook.prototype.setDefaultFontSize=function(t){this.workbook.defaultFontSize=t,this._defaultCellStyle.font=this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName},Workbook.prototype.setDefaultLineHeight=function(t){this.workbook.defaultLineHeight=t,this._defaultCellStyle.font=this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName},Workbook.prototype.setRowHidden=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r),a=s.rows;if(o)for(var n=t;n<=e;n++)a[n]&&!a[n].bHidden&&(s.rows[n].bHidden=!0,s.rows[n].tempSize=a[n].size,this.totalHeight=this.totalHeight-a[n].size,s.rows[n].size=0);else for(var h=0;h<=a.length-1;h++)a[h].bHidden&&h<=e&&t<=h&&(delete s.rows[h].bHidden,s.rows[h].size=a[h].tempSize,this.totalHeight=this.totalHeight+a[h].size,delete s.rows[h].tempSize);this.recalculatePercentage(r)},Workbook.prototype.setColHidden=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r),a=s.columns;if(o)for(var n=t;n<=e;n++)a[n]&&!a[n].bHidden&&(s.columns[n].bHidden=!0,s.columns[n].tempSize=a[n].size,this.totalWidth=this.totalWidth-a[n].size,s.columns[n].size=0);else for(var h=0;h<=a.length-1;h++)a[h].bHidden&&h<=e&&t<=h&&(delete s.columns[h].bHidden,s.columns[h].size=a[h].tempSize,this.totalWidth=this.totalWidth+a[h].size,delete s.columns[h].tempSize);this.recalculatePercentage(r)},Workbook.prototype.mergeCells=function(t,e,o,i,r){var s,a,n=0<=r?r:this.workbook.activeSheet,h=this.getActiveSheet(n),l=h.spans,c=this.handleArg(t,e,o,i,n),d=c.r1,g=c.c1,p=c.r2,f=c.c2;s=p-d+1,a=f-g+1;for(var u=p;d<=u;u--)for(var b=f;g<=b;b--)for(var w=l.length-1;0<=w;w--)l[w].row==u&&l[w].col==b&&h.spans.splice(w,1);if(d!=p||g!=f){h.spans.push({row:d,rowCount:s,col:g,colCount:a});for(var k=d;k<d+s;k++)for(var v=g;v<g+a;v++)(k!=d||v!=g)&&h.data.dataTable[k]&&h.data.dataTable[k][v]&&delete h.data.dataTable[k][v]}},Workbook.prototype.removeMergeCells=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.spans,h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=d;l<=p;p--)for(var f=g;c<=f;f--)for(var u=n.length-1;0<=u;u--)n[u].row==p&&n[u].col==f&&a.spans.splice(u,1)},Workbook.prototype.fixedRowAndCol=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.rows,h=a.columns;t>n.length&&(t=n.length),e>h.length&&(e=h.length);var l=o||0,c=i||0;if(l>n.length-1&&(l=n.length-1),c>h.length-1&&(c=h.length-1),(0<a.fixedRows||0<a.fixedCols)&&this.removeFixed(s),0<=t&&0<=e){var d=0<t?t:0,g=0<t?l:0,p=0<e?e:0,f=0<e?c:0,u=0<t?this.getHideWH(l,0,s).hideH:0,b=0<e?this.getHideWH(0,c,s).hideW:0;if(0<t&&d<=g||0<e&&p<=f)return;a.fixed.fixedRows=d,a.fixed.fixedCols=p,a.fixed.fixedRow=g,a.fixed.fixedCol=f,a.fixed.hideH=u,a.fixed.hideW=b}this.getStartAndEnd(s)},Workbook.prototype.fixedFirstRow=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=t||0,s=i.rows;r>s.length-1&&(r=s.length-1);var a=this.getHideWH(r,0,o).hideH;i.fixed.fixedRows=r+1,i.fixed.fixedRow=r,i.fixed.fixedCols=0,i.fixed.fixedCol=0,i.fixed.hideW=0,i.fixed.fixedW=0,i.fixed.hideH=a,this.getStartAndEnd(o)},Workbook.prototype.fixedFirstCol=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.columns,s=t||0;s>r.length-1&&(s=r.length-1);var a=this.getHideWH(0,s,o).hideW;i.fixed.fixedCols=s+1,i.fixed.fixedCol=s,i.fixed.fixedRows=0,i.fixed.fixedRow=0,i.fixed.hideH=0,i.fixed.fixedH=0,i.fixed.hideW=a,this.getStartAndEnd(o)},Workbook.prototype.removeFixed=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e);o.fixed.fixedRows=0,o.fixed.fixedCols=0,o.fixed.fixedRow=0,o.fixed.fixedCol=0,o.fixed.fixedH=0,o.fixed.hideH=0,o.fixed.fixedW=0,o.fixed.hideW=0,this.getStartAndEnd(e)},Workbook.prototype.getHideWH=function(t,e,o){for(var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=e||r.fixed.fixedCol,a=t||r.fixed.fixedRow,n=r.rows,h=r.columns,l=0,c=0,d=0;d<a;d++)n[d]&&(l+=n[d].size);for(var g=0;g<s;g++)h[g]&&(c+=h[g].size);return{hideH:l,hideW:c}},Workbook.prototype.getFixToStart=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.fixed.fixedRows,r=o.fixed.fixedCols,s=o.startRow,a=o.startCol,n=o.rows,h=o.columns,l=0,c=0;if(0!=i)for(var d=i;d<s;d++)n[d]&&(l+=n[d].size);if(0!=r)for(d=r;d<a;d++)h[d]&&(c+=h[d].size);return{fHideH:l,fHideW:c}},Workbook.prototype.getFixedWH=function(t){for(var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.fixed.fixedRow,r=o.fixed.fixedRows,s=o.fixed.fixedCol,a=o.fixed.fixedCols,n=o.rows,h=o.columns,l=0,c=0,d=i;d<r;d++)n[d]&&(l+=n[d].size);for(var g=s;g<a;g++)h[g]&&(c+=h[g].size);return o.fixed.fixedH=l,o.fixed.fixedW=c,{fixedH:o.fixed.fixedH,fixedW:o.fixed.fixedW}},Workbook.prototype.showFixedLine=function(t,e){var o=0<=e?e:this.workbook.activeSheet;this.getActiveSheet(o).showFixedLine=t},Workbook.prototype.setHeaderName=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r),a=s.rows,n=s.columns;-1==e&&0<=t&&a[t]&&(a[t].name=o),-1==t&&1<=e&&n[e]&&(n[e].name=o)},Workbook.prototype.deleteHeaderNames=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=r.rows,a=r.columns;0<=t&&s[t]&&s[t].hasOwnProperty("name")&&delete s[t].name,0<=e&&a[e]&&a[e].hasOwnProperty("name")&&delete a[e].name},Workbook.prototype.getStartAndEnd=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.scrollOption.coordY,r=o.scrollOption.coordX,s=0,a=0,n=0,h=0,l=o.columns,c=o.rows,d=o.fixed.hideW,g=o.fixed.hideH,p=(i/this.percentageV).toFixed(2)-0,f=(r/this.percentageH).toFixed(2)-0,u=this.getFixedWH(e),b=u.fixedW,w=u.fixedH,k=this.getYMaxScroll(),v=this.getXMaxScroll();k<=i&&this.totalHeight+this.numRowH>this.height?this.addHeight=this.tabsHeight:this.addHeight=0;for(var m=0;m<l.length;m++)if(f+b+d<(s+=l[m].size)){o.startCol=m;break}for(var x=0;x<c.length;x++)if(a+=c[x].size,p+w+g+this.addHeight<a){o.startRow=x;break}for(var y=0;y<l.length;y++){if(n+=l[y].size,this.width-this.numColW+f+d<=n){o.endCol=y;break}o.endCol=l.length-1}for(var S=0;S<c.length;S++){if(h+=c[S].size,this.height-this.numRowH+p+g<=h){o.endRow=S;break}o.endRow=c.length-1}var C=o.startCol,H=o.startRow,W=o.endCol,A=o.endRow,T=0,R=0;if(k<=i&&this.totalHeight+this.numRowH>this.height&&0<i){for(var B=H;B<=A;B++)c[B]&&(R+=c[B].size);o.scrollOption.offsetY=R+this.numRowH+w-this.height+this.tabsHeight}else o.scrollOption.offsetY=0;if(v<=r&&this.totalWidth+this.numColW>this.width&&0<r){for(var O=C;O<=W;O++)l[O]&&(T+=l[O].size);o.scrollOption.offsetX=T+this.numColW+b-this.width}else o.scrollOption.offsetX=0;return{startRow:o.startRow,startCol:o.startCol,endRow:o.endRow,endCol:o.endCol}},Workbook.prototype.setScrollPosition=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i),s=this.getTotalAndPercent();this.totalHeight=s.totalHeight,this.totalWidth=s.totalWidth,this.percentageV=s.percentageV,this.percentageH=s.percentageH,r.scrollOption.coordY=(e*this.percentageV).toFixed(5)-0,r.scrollOption.totalY=(e*this.percentageV).toFixed(5)-0,r.scrollOption.coordX=(t*this.percentageH).toFixed(5)-0,r.scrollOption.totalX=(t*this.percentageH).toFixed(5)-0;var a=this.getYMaxScroll(),n=this.getXMaxScroll();r.scrollOption.coordY>=a&&(r.scrollOption.coordY=a,r.scrollOption.totalY=a),(r.scrollOption.coordY<0||1<=this.percentageV)&&(r.scrollOption.coordY=0,r.scrollOption.totalY=0),r.scrollOption.coordX>=n&&(r.scrollOption.coordX=n,r.scrollOption.totalX=n),(r.scrollOption.coordX<0||1<=this.percentageH)&&(r.scrollOption.coordX=0,r.scrollOption.totalX=0)},Workbook.prototype.setFillColor=function(t,e,o,i,r,s){var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=this.handleArg(e,o,i,r,a),l=h.r1,c=h.c1,d=h.r2,g=h.c2;if(t)for(var p=l;p<=d;p++)for(var f=c;f<=g;f++)this.createData(p,f,a),n[p]&&n[p][f]&&n[p][f].style&&(n[p][f].style.bgColor=t)},Workbook.prototype.getFillColor=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.bgColor&&(b=a[f][u].style.bgColor,n.push({r:f,c:u,bgColor:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].bgColor:l==d&&c==g||p?void 0:n},Workbook.prototype.setRowColor=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r),a=s.data.dataTable,n=s.rows.length-1,h=s.columns.length-1,l=s.startRow;s.rowStyle={color:t||"rgb(255,255,224)",oddEven:e||0,start:o||0};var c=0==s.rowStyle.start?0:l;if(0==s.rowStyle.oddEven||1==s.rowStyle.oddEven)for(var d=c;d<=n;d++)if(!(d%2!=0&&0==s.rowStyle.oddEven||d%2==0&&1==s.rowStyle.oddEven))for(var g=0;g<=h;g++)this.createData(d,g,r),a[d]&&a[d][g]&&a[d][g].style&&(a[d][g].style.bgColor=s.rowStyle.color)},Workbook.prototype.removeRowColor=function(t){for(var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.data.dataTable,r=o.rows.length-1,s=o.columns.length-1,a=o.startRow,n=0==o.rowStyle.start?0:a;n<=r;n++)if(!(n%2!=0&&0==o.rowStyle.oddEven||n%2==0&&1==o.rowStyle.oddEven))for(var h=0;h<=s;h++)i[n]&&i[n][h]&&i[n][h].style&&delete i[n][h].style.bgColor},Workbook.prototype.deleteFillColor=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=h;g<=c;g++)for(var p=l;p<=d;p++)a[g]&&a[g][p]&&a[g][p].style&&delete a[g][p].style.bgColor},Workbook.prototype.setCanvasInput=function(t,e,o,i,r,s){var a,n=this.activeSheet.data.dataTable,h=document.querySelector("#"+this.boxId+" .textarea"),l="left",c="middle",d=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/,g=this.getFont(r,s,r,s)||this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName,p=this.getAlignment(r,s,r,s);if(p&&p.hAlign){var f=p.hAlign;l=2==f?"left":3==f?"center":4==f?"right":"left";var u=this.getValue(r,s,r,s);1==f&&d.test(u)?l="right":1!=f||d.test(u)||(l="left")}if(p&&p.vAlign){var b=p.vAlign;c=1==b?"top":2==b?"middle":3==b?"bottom":"middle"}var w=this.getFontColor(r,s,r,s)||"#000",k=this.getFillColor(r,s,r,s)||"#FFF",v=this.getWordWrap(r,s,r,s),m=this.getFontUnderline(r,s,r,s),x=this.getFontStrikeout(r,s,r,s);a=m&&!x?"underline":!m&&x?"line-through":m&&x?"underline line-through":"none";var y=v?"word-break:break-all":"white-space:nowrap",S=this.isHasHBar(),C=this.isHasVBar(),H=S&&this.isShowBar?this.scrollSize:0,W=C&&this.isShowBar?this.scrollSize:0,A=this.verticalLine<this.height?0:this.tabsHeight;o+e>=this.verticalLine-A-H&&(e=this.verticalLine-A-H-o),i+t>this.horizontalLine-W&&(t=this.horizontalLine-W-i),h&&(h.style.cssText="top:"+o+"px;left:"+i+"px;max-height:"+e+"px;max-width:"+t+"px;position:absolute;overflow:hidden;",h.setAttribute("r",r),h.setAttribute("c",s),document.querySelector("#"+this.boxId+" .child").style.cssText=y+";min-width:"+t+"px;max-width:"+t+"px;height:"+e+"px;font:"+g+";display:table-cell;overflow:hidden;vertical-align:"+c+";background:"+k+";text-align:"+l+";color:"+w+";text-decoration:"+a+";box-sizing:border-box;user-select:text;-moz-user-select:text;-webkit-user-select:text;-ms-user-select:text"),(o>this.height-this.tabsHeight-this.scrollSize||i>this.width-this.scrollSize||e<=0||t<=0)&&(h.style.display="none");var T=document.querySelector("#"+this.boxId+" .child");T.focus();var R=h.getAttribute("r"),B=h.getAttribute("c"),O="";if(0<=this.tempValue.r&&0<=this.tempValue.c)O=T.innerText;else if(n[R]&&n[R][B]){var N=n[R][B];N.text?O=N.text:!N.hasOwnProperty("text")&&N.hasOwnProperty("value")&&("object"==_typeof(N.value)?O=JSON.stringify(N.value):null!==N.value&&void 0!==N.value&&(O=N.value.toString()))}var E,F=O.length,L=this.getCellFormula(R,B,R,B),I=this.getCellFormat(R,B,R,B);L&&"text"!=I&&(O=L),T.innerText=O,"function"==typeof this.onshoweditor&&0==this.workbook.stopEventCount&&(this.editSelStart=-1,this.onshoweditor(T)),this.editSelStart<0?(this.editSelStart=0,this.editSelEnd=F):this.editSelEnd<0&&(this.editSelEnd=F),this.editSelStart>this.editSelEnd&&(E=this.editSelEnd,this.editSelEnd=this.editSelStart,this.editSelStart=E),this.editSelStart=this.editSelStart>F?F:this.editSelStart,this.editSelEnd=this.editSelEnd>F?F:this.editSelEnd;var D=T.firstChild,P=!1;if(D&&3==D.nodeType&&(this.editSelStart>D.nodeValue.length||this.editSelEnd>D.nodeValue.length)&&(P=!0),D&&1==D.nodeType&&(P=!0),window.getSelection&&D){var z=window.getSelection();M=(M=document.createRange()).cloneRange(),"function"!=typeof this.onshoweditor||P?(M.selectNodeContents(D),M.collapse(!1)):(M.setStart(D,this.editSelStart),M.setEnd(D,this.editSelEnd)),z.removeAllRanges(),z.addRange(M)}else if(document.selection&&D){var M,V=this.editSelEnd-F;(M=document.selection.createRange()).moveToElementText(T),"function"==typeof this.onshoweditor&!P?(M.moveStart("character",this.editSelStart),M.moveEnd("character",V)):M.collapse(!1),M.select()}this.tempValue={r:r,c:s}},Workbook.prototype.removeTextArea=function(t){var e=document.querySelector("#"+this.boxId+" .textarea"),o=this.getActiveSheet(),i=o.rangeRow1,r=o.rangeCol1,s=document.querySelector("#"+this.boxId+" .child"),a=this.workbook.behaviorMode;this.keyDownCount=!0,this.endEdit(t),e&&(e.style.cssText="top:0px;left:0px;max-height:0px;max-width:0px;overflow:hidden;position:absolute",e.setAttribute("r",i),e.setAttribute("c",r)),s&&(s.focus(),s.style.cssText="height:0px;width:0px;overflow:hidden"),2==a||3==a?(this.isEdit=!0,this.isFocus=!0):(this.isEdit=!1,this.isFocus=!1),this.tempValue={}},Workbook.prototype.endEdit=function(t){var e=this.getActiveSheet(),o=document.querySelector("#"+this.boxId+" .child"),i=e.data.dataTable,r=e.rows;if(t&&13==t.keyCode&&this.stopDefault(t),0<=this.tempValue.r&&0<=this.tempValue.c){var s=this.tempValue.r,a=this.tempValue.c;if(o.innerText!=this.getValue(s,a)&&(0!=o.innerText.length&&this.createData(s,a),i[s]&&i[s][a]&&i[s][a].style)){if(r[s]&&!r[s].noDefaultH)this.getWordWrap(s,a,s,a)&&this.incrementRowheight(s,a);var n=this.getCellFormat(s,a),h=this.getAlignment(s,a).hAlign,l=this.checkInputType(n,o.innerText,h,s,a);void 0!==l.v&&null!==l.v&&this.setValue(s,a,l.v),l.t&&this.setText(s,a,l.t),l.f&&this.setCellFormula(s,a,l.f),l.format&&this.setCellFormat(s,a,s,a,l.format),l.hAlign&&this.setHAlignment(s,a,s,a,l.hAlign),(0==o.innerText.length||!/^=.+/.test(o.innerText)&&i[s][a].formula)&&delete i[s][a].formula}}},Workbook.prototype.checkInputType=function(t,e,o,i,r){var s,a,n,h,l,c=this.onformularesult;if("text"==t)s=e;else if(/^=.+/.test(e))n=e,"function"==typeof c&&0==this.workbook.stopEventCount&&(s=c(n,i,r)),"conflict"==s&&(n=s="");else{/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/.test(s=e)&&(s=Number(e)),"false"==e&&(s=!1),"true"==e&&(s=!0);var d=this.getFullData(e);if("Array"==this.typeObj(d)){var g=d[3],p=d[4]||"/";s=parseInt(this.jsDateToExcelDate(new Date(d[0]+"-"+d[1]+"-"+d[2]))),a=this.excelDateToJSDate(Number(s),p),h=t||g,2!=o&&3!=o&&(l=4)}}return{v:s,t:a,f:n,format:h,hAlign:l}},Workbook.prototype.excelDateToJSDate=function(t,e){var o=60*(new Date).getTimezoneOffset()*1e3,i=new Date(36e5*(t-25569)*24+o);return i.setYear(i.getFullYear()),i.getFullYear()+(e=e||"-")+(i.getMonth()+1)+e+i.getDate()},Workbook.prototype.jsDateToExcelDate=function(t){return(t.getTime()-new Date(1899,11,30).getTime())/1e3/60/60/24},Workbook.prototype.setCellFormula=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r).data.dataTable,a="";if(/^=.+/.test(o)){if(this.createData(t,e,r),"function"==typeof this.onvaluechange&&0==this.workbook.stopEventCount&&"-1"==(a=this.onvaluechange(t,e,o,s[t][e].formula)))return;var n=this.onformularesult;if(s[t]&&s[t][e]&&0==this.workbook.stopEventCount){s[t][e].formula=o;var h=s[t][e].formula;if("text"!=s[t][e].style.formatter&&"function"==typeof n){var l=n(h,t,e);this.setValue(t,e,l)}}"1"==a&&"function"==typeof this.onrelevantchange&&this.onrelevantchange(t,e)}},Workbook.prototype.getCellFormula=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].formula&&(b=a[f][u].formula,n.push({r:f,c:u,formula:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].formula:l==d&&c==g||p?void 0:n},Workbook.prototype.initTextArea=function(){var t=document.createElement("div"),e=document.createElement("div");t.style.cssText="top:0px;left:0px;max-height:0px;max-width:0px;overflow:hidden;",t.setAttribute("class","textarea"),t.setAttribute("r",0),t.setAttribute("c",0),document.getElementById(this.boxId).appendChild(t),e.setAttribute("class","child"),e.setAttribute("contenteditable","true"),e.style.cssText="height:0px;width:0px;overflow:hidden;",document.querySelector("#"+this.boxId+" .textarea").appendChild(e),document.querySelector("#"+this.boxId+" .child").focus()},Workbook.prototype.getFocus=function(){var t=document.querySelector("#"+this.boxId+" .textarea");if(t){var e=parseInt(t.style.top),o=parseInt(t.style.left),i=parseInt(t.style.maxWidth),r=parseInt(t.style.maxHeight);return this.isFocus=0!=e||0!==o||0!=i||0!=r,this.isFocus}},Workbook.prototype.getBoxDiff=function(){var t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft,o=this.canvas.getBoundingClientRect(),i=o.left;return{boxT:t+o.top,boxL:e+i}},Workbook.prototype.drawBtn=function(t,e,o,i,r,s,a,n){var h,l=0<=n?n:this.workbook.activeSheet,c=this.getActiveSheet(l),d=c.activeRow,g=c.activeCol,p=c.alwaysShowButton,f=c.alwaysShowInArea,u=c.rows,b=c.columns,w=this.getCellType(t,e,t,e);w&&(h=w.name),(p&&!f||p&&f&&t==d&&e==g||!p&&t==d&&e==g&&this.isEdit)&&u[t]&&!u[t].bHidden&&b[e]&&!b[e].bHidden&&r>=this.cellBtnAreaWidth&&(1!=h&&2!=h||(this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=a?this.btnFillColorH:this.btnFillColor,this.ctx.strokeStyle=a?this.btnBorderColorH:this.btnBorderColor,this.ctx.fillRect(o+r-this.cellBtnAreaWidth,i+1,this.cellBtnAreaWidth-1,s-2),this.ctx.lineWidth=.5,this.ctx.moveTo(o+r-this.cellBtnAreaWidth,i+1),this.ctx.lineTo(o+r-this.cellBtnAreaWidth,i+s-1),this.ctx.lineTo(o+r-1,i+s-1),this.ctx.lineTo(o+r-1,i+1),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()),2==h?(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#000",this.ctx.fillStyle="#000",this.ctx.moveTo(o+r-this.cellBtnWidth,i+s/2-this.cellBtnHeight/2),this.ctx.lineTo(o+r-this.cellBtnWidth/2-2,i+s/2+this.cellBtnHeight/2-6),this.ctx.lineTo(o+r-4,i+s/2-this.cellBtnHeight/2),this.ctx.stroke(),this.ctx.restore()):1==h&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#585858",this.ctx.arc(o+r-this.cellBtnWidth-1,i+s/2-1.5,1.5,2*Math.PI,0,!0),this.ctx.arc(o+r-this.cellBtnWidth-1+4,i+s/2-1.5,1.5,2*Math.PI,0,!0),this.ctx.arc(o+r-this.cellBtnWidth-1+8,i+s/2-1.5,1.5,2*Math.PI,0,!0),this.ctx.fill(),this.ctx.restore()))},Workbook.prototype.drawSelectBtn=function(t,e,o,i,r,s,a){var n=0<=a?a:this.workbook.activeSheet,h=this.getActiveSheet(n),l=h.rows,c=h.columns,d=h.activeRow,g=h.activeCol,p=!1,f=h.alwaysShowButton,u=h.alwaysShowInArea;(i>this.height-this.tabsHeight-this.scrollSize||o>this.width-this.scrollSize)&&(p=!0),(f&&!u||f&&u&&t==d&&e==g||!f&&t==d&&e==g&&this.isEdit)&&!p&&l[t]&&!l[t].bHidden&&c[e]&&!c[e].bHidden&&r>=this.cellBtnAreaWidth&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle="#000",this.ctx.moveTo(o+r-this.cellBtnAreaWidth+3,i+s/2-3),this.ctx.lineTo(o+r-this.cellBtnAreaWidth+6,i+s/2+3),this.ctx.lineTo(o+r-this.cellBtnAreaWidth+6+3,i+s/2-3),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore())},Workbook.prototype.drawCheckBox=function(t,e,o,i,r,s,a,n){var h=0<=n?n:this.workbook.activeSheet,l=this.getActiveSheet(h),c=l.rows,d=l.columns,g=this.getValue(t,e);c[t]&&!c[t].bHidden&&d[e]&&!d[e].bHidden&&r>=this.checkBoxW&&(this.ctx.fillStyle=a?this.checkBoxFillColorH:this.checkBoxFillColor,this.ctx.strokeStyle=a?this.checkBoxBorderColorH:this.checkBoxBorderColor,this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(o+r/2-this.checkBoxW/2,i+s/2-this.checkBoxH/2,this.checkBoxW,this.checkBoxH),this.ctx.stroke(),this.ctx.fill(),this.ctx.restore(),g&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=2,this.ctx.strokeStyle="green",this.ctx.moveTo(o+r/2-this.checkBoxW/2+2,i+s/2),this.ctx.lineTo(o+r/2,i+s/2+this.checkBoxH/2-2),this.ctx.lineTo(o+r/2+this.checkBoxW/2,i+s/2-this.checkBoxH/2),this.ctx.stroke(),this.ctx.restore()))},Workbook.prototype.getCellRC=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e);return{r1:o.rangeRow1,c1:o.rangeCol1,r2:o.rangeRow2,c2:o.rangeCol2}},Workbook.prototype.setLock=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0===r||r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&(n[f][u].style.lock=h)},Workbook.prototype.getLock=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.hasOwnProperty("lock")&&(b=a[f][u].style.lock,n.push({r:f,c:u,lock:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].lock:l==d&&c==g||p?void 0:n},Workbook.prototype.setCanEdit=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=void 0!==r&&r,l=this.handleArg(t,e,o,i,a),c=l.r1,d=l.c1,g=l.r2,p=l.c2,f=c;f<=g;f++)for(var u=d;u<=p;u++)this.createData(f,u,a),n[f]&&n[f][u]&&n[f][u].style&&(n[f][u].style.canEdit=h)},Workbook.prototype.getCanEdit=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.hasOwnProperty("canEdit")&&(b=a[f][u].style.canEdit,n.push({r:f,c:u,canEdit:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].canEdit:l==d&&c==g||p?void 0:n},Workbook.prototype.setCellFormat=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a).data.dataTable,h=t;h<=o;h++)for(var l=e;l<=i;l++)this.createData(h,l,a),n[h]&&n[h][l]&&n[h][l].style&&(n[h][l].style.formatter=r.trim(),"text"!=r&&1==n[h][l].style.hAlign&&(n[h][l].style.hAlign=4))},Workbook.prototype.getCellFormat=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.formatter&&(b=a[f][u].style.formatter,n.push({r:f,c:u,formatter:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].formatter:l==d&&c==g||p?void 0:n},Workbook.prototype.getFormatValue=function(t,e){var o=this.getFullData(t),i=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(i.test(t))var r=this.excelDateToJSDate(Number(t),"-"),s=r.split("-");switch(e){case"yyyy年m月d日":"Array"==this.typeObj(o)?t=o[0]+"年"+o[1]+"月"+o[2]+"日":i.test(t)&&(t=s[0]+"年"+s[1]+"月"+s[2]+"日");break;case"yyyy年m月":"Array"==this.typeObj(o)?t=o[0]+"年"+o[1]+"月":i.test(t)&&(t=s[0]+"年"+s[1]+"月");break;case"m月d日":"Array"==this.typeObj(o)?t=o[1]+"月"+o[2]+"日":i.test(t)&&(t=s[1]+"月"+s[2]+"日");break;case"yyyy-m-d":"Array"==this.typeObj(o)?t=o[0]+"-"+o[1]+"-"+o[2]:i.test(t)&&(t=r);break;case"yyyy-m":"Array"==this.typeObj(o)?t=o[0]+"-"+o[1]:i.test(t)&&(t=s[0]+"-"+s[1]);break;case"m-d":"Array"==this.typeObj(o)?t=o[1]+"-"+o[2]:i.test(t)&&(t=s[1]+"-"+s[2]);break;case"yyyy-m-d:uppercase":if("Array"==this.typeObj(o))t=this.converToUpper(o[0].toString())+"年"+this.converToUpper(o[1].toString())+"月"+this.converToUpper(o[2].toString())+"日";else if(i.test(t)){t=this.converToUpper(s[0].toString())+"年"+this.converToUpper(s[1].toString())+"月"+this.converToUpper(s[2].toString())+"日"}break;case"yyyy-m:uppercase":if("Array"==this.typeObj(o))t=this.converToUpper(o[0].toString())+"年"+this.converToUpper(o[1].toString())+"月";else if(i.test(t)){t=this.converToUpper(s[0].toString())+"年"+this.converToUpper(s[1].toString())+"月"}break;case"星期n":var a,n="";switch("Array"==this.typeObj(o)?a=new Date(o[0],o[1]-1,o[2]).getDay():i.test(t)&&(a=new Date(s[0],s[1]-1,s[2]).getDay()),a){case 0:n="星期日";break;case 1:n="星期一";break;case 2:n="星期二";break;case 3:n="星期三";break;case 4:n="星期四";break;case 5:n="星期五";break;case 6:n="星期六"}t=n;break;case"yyyy/m/d":"Array"==this.typeObj(o)?t=o[0]+"/"+o[1]+"/"+o[2]:i.test(t)&&(t=s[0]+"/"+s[1]+"/"+s[2]);break;case"yyyy/m":"Array"==this.typeObj(o)?t=o[0]+"/"+o[1]:i.test(t)&&(t=s[0]+"/"+s[1]);break;case"m/d":"Array"==this.typeObj(o)?t=o[1]+"/"+o[2]:i.test(t)&&(t=s[1]+"/"+s[2]);break;case"capitalMoney":t=this.getCapitalMoney(t);break;case"text":t=t;break;default:t=this.getRegFormat(t,e)}return t},Workbook.prototype.getRegFormat=function(t,e){switch(!0){case/^0*E$/.test(e):t=this.getScient(t,e);break;case/^0*NR?\(?A?(\+thousands)?$/.test(e):t=this.getNumFormat(t,e);break;case/^0*MR?\(?A?(\+(￥|¥|\$|€|￡|₣|₩))?$/.test(e):t=this.getMoneyFormat(t,e);break;case/^0*P(\+%)$/.test(e):t=this.getPercentageFormat(t,e)}return t},Workbook.prototype.getCapitalMoney=function(t){var e=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(e.test(t)){var o=["角","分"],i=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],r=[["元","万","亿","兆","京","垓","秭","穰","沟","涧","正","载"],["","拾","佰","仟"]],s="",a=Number(t);if(e.test(a)){var n=a<0?"欠":"";a=Math.abs(a);for(var h=0;h<o.length;h++)s+=i[Math.floor((10*a).toFixed(2)*Math.pow(10,h))%10]+o[h];if(s=(s=s.replace(/零./g,""))||"整",48<(a=Math.floor(a)).toString().length)return t;for(h=0;h<r[0].length&&0<a;h++){for(var l="",c=0;c<r[1].length&&0<a;c++)l=i[a%10]+r[1][c]+l,a=Math.floor(a/10);s=(l=l.replace(/(零.)*零$/,"").replace(/^$/,"零"))+r[0][h]+s}return n+(s=s.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整"))}return s=t}return t},Workbook.prototype.getPercentageFormat=function(t,e){var o=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(o.test(t)){var i=Number(t),r=e.split("0").length-1;return 2==e.split("+").length&&o.test(i)?(i=(100*i).toFixed(r))+"%":t}return t},Workbook.prototype.getMoneyFormat=function(t,e){var o=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(o.test(t)){var i,r,s=Number(t),a=e.split("0").length-1;i=(s=s.toFixed(a)).split(".")[0],r=s.split(".")[1];var n="",h="";return 2==e.split("+").length&&o.test(s)&&(n=e.split("+")[1]),r&&(h="."+r),Number(s)<0&&o.test(s)?-1!=e.indexOf("(")?"("+n+Math.abs(Number(i)).toLocaleString().split(".")[0]+h+")":-1!=e.indexOf("A")?n+Math.abs(Number(i)).toLocaleString().split(".")[0]+h:n+Number(i).toLocaleString().split(".")[0]+h:0<=Number(s)&&o.test(s)?n+Number(i).toLocaleString().split(".")[0]+h:t}return t},Workbook.prototype.getNumFormat=function(t,e){var o=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/;if(o.test(t)){var i,r,s=Number(t),a=e.split("0").length-1;i=(s=s.toFixed(a)).split(".")[0],r=s.split(".")[1];var n,h="",l=this.getFullData(t);n="Array"==this.typeObj(l)?l[0]+"-"+l[1]+"-"+l[2]:t;var c=this.jsDateToExcelDate(new Date(n));return r&&(h="."+r),Number(s)<0&&o.test(s)?(-1!=e.indexOf("A")&&(i=Math.abs(i)),2==e.split("+").length&&o.test(s)?-1!=e.indexOf("(")?"("+Math.abs(Number(i)).toLocaleString().split(".")[0]+h+")":Number(i).toLocaleString().split(".")[0]+h:-1!=e.indexOf("(")?"("+Math.abs(Number(i))+h+")":i+h):0<=Number(s)&&o.test(s)?2==e.split("+").length&&o.test(s)?Number(i).toLocaleString().split(".")[0]+h:s:Number(t)||o.test(t)||!c?t:Math.floor(c).toFixed(a)}return t},Number.prototype.toFixed=function(t){var e,o,i=this;if(this<0&&(i=-i),(o=(e=(parseInt(i*Math.pow(10,t)+.5)/Math.pow(10,t)).toString()).indexOf("."))<0&&0<t){e+=".";for(var r=0;r<t;r++)e+="0"}else{var s=e.length-1-o;for(r=0;r<t-s;r++)e+="0"}return this<0?"-"+e:e},Workbook.prototype.getScient=function(t,e){if(/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/.test(t)){var o=Math.abs(Number(t)),i=Math.floor(Math.log(o)/Math.LN10),r=o.toString();if(/^1(000)+$/.test(r))i=r.split("0").length-1;var s=e.split("0").length-1,a=(o*Math.pow(10,-i)).toFixed(s);return i<10&&0<=i&&(i="0"+i),10<=o&&0<Number(t)?a+"E+"+i:1<=o&&o<10&&0<Number(t)?a+"E+00":o<1&&0<o&&0<Number(t)?a+"E"+i:Number(t)<0&&10<=o?"-"+a+"E+"+i:Number(t)<0&&1<=o&&o<10?"-"+a+"E+00":Number(t)<0&&o<1&&0<o?"-"+a+"E"+i:t}return t},Workbook.prototype.converToUpper=function(t){for(var e=["〇","一","二","三","四","五","六","七","八","九"],o=[],i=0;i<t.length;i++)o.push(e[t.charAt(i)]);var r=o.join("");return 2==r.length&&("一"==r[0]?r="〇"==r[1]?"十":"十"+r[1]:"一"!=r[0]&&(r="〇"==r[1]?r[0]+"十":r[0]+"十"+r[1])),r},Workbook.prototype.getFullData=function(t){if(void 0!==t){t=t.toString();var e=(new Date).getFullYear();if(/年|月|日/g.test(t)){var o,i=t.split("年");if(2==i.length)if(2==(r=i[1].split("月")).length)2==(s=r[1].split("日")).length?Number(i[0])%1==0&&1900<=Number(i[0])&&Number(i[0])<=9999&&Number(r[0])%1==0&&1<=Number(r[0])&&Number(r[0])<=12&&Number(s[0])%1==0&&1<=Number(s[0])&&Number(s[0])<=31&&(o=[Number(i[0]),Number(r[0]),Number(s[0]),"yyyy年m月d日"]):1==s.length?Number(i[0])%1==0&&1900<=Number(i[0])&&Number(i[0])<=9999&&Number(r[0])%1==0&&1<=Number(r[0])&&Number(r[0])<=12&&(o=[Number(i[0]),Number(r[0]),1,"yyyy年m月"]):o=t;else o=t;else if(1==i.length){var r,s;if(2==(r=i[0].split("月")).length)o=2==(s=r[1].split("日")).length&&Number(r[0])%1==0&&1<=Number(r[0])&&Number(r[0])<=12&&Number(s[0])%1==0&&1<=Number(s[0])&&Number(s[0])<=31?[Number(e),Number(r[0]),Number(s[0]),"m月d日"]:t;else o=t}else o=t;return o}var a,n=t.split("/");if(3==n.length)a=Number(n[0])%1==0&&1900<=Number(n[0])&&Number(n[0])<=9999&&Number(n[1])%1==0&&1<=Number(n[1])&&Number(n[1])<=12&&Number(n[2])%1==0&&1<=Number(n[2])&&Number(n[2])<=31?[Number(n[0]),Number(n[1]),Number(n[2]),"yyyy/m/d","/"]:t;else if(2==n.length){var h=n[0].split("-"),l=n[1].split("-");a=2==h.length&&1==l.length&&Number(h[0])%1==0&&1900<=Number(h[0])&&Number(h[0])<=9999&&Number(h[1])%1==0&&1<=Number(h[1])&&Number(h[1])<=12&&Number(l[0])%1==0&&1<=Number(l[0])&&Number(l[0])<=31?[Number(h[0]),Number(h[1]),Number(l[0]),"yyyy/m/d","/"]:1==h.length&&2==l.length&&Number(h[0])%1==0&&1900<=Number(h[0])&&Number(h[0])<=9999&&Number(l[0])%1==0&&1<=Number(l[0])&&Number(l[0])<=12&&Number(l[1])%1==0&&1<=Number(l[1])&&Number(l[1])<=31?[Number(h[0]),Number(l[0]),Number(l[1]),"yyyy/m/d","/"]:1==h.length&&1==l.length&&Number(n[0])%1==0&&1900<=Number(n[0])&&Number(n[0])<=9999&&Number(n[1])%1==0&&1<=Number(n[1])&&Number(n[1])<=12?[Number(n[0]),Number(n[1]),1,"yyyy/m","/"]:1==h.length&&1==l.length&&Number(n[0])%1==0&&1<=Number(n[0])&&Number(n[0])<=12&&Number(n[1])%1==0&&1<=Number(n[1])&&Number(n[1])<=31?[Number(e),Number(n[0]),Number(n[1]),"m/d","/"]:t}else if(1==n.length){var c=n[0].split("-");a=3==c.length&&Number(c[0])%1==0&&1900<=Number(c[0])&&Number(c[0])<=9999&&Number(c[1])%1==0&&1<=Number(c[1])&&Number(c[1])<=12&&Number(c[2])%1==0&&1<=Number(c[2])&&Number(c[2])<=31?[Number(c[0]),Number(c[1]),Number(c[2]),"yyyy-m-d","-"]:2==c.length&&Number(c[0])%1==0&&1900<=Number(c[0])&&Number(c[0])<=9999&&Number(c[1])%1==0&&1<=Number(c[1])&&Number(c[1])<=12?[Number(c[0]),Number(c[1]),1,"yyyy-m","-"]:2==c.length&&Number(c[0])%1==0&&1<=Number(c[0])&&Number(c[0])<=12&&Number(c[1])%1==0&&1<=Number(c[1])&&Number(c[1])<=31?[Number(e),Number(c[0]),Number(c[1]),"m-d","-"]:t}else a=t;return a}},Workbook.prototype.setCellType=function(t,e,o,i,r,s){for(var a=0<=s?s:this.workbook.activeSheet,n=this.getActiveSheet(a),h=n.data.dataTable,l=t;l<=o;l++)for(var c=e;c<=i;c++)this.createData(l,c,a),h[l]&&h[l][c]&&h[l][c].style&&(n.data.dataTable[l][c].style.cellType=r)},Workbook.prototype.getCellType=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=[],h=this.handleArg(t,e,o,i,s),l=h.r1,c=h.c1,d=h.r2,g=h.c2,p=this.isSpanCell(l,c,d,g),f=l;f<=d;f++)for(var u=c;u<=g;u++){var b;a[f]&&a[f][u]&&a[f][u].style&&a[f][u].style.cellType&&(b=a[f][u].style.cellType,n.push({r:f,c:u,cellType:b}))}return(l==d&&c==g||p)&&1==n.length?n[0].cellType:l==d&&c==g||p?void 0:n},Workbook.prototype.cellTypeContent=function(t,e,o){return{name:t,list:e,notSetIndex:o}},Workbook.prototype.setTableSize=function(t,e){this.workbook.width=t||this.workbook.width,this.workbook.height=e||this.workbook.height,this.container.style.height=this.workbook.height+"px",this.container.style.width=this.workbook.width+"px",this.recalculatePercentage()},Workbook.prototype.drawPrint=function(i,t){var r=0<=t?t:this.workbook.activeSheet,e=this.workbook.showTabs,o=this.workbook.showHScrollBar,s=this.workbook.showVScrollBar,a=this.workbook.activeSheet,n=this.workbook.width,h=this.workbook.height,l=[],c=0,d=this.workbook.sheetList,g=[],p=[];this.workbook.showTabs=0,this.workbook.showHScrollBar=0;for(var f=this.workbook.showVScrollBar=0;f<d.length;f++){var u=this.getActiveSheet(f),b=u.rows,w=u.columns,k=u.rowHeaderData.showRowHeading,v=u.colHeaderData.showColHeading,m=u.isSelectionHideBorder,x=u.fixed.fixedRow,y=u.fixed.fixedRows,S=u.fixed.fixedCol,C=u.fixed.fixedCols,H=u.scrollOption.coordY,W=u.scrollOption.totalY,A=u.scrollOption.coordX,T=u.scrollOption.totalX,R=u.scrollOption.offsetX,B=u.scrollOption.offsetY,O=u.showGridLines,N=u.colHeaderData,E=u.rowHeaderData,F=u.printSetting.printHeadings?N.defaultH:0,L=u.printSetting.printHeadings?E.defaultW:0,I=this.getMaxRowAndCol(f);c+=I.totalHeight+F,l.push(I.totalWidth+L);var D=u.gridLinesColor,P=I.totalWidth+L,z=I.totalHeight+F,M=I.maxRow,V=I.maxCol;this.workbook.width=P,this.workbook.height=z,u.rowHeaderData.showRowHeading=!!u.printSetting.printHeadings,u.colHeaderData.showColHeading=!!u.printSetting.printHeadings,u.showGridLines=!!u.printSetting.printGridLine,u.isSelectionHideBorder=!0,u.scrollOption.coordX=0,u.scrollOption.totalX=0,u.scrollOption.coordY=0,u.scrollOption.totalY=0,u.scrollOption.offsetX=0,u.scrollOption.offsetY=0,this.removeFixed(f),this.sheetIndex(f),this.startPaint(!0),this.canvas.width=this.width,this.canvas.height=this.height,u.printSetting.printGridLine&&(this.drawLine(0,0,M,V,f),this.drawTopLine(f),this.drawLeftLine(f)),this.drawSpans(0,0,M,V,f),this.drawCellContent(0,0,M,V,f),u.printSetting.printHeadings&&(this.drawRowHeader(0,M,f),this.drawRowArrow(f)),u.printSetting.printHeadings&&this.drawColHeader(0,V,f),u.printSetting.printHeadings&&u.printSetting.printHeadings&&(1<b.length||1<w.length)&&this.drawTriangle(u.colHeaderData.defaultDataNode.style.fillColor,D);var X=this.canvas.toDataURL();g.push({index:f,h:z,dataUrl:X}),p.push({index:f,h:z,w:P}),u.rowHeaderData.showRowHeading=k,u.colHeaderData.showColHeading=v,u.showGridLines=O,u.isSelectionHideBorder=m,this.fixedRowAndCol(y,C,x,S,f),u.scrollOption.coordY=H,u.scrollOption.totalY=W,u.scrollOption.coordX=A,u.scrollOption.totalX=T,u.scrollOption.offsetX=R,u.scrollOption.offsetY=B}l=Math.max.apply(null,l),this.workbook.width=n,this.workbook.height=h,this.workbook.showTabs=e,this.workbook.showHScrollBar=o,this.workbook.showVScrollBar=s,this.sheetIndex(a),this.startPaint(!0);var j=document.createElement("canvas"),Y=j.getContext("2d");j.width=l,j.height=c;for(var $=[],J=this,U=0;U<g.length;U++){var G=new Image;G.src=g[U].dataUrl,$.push({img:G,h:g[U].h})}!function t(e,o){$[e]&&e<$.length?$[e].img.onload=function(){return Y.drawImage($[e].img,0,Math.floor(q)),q+=g[e].h,t(++e,o),!0}:o.call(J,j.toDataURL(),p,i,r)}(0,this.print);var q=0},Workbook.prototype.getMaxRowAndCol=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.rows,r=o.columns,s=o.spans,a=o.data.dataTable,n=[],h=[],l=0,c=0;s.forEach(function(t){n.push(t.row+t.rowCount-1),h.push(t.col+t.colCount-1)}),1<=n.length&&(l=Math.max.apply(null,n)),1<=h.length&&(c=Math.max.apply(null,h));var d=Object.keys(a),g=0,p=0;1<=d.length&&(g=Math.max.apply(null,d)),l=g<=l?l:g;for(var f=[],u=0;u<=l;u++)if(a[u]){var b=Object.keys(a[u]);1<=b.length&&(p=Math.max.apply(null,b)),f.push(p)}1<=f.length&&(p=Math.max.apply(null,f)),c=p<=c?c:p;for(var w=0,k=0,v=0;v<=l;v++)i[v]&&(w+=i[v].size);for(var m=0;m<=c;m++)r[m]&&(k+=r[m].size);return{maxRow:l,maxCol:c,totalHeight:w,totalWidth:k}},Workbook.prototype.print=function(t,Ct,Ht,Wt){var At=1<=this.workbook.print&&this.workbook.print<=3?this.workbook.print:1,Tt=this.workbook.printOnSamePaper,Rt=parseInt(this.workbook.marginCopies/25.4*this.dpi),Bt=this,Ot=document.createElement("canvas"),Nt=Ot.getContext("2d"),Et=new Image,Ft=[];Et.src=t,Et.onload=function(){for(var t=0,e=0;e<Ct.length;e++){var o=Ct[e].w,i=Ct[e].h;if(t+=i,(1==At||3==At)&&Ct[e].index==Wt||2==At){var r=e,s=Bt.getActiveSheet(r),a=s.printSetting,n=parseInt(a.printDirection);n=1<=n&&n<=2?n:1;var h=[],l=parseInt(a.orientation);l=1<=l&&l<=2?l:1;var c=Bt.getPaperSize(r),d=c.paperW,g=c.paperH,p=c.marginRight,f=c.marginLeft,u=c.marginTop,b=c.marginBottom,w=parseInt(a.isshowfooterpageinfo),k=a.footpagestyle||"第 &p 页，共 &P 页";w=0<=w&&w<=6?w:0;var v=1==l?d:g,m=1==l?g:d,x=s.colHeaderData,y=s.rowHeaderData,S=a.printHeadings?x.defaultH:0,C=a.printHeadings?y.defaultW:0;Ot.width=v,Ot.height=m;var H=Bt.getPrintAreaPosition(r),W=H.startX+C,A=H.startY+S,T=H.endX+C,R=H.endY+S,B=H.width+C,O=H.height+S,N=1==At||2==At?o:B,E=1==At||2==At?i:O,F=1==At||2==At?Math.floor(t):Math.floor(t-i+R),L=1==At||2==At?Math.floor(o):Math.floor(T),I=1==At||2==At?0:Math.floor(A),D=1==At||2==At?0:Math.floor(W),P=1==At||2==At?1:0,z=Math.ceil(E/m),M=Math.ceil(N/v);z=Math.ceil((z*(u+b+S)+E-S)/m),M=2==At&&Tt?1:Math.ceil((M*(f+p+C)+N-C)/v);for(var V=0,X=0,j=0,Y=0,$=0,J=0,U=0,G=1==n?M:2==n?z:M,q=1==n?z:2==n?M:z,_=0;_<G;_++){1==n?Y=D+_*(v-(0<_?f+p:0))-(_-P)*(1<_||0<_&&3==At?Math.floor(C):0):2==n&&($=0<_?u+b:0,J=1<_||0<_&&3==At?Math.floor(S):0,U=Math.floor(t-i)+I+_*(m-$)-(_-P)*J);for(var K=0;K<q;K++){V+=1,Ot.width=v,Ot.height=m,1==n?($=0<K?u+b:0,J=1<K||3==At&&0<K?Math.floor(S):0,U=Math.floor(t-i)+I+K*(m-$)-(K-P)*J,X=K,j=_):2==n&&(Y=D+K*(v-(0<K?f+p:0))-(K-P)*(1<K||3==At&&0<K?C:0),X=_,j=K);var Z=0<X||3==At?Math.floor(S):0,Q=0<j||3==At?Math.floor(C):0,tt=v-p-f-Q,et=m-b-u-Z,ot=f+Q,it=u+Z,rt=tt=L-Y<=tt?L-Y:tt,st=et=F-U<=et?F-U:et;if(Nt.drawImage(Et,Y,U,tt,et,ot,it,rt,st),(a.printHeadings&&(0!=X||0!=j)||3==At)&&(0<X&&0==j&&(1==At||2==At)&&Nt.drawImage(Et,Y,Math.floor(t-i),tt,Math.floor(S),f,u,tt,Math.floor(S)),0<j&&0==X&&(1==At||2==At)&&Nt.drawImage(Et,0,U,Math.floor(C),et,f,u,Math.floor(C),et),0<X&&0<j||3==At)){var at=Math.floor(C),nt=Math.floor(S);Nt.drawImage(Et,Y,Math.floor(t-i),tt,Math.floor(S),f+at,u,tt,Math.floor(S)),Nt.drawImage(Et,0,U,Math.floor(C),et,f,u+nt,Math.floor(C),et),Nt.drawImage(Et,0,Math.floor(t-i),Math.floor(C),Math.floor(S),f,u,Math.floor(C),Math.floor(S))}var ht=Ot.toDataURL();h.push({page:V,base64:ht,sx:Y,sWidth:tt,sy:Math.floor(U-(t-i)),sHeight:et,row:X,col:j,index:e,canvasW:v,canvasH:m,isshowfooterpageinfo:w,footpagestyle:k,marginT:u,marginB:b,marginL:f,marginR:p})}}h=Bt.deleteEmptyPage(h),Ft=Ft.concat(h)}}for(var lt=0;lt<Ft.length;lt++)Ft[lt].page=lt+1;if(1<=Ft.length){for(var ct=function o(i,r,s){r[i]&&i<r.length?r[i].image.onload=function(){if(Ot.width=r[i].canvasW,Ot.height=r[i].canvasH,Nt.drawImage(r[i].image,0,0),0!=r[i].isshowfooterpageinfo){Nt.font="14px 楷体";var t=Bt.getPageNumPosition(r[i].canvasW,r[i].canvasH,r[i].isshowfooterpageinfo);Nt.textAlign=t.align,Nt.textBaseline="middle",Nt.fillStyle="#000";var e=r[i].footpagestyle.replace("&p",r[i].page).replace("&P",r.length);Nt.fillText(e,t.x,t.y)}return dt.push({base64:Ot.toDataURL()}),o(++i,r,s),!0}:s(dt)},dt=[],gt=0,pt=0,ft=0,ut=0;ut<Ft.length;ut++){var bt=new Image;bt.src=Ft[ut].base64,Ft[ut].image=bt,gt+=Ft[ut].sHeight,pt=Ft[0].canvasW-Ft[0].marginL-Ft[0].marginR,ft+=Rt}if(Tt&&2==At){!function t(e,n){if(Ft[e]&&e<Ft.length)Ft[e].image.onload=function(){return Nt.drawImage(Ft[e].image,Ft[e].marginL,Ft[e].marginT,Ft[e].sWidth,Ft[e].sHeight,0,St,Ft[e].sWidth,Ft[e].sHeight),St+=Ft[e].sHeight+Rt,t(++e,n),!0};else{var h=new Image;h.src=Ot.toDataURL(),h.onload=function(){var t=Math.ceil(gt/Ft[0].canvasH);t=Math.ceil((t*(xt+yt)+gt)/Ft[0].canvasH);for(var e=0,o=mt+vt,i=yt+xt,r=0,s=0;s<t;s++){r+=1,Ot.width=Ft[0].canvasW,Ot.height=Ft[0].canvasH,Nt.drawImage(h,0,e,Ft[0].canvasW-o,Ft[0].canvasH-i,mt,xt,Ft[0].canvasW-o,Ft[0].canvasH-i),e+=Ft[0].canvasH;var a=new Image;a.src=Ot.toDataURL(),wt.push({base64:Ot.toDataURL(),image:a,page:r,canvasW:Ft[0].canvasW,canvasH:Ft[0].canvasH,isshowfooterpageinfo:Ft[0].isshowfooterpageinfo,footpagestyle:Ft[0].footpagestyle})}ct(0,wt,function(t){n(t)})}}}(0,function(t){"function"==typeof Ht&&Ht(t)});var wt=[],kt=Bt.getPaperSize(0),vt=kt.marginRight,mt=kt.marginLeft,xt=kt.marginTop,yt=kt.marginBottom,St=0;gt+=+ft-Rt,Ot.width=pt,Ot.height=gt}else ct(0,Ft,function(t){"function"==typeof Ht&&Ht(t)})}}},Workbook.prototype.getPrintAreaPosition=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e),i=o.printSetting,r=o.rows,s=o.columns,a=0<=parseInt(i.printArea.r1)?parseInt(i.printArea.r1):o.rangeRow1,n=0<=parseInt(i.printArea.c1)?parseInt(i.printArea.c1):o.rangeCol1,h=0<=parseInt(i.printArea.r2)?parseInt(i.printArea.r2):o.rangeRow2,l=0<=parseInt(i.printArea.c2)?parseInt(i.printArea.c2):o.rangeCol2,c=this.getMaxRowAndCol(e),d=c.maxRow,g=c.maxCol;d<a&&(a=d),d<h&&(h=d),g<n&&(n=g),g<l&&(l=g);for(var p=0,f=0,u=0,b=0,w=0;w<a;w++)r[w]&&(f+=r[w].size);for(w=0;w<n;w++)s[w]&&(p+=s[w].size);for(w=0;w<=h;w++)r[w]&&(b+=r[w].size);for(w=0;w<=l;w++)s[w]&&(u+=s[w].size);return{startX:p,startY:f,endX:u,endY:b,width:u-p,height:b-f}},Workbook.prototype.deleteEmptyPage=function(s){if(s){for(var a=0;a<s.length;a++){var t=0<=s[a].index?s[a].index:this.workbook.activeSheet,e=this.getActiveSheet(t),o=e.rows,i=e.columns,r=e.data.dataTable,n=e.spans,h=0,l=0;e.printSetting.printHeadings&&(h=e.rowHeaderData.defaultW,l=e.colHeaderData.defaultH);for(var c=s[a].sy,d=s[a].sHeight,g=s[a].sx,p=c+d,f=g+s[a].sWidth,u=0,b=0,w=0,k=0,v=h,m=l,x=h,y=l,S=0;S<o.length;S++)if(o[S]&&(m+=o[S].size),c<=m){u=S;break}for(S=0;S<o.length;S++)if(o[S]&&(y+=o[S].size),p<=y){w=S;break}for(var C=0;C<i.length;C++)if(i[C]&&(v+=i[C].size),g<=v){b=C;break}for(C=0;C<i.length;C++)if(i[C]&&(x+=i[C].size),f<=x){k=C;break}for(var H=u;H<=w;H++)for(var W=b;W<=k;W++)r[H]&&r[H][W]&&(s[a].ety=!1);n.forEach(function(t){var e=t.row,o=t.col,i=t.row+t.rowCount-1,r=t.col+t.colCount-1;u<=i&&e<=w&&b<=r&&o<=k&&(s[a].ety=!1)})}var A,T;for(a=s.length-1;0<=a;a--){var R=this.getActiveSheet(s[a].index),B=parseInt(R.printSetting.printDirection);if(B=1<=B&&B<=2?B:1,!1!==s[a].ety)s.splice(a,1);else{if(!1===s[a].ety&&1==B){A=s[a].row;break}if(!1===s[a].ety&&2==B){T=s[a].col;break}}}for(C=s.length-1;0<=C;C--){var O=this.getActiveSheet(s[C].index),N=parseInt(O.printSetting.printDirection);N=1<=N&&N<=2?N:1,s[C].row>A&&1==N?!1!==s[C].ety&&s.splice(C,1):s[C].col>T&&2==N&&!1!==s[C].ety&&s.splice(C,1)}return s}},Workbook.prototype.getPageNumPosition=function(t,e,o){var i=0,r=0,s="center";switch(o){case 1:i=t/2,r=e-10,s="center";break;case 2:i=0,r=e-10,s="left";break;case 3:i=t,r=e-10,s="right";break;case 4:i=t/2,r=10,s="center";break;case 5:i=0,r=10,s="left";break;case 6:i=t,r=10,s="right"}return{x:i,y:r,align:s}},Workbook.prototype.setPrint=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o).printSetting;t&&(i.marginTop=0<=t.marginTop?t.marginTop:i.marginTop,i.marginBottom=0<=t.marginBottom?t.marginBottom:i.marginBottom,i.marginLeft=0<=t.marginLeft?t.marginLeft:i.marginLeft,i.marginRight=0<=t.marginRight?t.marginRight:i.marginRight,i.paper=t.paper||i.paper,i.printHeadings=void 0===t.printHeadings?i.printHeadings:!!t.printHeadings,i.printGridLine=void 0===t.printGridLine?i.printGridLine:!!t.printGridLine,i.orientation=t.orientation||i.orientation,i.printDirection=t.printDirection||i.printDirection,this.workbook.printOnSamePaper=void 0===t.printOnSamePaper?this.workbook.printOnSamePaper:!!t.printOnSamePaper,this.workbook.marginCopies=0<=t.marginCopies?t.marginCopies:this.workbook.marginCopies,this.workbook.printer=t.printer||this.workbook.printer,this.workbook.print=1<=t.print&&t.print<=3?t.print:this.workbook.print,i.isshowfooterpageinfo=0<=t.isshowfooterpageinfo&&t.isshowfooterpageinfo<=6?t.isshowfooterpageinfo:i.isshowfooterpageinfo,i.footpagestyle=t.footpagestyle||i.footpagestyle,i.printArea.r1=0<=t.startR?t.startR:i.printArea.r1,i.printArea.r2=0<=t.endR?t.endR:i.printArea.r2,i.printArea.c1=0<=t.startC?t.startC:i.printArea.c1,i.printArea.c2=0<=t.endC?t.endC:i.printArea.c2)},Workbook.prototype.getPaperSize=function(t){var e=0<=t?t:this.workbook.activeSheet,o=this.getActiveSheet(e).printSetting,i=o.marginTop,r=o.marginBottom,s=o.marginLeft,a=o.marginRight,n=o.paper,h=this.dpi,l=0,c=0;switch(n.toUpperCase()){case"A3":l=297,c=420;break;case"A4":l=210,c=297;break;case"A5":l=148,c=210;break;case"A6":l=105,c=148;break;default:l=210,c=297}return{paperW:l=parseInt(l/25.4*h),paperH:c=parseInt(c/25.4*h),marginTop:i=parseInt(i/25.4*h)||0,marginBottom:r=parseInt(r/25.4*h)||0,marginLeft:s=parseInt(s/25.4*h)||0,marginRight:a=parseInt(a/25.4*h)||0}},Workbook.prototype.splitcolHeader=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.colHeaderData;if(n.showColHeading){n.spans||(a.colHeaderData.spans=[]);for(var h=n.spans,l=h.length-1;0<=l;l--)t>=h[l].col&&t<h[l].col+h[l].colCount&&h.splice(l,1);var c=o||2,d=i||a.colHeaderData.defaultH/2;a.colHeaderData.spans.push({col:t,name:e,colCount:c,height:d})}},Workbook.prototype.removeSplitcolHeader=function(t,e){var o=0<=e?e:this.workbook.activeSheet,i=this.getActiveSheet(o),r=i.colHeaderData.spans;if(r)for(var s=r.length-1;0<=s;s--)r[s].col==t&&i.colHeaderData.spans.splice(s,1)},Workbook.prototype.setValue=function(t,e,o,i){var r,s=0<=i?i:this.workbook.activeSheet,a=this.getActiveSheet(s),n=a.data.dataTable,h="",l="",c=document.querySelector("#"+this.boxId+" .child"),d=this.getCellType(t,e,t,e,s),g=this.getCellFormula(t,e,t,e),p=this.getCellFormat(t,e,t,e),f=a.rows;if(d&&(r=d.name),0<=t&&0<=e&&(this.createData(t,e,s),n[t]&&n[t][e])){if("function"==typeof this.onvaluechange&&0==this.workbook.stopEventCount&&"-1"==(h=this.onvaluechange(t,e,o,n[t][e].value)))return;if(3==r){var u=o?1:0;n[t][e].value=u,n[t][e].text=u.toString()}else{if("object"==(void 0===(n[t][e].value=o)?"undefined":_typeof(o))?n[t][e].text=JSON.stringify(o):null!=o&&(n[t][e].text=o.toString()),l=n[t][e].text,g&&"text"!=p&&(l=g),this.tempValue.r==t&&this.tempValue.c==e&&(c.innerText=l),f[t]&&!f[t].noDefaultH)this.getWordWrap(t,e,t,e,s)&&this.incrementRowheight(t,e,s)}}"1"==h&&"function"==typeof this.onrelevantchange&&this.onrelevantchange(t,e)},Workbook.prototype.setText=function(t,e,o,i){var r=0<=i?i:this.workbook.activeSheet,s=this.getActiveSheet(r).data.dataTable;this.createData(t,e,r),"object"==(void 0===o?"undefined":_typeof(o))?s[t][e].text=JSON.stringify(o):null!=o&&(s[t][e].text=o.toString())},Workbook.prototype.setCellPadding=function(t,e,o,i,r){var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s);a.cellPadding.top=t,a.cellPadding.right=e,a.cellPadding.bottom=o,a.cellPadding.left=i},Workbook.prototype.openPopup=function(t,e,o){var i,r,s,a=0<=o?o:this.workbook.activeSheet,n=document.querySelector("#"+this.boxId+" .child"),h=this.getCellType(t,e,t,e,a);if(h&&(i=h.name,r=h.list,s=h.notSetIndex),4==i){var l=this.onopenpopup,c=this.getBoxDiff(),d=this.getFontList(t,e).originSize,g=this.getSelectInfo(t,e),p=g.c1w,f=g.r1h,u=g.selectY,b=g.selectX;(window.top.popup||this.popup)&&"function"==typeof l&&0==this.workbook.stopEventCount&&l(p,f,c.boxL+b+1,c.boxT+u+f,r,t,e,n,d,s)}},Workbook.prototype.startPaint=function(t){t&&(this.workbook.stopPaintedCount=0),0<this.workbook.stopPaintedCount&&this.workbook.stopPaintedCount--,0==this.workbook.stopPaintedCount&&this.drawTable()},Workbook.prototype.stopPaint=function(){this.workbook.stopPaintedCount++},Workbook.prototype.resumeEvent=function(t){t&&(this.workbook.stopEventCount=0),0<this.workbook.stopEventCount&&this.workbook.stopEventCount--,this.workbook.stopEventCount<0&&(this.workbook.stopEventCount=0)},Workbook.prototype.stopEvent=function(){this.workbook.stopEventCount++},Workbook.prototype.getMergeCount=function(e,o,t){var i=0<=t?t:this.workbook.activeSheet,r=this.getActiveSheet(i).spans,s=1,a=1;return r.forEach(function(t){t.row==e&&t.col==o&&(s=t.rowCount,a=t.colCount)}),{rowCount:s,colCount:a}},Workbook.prototype.clearAllStyle=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=h;g<=c;g++)for(var p=l;p<=d;p++)a[g]&&a[g][p]&&a[g][p].style&&(a[g][p].style=JSON.parse(JSON.stringify(this.defaultCellStyle)))},Workbook.prototype.setFormatBrushStyle=function(t,e,o){var i=0<=o?o:this.workbook.activeSheet,r=this.getActiveSheet(i).data.dataTable;r[t]&&r[t][e]&&r[t][e].style&&(this.formatBrushStyle=r[t][e].style)},Workbook.prototype.clearFormatBrushStyle=function(){this.formatBrushStyle={}},Workbook.prototype.useFormatBrushStyle=function(t,e,o,i,r){for(var s=0<=r?r:this.workbook.activeSheet,a=this.getActiveSheet(s).data.dataTable,n=this.handleArg(t,e,o,i,s),h=n.r1,l=n.c1,c=n.r2,d=n.c2,g=h;g<=c;g++)for(var p=l;p<=d;p++)this.createData(g,p,s),a[g]&&a[g][p]&&a[g][p].style&&(a[g][p].style=this.formatBrushStyle)},Workbook.prototype.setDocument=function(t){for(var e in this.documentHandle)this.removeEvent(this.document,e,this.documentHandle[e]),this.document=t||this.document,this.addEvent(this.document,e,this.documentHandle[e])},Workbook.prototype.adaption=function(t,e,o){if(this.workbook.devScreenWidth=e||this.workbook.devScreenWidth,this.workbook.devScreenHeight=o||this.workbook.devScreenHeight,this.workbook.adaption=t,this.workbook.adaption){var i=this.width,r=this.height,s=this.workbook.width/this.workbook.devScreenWidth*window.innerWidth,a=this.workbook.height/this.workbook.devScreenHeight*window.innerHeight;for(var n in this.setTableSize(s,a),this.workbook.sheets){var h=this.workbook.sheets[n],l=h.columns,c=h.rows;h.colHeaderData.defaultH=h.colHeaderData.defaultH/r*this.height,h.rowHeaderData.defaultW=h.rowHeaderData.defaultW/i*this.width;for(var d=0;d<l.length;d++)l[d]&&l[d].bHidden?h.columns[d].tempSize=h.columns[d].tempSize/i*this.width:l[d]&&!l[d].bHidden&&(h.columns[d].size=h.columns[d].size/i*this.width);for(var g=0;g<c.length;g++)c[g]&&c[g].bHidden?h.rows[g].tempSize=h.rows[g].tempSize/r*this.height:c[g]&&!c[g].bHidden&&(h.rows[g].size=h.rows[g].size/r*this.height)}}},Workbook.prototype.addChildCanvas=function(t){var e=t.width||250,o=t.height||300,i=t.x||0,r=t.y||0,s=t.id,a=t.parentId,n=t.shade||!1,h=document.getElementById(a)||document.body,l=document.createElement("div");l.setAttribute("id",s+"shade"),n&&(l.style.cssText="height:100%;width:100%;position:absolute;top:0;left:0;background-color:rgba(0,0,0,.3);display:none",h.appendChild(l));var c=document.createElement("div");c.setAttribute("id",s),c.setAttribute("class","clearfix"),c.style.cssText="height:"+o+"px;width:"+e+"px;position:absolute;top:"+r+"px;left:"+i+"px;z-index:99;display:none",h.appendChild(c)},Workbook.prototype.hiddenChildCanvas=function(t){var e=document.getElementById(t),o=document.getElementById(t+"shade");e&&(e.style.display="none"),o&&(o.style.display="none"),this.removeTextArea()},Workbook.prototype.setActiveCanvas=function(t){window.boxId=t},Workbook.prototype.showChildCanvas=function(t){var e=document.getElementById(t),o=document.getElementById(t+"shade");e&&(e.style.display="block",e.style.position="absolute"),o&&(o.style.display="block"),this.removeTextArea()},Workbook.prototype.exportFileAsJson=function(){try{var t=!1;try{t=!!Blob}catch(t){}if(t){var e=new Blob([JSON.stringify(this.workbook)],{type:""});saveAs(e,"workbook.json")}else if(window.ActiveXObject){var o=JSON.stringify(this.workbook),i=new ActiveXObject("Scripting.FileSystemObject"),r=new ActiveXObject("WScript.shell");if(r.SpecialFolders("Desktop")){var s,a=r.SpecialFolders("Desktop");a=a.replace(/\\/g,"\\\\"),(s=i.CreateTextFile(a+"\\workbook.json",!0,!0)).write(o),s.Close()}}}catch(t){}},Workbook.prototype.exportFileAsXml=function(){var l=this;this.json2Xml(function(t,e){try{var o=!1;try{o=!!Blob}catch(t){}if(o){var i=new Blob([l.xml2String(t)],{type:""});saveAs(i,e+".xml")}else if(window.ActiveXObject){var r=l.xml2String(t),s=new ActiveXObject("Scripting.FileSystemObject"),a=new ActiveXObject("WScript.shell");if(a.SpecialFolders("Desktop")){var n,h=a.SpecialFolders("Desktop");h=h.replace(/\\/g,"\\\\"),(n=s.CreateTextFile(h+"\\"+e+".xml",!0,!0)).write(r),n.Close()}}}catch(t){}})},Workbook.prototype.exportFileAsZip=function(){},Workbook.prototype.importFile=function(t,e){try{var o,i,r=function(t,e){s.sheetIndex(t),s.getStartSheet(),s.getEndSheet(),s.startPaint(!0),"function"==typeof e&&e()},s=this,a=!1;try{a=!!FileReader}catch(t){}if(a){var n=new FileReader;o=t.name.lastIndexOf("."),"json"==(i=t.name.slice(o+1))?(n.readAsText(t),n.onload=function(){s.workbook={},s.workbook=JSON.parse(this.result),s.workbook=s.initWorkbook(),r(s.workbook.activeSheet,e)}):"xlsx"==i||"zip"==i?this.excel2Json(t,function(){r(s.workbook.activeSheet,e)}):"xml"==i&&(n.readAsText(t),n.onload=function(){s.xml2Json(this.result,t,function(){r(s.workbook.activeSheet,e)})})}else window.ActiveXObject}catch(t){}},Workbook.prototype.xml2Json=function(t,e,o){var i=this.string2XML(t);this.workbook={},this.workbook=this.initWorkbook(),this.workbook.showTabs=1,this.workbook.activeSheet=0,this.workbook.sheetList=[],this.workbook.sheets={};var r=e.name;r=r.slice(0,r.lastIndexOf("."));for(var s=i.getElementsByTagName("TABLE"),a=0;a<s.length;a++){var n;n=1==s.length?r:r+"_"+(a+1),this.workbook.sheetList.push(n),this.workbook.sheets[n]={},this.initSheet(n,a);var h=this.getActiveSheet(a),l=s[a].getElementsByTagName("TBODY")[0]||s[a],c=s[a].getAttribute("class"),d=s[a].getAttribute("pagesetup"),g=l.getElementsByTagName("TR");if(s[0]){var p=this.getXmlStyleValue(s[0],"FONT-SIZE")||this.workbook.defaultFontSize;p=this.pt2px(parseFloat(p));var f=this.getXmlStyleValue(s[0],"FONT-FAMILY")||this.workbook.defaultFontName;this.workbook.defaultFontSize=p,this.workbook.defaultFontName=f,this.defaultCellStyle={font:this.workbook.defaultFontSize+"px/"+this.workbook.defaultLineHeight+"px "+this.workbook.defaultFontName}}var u=this.getXmlPageSetUpValue(d,"paper"),b=this.getXmlPageSetUpValue(d,"marginTop"),w=this.getXmlPageSetUpValue(d,"marginBottom"),k=this.getXmlPageSetUpValue(d,"marginLeft"),v=this.getXmlPageSetUpValue(d,"marginRight"),m=this.getXmlPageSetUpValue(d,"gridline"),x=this.getXmlPageSetUpValue(d,"orientation"),y=this.getXmlPageSetUpValue(d,"marginCopies"),S=this.getXmlPageSetUpValue(d,"printer"),C=this.getXmlPageSetUpValue(d,"isshowfooterpageinfo"),H=this.getXmlPageSetUpValue(d,"footpagestyle");if(u&&(h.printSetting.paper=u),b&&(h.printSetting.marginTop=parseInt(b)),w&&(h.printSetting.marginBottom=parseInt(w)),k&&(h.printSetting.marginLeft=parseInt(k)),v&&(h.printSetting.marginRight=parseInt(v)),h.printSetting.printGridLine=!!parseInt(m),x&&(h.printSetting.orientation=parseInt(x)),y&&(this.workbook.marginCopies=parseInt(y)),S&&(this.workbook.printer=S),C&&(h.printSetting.isshowfooterpageinfo=C),H&&(h.printSetting.footpagestyle=H),g){var W=0<g.length-1?g.length-1:0;this.maxRow(W,a);var A=g[0].getElementsByTagName("TD"),T=0<A.length-1?A.length-1:0;if(this.maxCol(T,a),A)for(var R=1;R<A.length;R++){var B=this.getXmlStyleValue(A[R],"WIDTH")||h.defaults.colWidth;B=parseInt(B),this.setColWidth(B,R-1,R-1,a)}for(R=1;R<g.length;R++){var O=R-1,N=this.getXmlStyleValue(g[R],"HEIGHT");N=parseInt(N),this.setRowHeight(N,O,O,a);var E=g[R].getElementsByTagName("TD");if(E)for(var F=0,L=1;L<E.length;L++){var I=L-1+F,D=parseInt(E[L].getAttribute("colSpan"))||1,P=parseInt(E[L].getAttribute("rowSpan"))||1;if(1<D&&(F+=D-1),1<P&&L&&P-1,(1<D||1<P)&&this.mergeCells(O,I,O+P-1,I+D-1,a),h.spans.forEach(function(t){O>t.row&&O<t.row+t.rowCount&&I>=t.col&&I<t.col+t.colCount&&(I+=t.colCount,F+=t.colCount)}),this.createData(O,I,a),E[L].firstChild){var z=E[L].firstChild.nodeValue;this.setValue(O,I,z,a)}var M=E[L].getAttribute("class");if(M&&c&&-1!=c.indexOf("tblGenFixed")&&(-1!=M.indexOf("rg")&&this.fontColor(O,I,O,I,"blue",a),-1!=M.indexOf("rv")&&this.setFillColor("#D8F173",O,I,O,I,a),-1!=M.indexOf("rs")&&this.setFillColor("#BFDB4D",O,I,O,I,a),-1!=M.indexOf("s1")&&(this.setChangeBorder(O,I,"black .5pt solid","BORDER-RIGHT",a),this.setChangeBorder(O,I,"white .5pt solid","BORDER-BOTTOM",a)),-1!=M.indexOf("s2")&&(this.setChangeBorder(O,I,"white .5pt solid","BORDER-RIGHT",a),this.setChangeBorder(O,I,"black .5pt solid","BORDER-BOTTOM",a)),-1!=M.indexOf("s3")&&(this.setChangeBorder(O,I,"black .5pt solid","BORDER-RIGHT",a),this.setChangeBorder(O,I,"black .5pt solid","BORDER-BOTTOM",a)),-1!=M.indexOf("sl")&&this.setChangeBorder(O,I,"black .5pt solid","BORDER-LEFT",a),-1!=M.indexOf("st")&&this.setChangeBorder(O,I,"black .5pt solid","BORDER-TOP",a),-1!=M.indexOf("fb")&&this.setFontBold(O,I,O,I,!0,a),-1!=M.indexOf("wb")&&this.wordWrap(O,I,O,I,!0,a),-1!=M.indexOf("fi")&&this.setFontItalic(O,I,O,I,!0,a),-1!=M.indexOf("fu")&&this.fontUnderline(O,I,O,I,!0,a),-1!=M.indexOf("fd")&&this.fontStrikeout(O,I,O,I,!0,a),-1!=M.indexOf("a0")&&(this.setVAlignment(O,I,O,I,2,a),this.setHAlignment(O,I,O,I,2,a)),-1!=M.indexOf("a1")&&(this.setVAlignment(O,I,O,I,2,a),this.setHAlignment(O,I,O,I,4,a)),-1!=M.indexOf("a2")&&(this.setVAlignment(O,I,O,I,2,a),this.setHAlignment(O,I,O,I,3,a)),-1!=M.indexOf("a3")&&(this.setVAlignment(O,I,O,I,1,a),this.setHAlignment(O,I,O,I,2,a)),-1!=M.indexOf("a4")&&(this.setVAlignment(O,I,O,I,1,a),this.setHAlignment(O,I,O,I,4,a)),-1!=M.indexOf("a5")&&(this.setVAlignment(O,I,O,I,1,a),this.setHAlignment(O,I,O,I,3,a)),-1!=M.indexOf("a6")&&(this.setVAlignment(O,I,O,I,3,a),this.setHAlignment(O,I,O,I,2,a)),-1!=M.indexOf("a7")&&(this.setVAlignment(O,I,O,I,3,a),this.setHAlignment(O,I,O,I,4,a)),-1!=M.indexOf("a8")&&(this.setVAlignment(O,I,O,I,3,a),this.setHAlignment(O,I,O,I,3,a))),E[L].getAttribute("style")){var V=this.getXmlStyleValue(E[L],"FONT-SIZE");V&&(V=this.pt2px(parseFloat(V)),this.setFontSize(O,I,O,I,V,a));var X=this.getXmlStyleValue(E[L],"FONT-FAMILY");X&&this.setFontName(O,I,O,I,X,a),this.getXmlStyleValue(E[L],"FONT-WEIGHT")&&this.setFontBold(O,I,O,I,!0,a),this.getXmlStyleValue(E[L],"FONT-STYLE")&&this.setFontItalic(O,I,O,I,!0,a);var j=this.getXmlStyleValue(E[L],"COLOR");j&&this.fontColor(O,I,O,I,j,a);var Y=E[L].getAttribute("x:fmla");Y&&this.setCellFormula(O,I,Y,a);var $=this.getXmlStyleValue(E[L],"BACKGROUND-COLOR");$&&this.setFillColor($,O,I,O,I,a);var J=this.getXmlStyleValue(E[L],"TEXT-ALIGN");J&&(J="left"==J?2:"center"==J?3:"right"==J?4:1,this.setHAlignment(O,I,O,I,J,a));var U=this.getXmlStyleValue(E[L],"VERTICAL-ALIGN");U&&(U="top"==U?1:"center"==U?2:3,this.setVAlignment(O,I,O,I,U,a));var G=this.getXmlStyleValue(E[L],"TEXT-DECORATION");G&&(-1!=G.indexOf("underline")&&this.fontUnderline(O,I,O,I,!0,a),-1!=G.indexOf("line-through")&&this.fontStrikeout(O,I,O,I,!0,a)),this.getXmlStyleValue(E[L],"WORD-BREAK")&&this.wordWrap(O,I,O,I,!0,a),"nowrap"==this.getXmlStyleValue(E[L],"WHITE-SPACE")&&this.wordWrap(O,I,O,I,!1,a);var q=this.getXmlStyleValue(E[L],"BORDER");this.setChangeBorder(O,I,q,"BORDER",a);var _=this.getXmlStyleValue(E[L],"BORDER-LEFT");this.setChangeBorder(O,I,_,"BORDER-LEFT",a);var K=this.getXmlStyleValue(E[L],"BORDER-RIGHT");this.setChangeBorder(O,I,K,"BORDER-RIGHT",a);var Z=this.getXmlStyleValue(E[L],"BORDER-TOP");this.setChangeBorder(O,I,Z,"BORDER-TOP",a);var Q=this.getXmlStyleValue(E[L],"BORDER-BOTTOM");this.setChangeBorder(O,I,Q,"BORDER-BOTTOM",a);var tt=this.getXmlStyleValue(E[L],"MSO-NUMBER-FORMAT");tt&&this.xmlFormat2JsonFormat(O,I,tt,a)}}}this.row(0,a),this.col(0,a),this.setTableSize(window.innerWidth-this.scrollbarWidth,window.innerHeight-this.scrollbarWidth)}this.showColHeading(!0,a),this.showRowHeading(!0,a)}o()},Workbook.prototype.json2Xml=function(t){for(var e=0;e<this.workbook.sheetList.length;e++){var o=this.createXmlDoc(),i=this.getActiveSheet(e),r=i.data.dataTable,s=i.columns,a=i.rows,n=0,h=o.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');o.appendChild(h);var l=o.createElement("TABLE"),c=o.createElement("TBODY"),d=i.printSetting.paper;d=d?"paper:'"+d+"',":"";var g=i.printSetting.orientation;g=g?"orientation:'"+g+"',":"";var p=i.printSetting.printGridLine?1:0;p="gridline:'"+p+"',";var f=this.workbook.marginCopies;f=0<=parseInt(f)?"marginCopies:'"+f+"mm',":"";var u=this.workbook.printer;u=u?"printer:'"+u+"',":"";var b=i.printSetting.isshowfooterpageinfo;b=0<=parseInt(b)?"isshowfooterpageinfo:'"+b+"',":"";var w=i.printSetting.footpagestyle;w=w?"footpagestyle:'"+w+"',":"";var k=i.printSetting.marginTop;k=0<=parseInt(k)?"marginTop:'"+k+"mm',":"";var v=i.printSetting.marginBottom;v=0<=parseInt(v)?"marginBottom:'"+v+"mm',":"";var m=i.printSetting.marginLeft;m=0<=parseInt(m)?"marginLeft:'"+m+"mm',":"";var x=i.printSetting.marginRight;x=0<=parseInt(x)?"marginRight:'"+x+"mm',":"",l.setAttribute("pagesetup","{"+d+g+p+f+u+b+w+k+v+m+x+"}"),l.setAttribute("class","tblGenFixed");for(var y=0;y<s.length;y++)s[y]&&(n+=s[y].size);n=n?"WIDTH:"+n+"px;":"";var S=this.workbook.defaultFontSize?"FONT-SIZE:"+this.px2pt(this.workbook.defaultFontSize)+"pt;":"";l.setAttribute("style",n+S),o.appendChild(l);var C=o.getElementsByTagName("TABLE")[0];C.appendChild(c);var H=o.getElementsByTagName("TBODY")[0]||C,W=Object.keys(r),A=0;1<=W.length&&(A=Math.max.apply(null,W));for(var T=[],R=0,B=0;B<=A;B++)if(r[B]){var O=Object.keys(r[B]);1<=O.length&&(R=Math.max.apply(null,O)),T.push(R)}if(1<=T.length&&(R=Math.max.apply(null,T)),0<a.length){var N=o.createElement("TR");N.setAttribute("class","firstrow"),N.setAttribute("style","HEIGHT:1px"),H.appendChild(N);for(var E=H.getElementsByTagName("TR")[0],F=-1;F<=R;F++){var L=o.createElement("TD"),I=i.defaults.colWidth;-1==F?I=1:s[F]&&(I=s[F].size),L.setAttribute("style","WIDTH:"+I+"px"),E.appendChild(L)}}for(y=0;y<=A;y++){var D=o.createElement("TR"),P="DISPLAY: block; HEIGHT:"+(a[y].size||i.defaults.rowHeight)+"px";D.setAttribute("style",P),H.appendChild(D)}var z,M,V=H.getElementsByTagName("TR")||[],X=i.spans;for(y=1;y<V.length;y++){z=y-1;var j=o.createElement("TD");V[y].appendChild(j);for(var Y=0;Y<=R;Y++){M=Y;var $=o.createElement("TD"),J=0,U=0;X.forEach(function(t){z==t.row&&M==t.col&&(J=t.colCount,U=t.rowCount,1<J&&$.setAttribute("colSpan",J),1<U&&$.setAttribute("rowSpan",U))}),V[y].appendChild($)}}for(var G in r){var q=parseInt(G);for(var _ in r[G]){var K=parseInt(_),Z=V[q+1].getElementsByTagName("TD")[K+1],Q=this.getValue(q,K,q,K,e);Q&&Z.appendChild(o.createTextNode(Q));var tt=this.getAlignment(q,K,q,K,e);if(tt){var et=tt.hAlign,ot=tt.vAlign;et=(et=2==et?"left":3==et?"center":4==et?"right":"")&&"TEXT-ALIGN:"+et+";",ot=(ot=1==ot?"top":3==ot?"bottom":"")&&"VERTICAL-ALIGN:"+ot+";"}var it=this.getCellFormula(q,K,q,K,e);it&&Z.setAttribute("x:fmla",it);var rt=this.getFontList(q,K,e),st=rt.originName||"";st=st!=this.workbook.defaultFontName?"FONT-FAMILY:"+st+";":"";var at=rt.originItalic||"";at=at&&"FONT-STYLE:"+at+";";var nt=rt.originBold||"";nt=nt&&"FONT-WEIGHT:"+nt+";";var ht=rt.originSize||"";ht=ht!=this.workbook.defaultFontSize?"FONT-SIZE:"+this.px2pt(ht)+"pt;":"";var lt=this.getFontColor(q,K,q,K,e)||"";lt=lt&&"COLOR:"+lt+";";var ct=this.getFillColor(q,K,q,K,e)||"";ct=ct&&"BACKGROUND-COLOR:"+ct+";";var dt=this.getFontUnderline(q,K,q,K,e)||"",gt=this.getFontStrikeout(q,K,q,K,e)||"",pt="";dt&&gt?pt="TEXT-DECORATION:underline line-through;":dt&&!gt?pt="TEXT-DECORATION:underline;":!dt&&gt&&(pt="TEXT-DECORATION:line-through;");var ft=this.getWordWrap(q,K,q,K,e)||"";ft=ft&&"WORD-BREAK:break-all;";var ut=this.getBorder(q,K,q,K,e),bt="",wt="",kt="",vt="";ut&&(bt=ut.borderRight||"",rStyle=1,rColor="#000",bt&&(rStyle=1==bt.style?"thin":2==bt.style?"medium":5==bt.style?"thick":"thin",rColor=bt.color||"#000",bt="BORDER-RIGHT:"+rStyle+" solid "+rColor+";"),wt=ut.borderLeft||"",lStyle=1,lColor="#000",wt&&(lStyle=1==wt.style?"thin":2==wt.style?"medium":5==wt.style?"thick":"thin",lColor=wt.color||"#000",wt="BORDER-LEFT:"+lStyle+" solid "+lColor+";"),kt=ut.borderBottom||"",bStyle=1,bColor="#000",kt&&(bStyle=1==kt.style?"thin":2==kt.style?"medium":5==kt.style?"thick":"thin",bColor=kt.color||"#000",kt="BORDER-BOTTOM:"+bStyle+" solid "+bColor+";"),vt=ut.borderTop||"",tStyle=1,tColor="#000",vt&&(tStyle=1==vt.style?"thin":2==vt.style?"medium":5==vt.style?"thick":"thin",tColor=vt.color||"#000",vt="BORDER-TOP:"+tStyle+" solid "+tColor+";"));var mt=this.getCellFormat(q,K,q,K,e)||"";if(mt)mt="MSO-NUMBER-FORMAT:"+(mt=this.jsonFormat2XmlFormat(q,K,mt,e))+";";var xt=et+ot+st+at+nt+ht+lt+ct+pt+ft+bt+wt+kt+vt+mt;xt&&Z.setAttribute("style",xt)}}for(var yt=V.length-1;1<=yt;yt--)for(var St=V[yt].getElementsByTagName("TD")||[],Ct=St.length-1;1<=Ct;Ct--)X.forEach(function(t){(t.row==yt-1&&Ct-1>t.col&&Ct-1<t.col+t.colCount||t.col==Ct-1&&yt-1>t.row&&yt-1<t.row+t.rowCount||yt-1>t.row&&yt-1<t.row+t.rowCount&&Ct-1>t.col&&Ct-1<t.col+t.colCount)&&V[yt].removeChild(St[Ct])});"function"==typeof t&&t(o,i.sheetName)}},Workbook.prototype.excel2Json=function(t,Fe){this.workbook={},this.workbook=this.initWorkbook();var Le,Ie,De=this,Pe=/^(xl\/worksheets\/sheet)[0-9]+(\.xml)$/,ze=[],Me=[],Ve=/^\-[0-9]+\.?[0-9]*$|^[0-9]+\.?[0-9]*$/,Xe={};JSZip.loadAsync(t).then(function(t){var s=[];t.forEach(function(t){s.push(t)}),function e(o,i){if(s[o]&&o<s.length){var r=s[o];t.file(r).async("string").then(function(t){return Xe[r]=t,e(++o,i),!0})}else i()}(0,function(){if(Xe["xl/theme/theme1.xml"]&&(Le=De.string2XML(Xe["xl/theme/theme1.xml"])),Xe["xl/styles.xml"]&&(Ie=De.string2XML(Xe["xl/styles.xml"])),Xe["xl/workbook.xml"]){var t=De.string2XML(Xe["xl/workbook.xml"]),e=t.getElementsByTagName("sheets")[0].childNodes;for(De.workbook.sheetList=[],De.workbook.sheets={},C=0;C<e.length;C++){De.workbook.showTabs=1;var o=e[C].getAttribute("name");De.workbook.sheetList.push(o);var i=e[C].getAttribute("sheetId");De.workbook.sheets[o]={},De.initSheet(o,C),De.workbook.sheets[o].sheetId=i}De.setTableSize(window.innerWidth-De.scrollbarWidth,window.innerHeight-De.scrollbarWidth);var r=t.getElementsByTagName("workbookView")[0];if(r){var s=r.getAttribute("activeTab")||0;De.workbook.activeSheet=parseInt(s);var a="0"==r.getAttribute("showVerticalScroll")?0:1,n="0"==r.getAttribute("showHorizontalScroll")?0:1;De.workbook.showVScrollBar=a,De.workbook.showHScrollBar=n}var h=Ie.getElementsByTagName("fonts")[0];if(h){var l=h.getElementsByTagName("font");if(l&&1<=l.length){var c,d,g,p=l[0].getElementsByTagName("sz")[0],f=l[0].getElementsByTagName("color")[0],u=l[0].getElementsByTagName("name")[0];if(p)(g=p.getAttribute("val"))&&(g=De.pt2px(g),De.workbook.defaultFontSize=g);if(f){var b=f.getAttribute("rgb"),w=f.getAttribute("theme"),k=f.getAttribute("tint")||0;b?c="#"+b.slice(2):w&&(c=De.getExcelThemeColor(Le,Number(w),Number(k))),c&&(De.defaultCellStyle={fontColor:c})}if(u){var v=u.getAttribute("val");v&&(d=v,De.workbook.defaultFontName=d)}De.defaultCellStyle={font:De.workbook.defaultFontSize+"px/"+De.workbook.defaultLineHeight+"px "+De.workbook.defaultFontName}}}}for(var m in Xe)if(Pe.test(m))for(var x=m.lastIndexOf("."),y=m.lastIndexOf("t"),S=m.substring(y+1,x),C=0;C<De.workbook.sheetList.length;C++)if(S==De.workbook.sheets[De.workbook.sheetList[C]].sheetId){var H=De.workbook.sheets[De.workbook.sheetList[C]],W=De.string2XML(Xe[m]);delete H.sheetId;var A=W.getElementsByTagName("sheetView")[0];if(A){var T=A.getAttribute("showGridLines");H.showGridLines=0!=T;var R=A.getAttribute("showRowColHeaders");H.rowHeaderData.showRowHeading=0!=R,H.colHeaderData.showColHeading=0!=R}var B=W.getElementsByTagName("mergeCells")[0];if(B)for(var O=B.childNodes,N=0;N<O.length;N++){var E=O[N].getAttribute("ref").split(":"),F=E[0],L=E[1],I=Number(F.match(/[0-9]+$/g).join(""))-1,D=De.excelLetter2Num(F.match(/^[A-Z]+/g).join(""))-1,P=Number(L.match(/[0-9]+$/g).join(""))-I,z=De.excelLetter2Num(L.match(/^[A-Z]+/g).join(""))-D;H.spans.push({row:I,rowCount:P,col:D,colCount:z})}var M=W.getElementsByTagName("sheetFormatPr")[0],V=14,X=8.09;M&&(V=Math.floor(M.getAttribute("defaultRowHeight"))||14,X=Math.floor(M.getAttribute("defaultColWidth"))||8.09),H.defaults.rowHeight=De.pt2px(V),De.workbook.defaultLineHeight=De.pt2px(V),H.defaults.colWidth=Math.floor(X/10*De.dpi),De.defaultCellStyle={font:De.workbook.defaultFontSize+"px/"+De.workbook.defaultLineHeight+"px "+De.workbook.defaultFontName};var j=W.getElementsByTagName("row"),Y=[];if(j){var $=parseInt(j[j.length-1].getAttribute("r"));De.maxRow($,C);for(var J=0;J<$;J++)if(j[J]){var U=j[J].getElementsByTagName("c");if(U)for(var G=0;G<U.length;G++)if(U[G]){var q=U[G].getAttribute("r");q&&Y.push(De.excelLetter2Num(q.match(/^[A-Z]+/g).join(""))-1)}var _=j[J].getAttribute("ht"),K=_?De.pt2px(_):H.defaults.rowHeight;De.setRowHeight(K,J,J,C)}}var Z=W.getElementsByTagName("col"),Q=[];if(Z)for(var tt=0;tt<Z.length;tt++)for(var et=Number(Z[tt].getAttribute("width"))-1,ot=Number(Z[tt].getAttribute("max"))-1,it=Number(Z[tt].getAttribute("min"))-1;it<=ot;it++)Q.push({c:it,width:et});var rt=0;if(1<=Y.length){rt=Math.max.apply(null,Y),De.maxCol(rt+1,C);for(it=0;it<=rt;it++){var st=H.defaults.colWidth;for(tt=0;tt<Q.length;tt++)it==Q[tt].c&&(st=Math.floor(Q[tt].width/10*De.dpi));De.setColWidth(st,it,it,C)}}var at=W.getElementsByTagName("pane")[0];if(at)if("frozen"==at.getAttribute("state")){var nt=at.getAttribute("topLeftCell"),ht=Number(nt.match(/[0-9]+$/g).join(""))-1,lt=De.excelLetter2Num(nt.match(/^[A-Z]+/g).join(""))-1,ct=at.getAttribute("ySplit"),dt=at.getAttribute("xSplit"),gt=ht-Number(ct),pt=lt-Number(dt);De.fixedRowAndCol(ht,lt,gt,pt,C)}var ft=W.getElementsByTagName("selection")[0];if(ft){var ut=ft.getAttribute("activeCell"),bt=0,wt=0;ut&&(bt=De.excelLetter2Num(ut.match(/^[A-Z]+/g).join(""))-1,wt=Number(ut.match(/[0-9]+$/g).join(""))-1),De.row(wt,C),De.col(bt,C)}var kt=W.getElementsByTagName("c");if(kt)for(var vt=0;vt<kt.length;vt++){var mt,xt,yt,St,Ct=kt[vt].getAttribute("r"),Ht=kt[vt].getAttribute("t"),Wt=kt[vt].getAttribute("s");Ct&&(mt=Number(Ct.match(/[0-9]+$/g).join(""))-1,xt=De.excelLetter2Num(Ct.match(/^[A-Z]+/g).join(""))-1);var At=kt[vt].getElementsByTagName("v")[0],Tt=kt[vt].getElementsByTagName("f")[0];At&&(yt=At.firstChild.nodeValue,void 0!==mt&&void 0!==xt&&void 0!==yt&&"s"!=Ht&&(Ve.test(yt)&&(yt=Number(yt)),De.setValue(mt,xt,yt,C)),"s"==Ht&&ze.push({r:mt,c:xt,v:yt,i:C})),Tt&&(St=Tt.firstChild.nodeValue)&&De.setCellFormula(mt,xt,"="+St,C),Wt&&Me.push({r:mt,c:xt,s:Wt,i:C})}var Rt=W.getElementsByTagName("sheetProtection")[0],Bt=H.rows,Ot=H.columns;if(Rt)"1"==Rt.getAttribute("selectLockedCells")?De.setLock(0,0,Bt.length-1,Ot.length-1,!0,C):De.setCanEdit(0,0,Bt.length-1,Ot.length-1,!1,C)}if(Xe["xl/sharedStrings.xml"]){var Nt=De.string2XML(Xe["xl/sharedStrings.xml"]).getElementsByTagName("t");if(Nt)for(var Et=0;Et<ze.length;Et++){var Ft=Nt[Number(ze[Et].v)].firstChild.nodeValue;De.setValue(ze[Et].r,ze[Et].c,Ft,ze[Et].i)}}if(Xe["xl/styles.xml"]){var Lt=Ie.getElementsByTagName("cellXfs")[0],It=Ie.getElementsByTagName("fills")[0],Dt=Ie.getElementsByTagName("borders")[0],Pt=Ie.getElementsByTagName("fonts")[0],zt=Ie.getElementsByTagName("numFmts")[0];if(Lt){var Mt=Lt.getElementsByTagName("xf");if(Mt)for(tt=0;tt<Me.length;tt++){var Vt,Xt,jt=Mt[Number(Me[tt].s)],Yt=Me[tt].r,$t=Me[tt].c,Jt=Me[tt].i,Ut=jt.getElementsByTagName("alignment")[0],Gt=jt.getElementsByTagName("protection")[0],qt=jt.getAttribute("applyAlignment"),_t=jt.getAttribute("applyFill"),Kt=jt.getAttribute("applyBorder"),Zt=jt.getAttribute("applyFont"),Qt=jt.getAttribute("applyNumberFormat"),te=jt.getAttribute("applyProtection"),ee=jt.getAttribute("fillId"),oe=jt.getAttribute("borderId"),ie=jt.getAttribute("fontId")||"0",re=jt.getAttribute("numFmtId");if(Ut&&"1"==qt?(Vt="left"==(Vt=Ut.getAttribute("horizontal"))?2:"center"==Vt?3:"right"==Vt?4:1,Xt="top"==(Xt=Ut.getAttribute("vertical"))?1:"center"==Xt?2:3,"1"==Ut.getAttribute("wrapText")&&De.wordWrap(Yt,$t,Yt,$t,!0,Jt)):(Vt=1,Xt=3),De.setHAlignment(Yt,$t,Yt,$t,Vt,Jt),De.setVAlignment(Yt,$t,Yt,$t,Xt,Jt),Gt&&"1"==te)"0"==Gt.getAttribute("locked")&&(De.setLock(Yt,$t,Yt,$t,!1,Jt),De.setCanEdit(Yt,$t,Yt,$t,!0,Jt));if("1"==_t&&2<=Number(ee)&&It){var se=It.getElementsByTagName("fill");if(se)for(it=0;it<se.length;it++)if(Number(ee)==it){var ae=se[it].getElementsByTagName("fgColor")[0];if(ae){var ne,he=ae.getAttribute("rgb"),le=ae.getAttribute("theme"),ce=ae.getAttribute("tint")||0;he?ne="#"+he.slice(2):le&&(ne=De.getExcelThemeColor(Le,Number(le),Number(ce))),De.setFillColor(ne,Yt,$t,Yt,$t,Jt)}}}if("1"==Kt&&1<=Number(oe)&&Dt){var de=Dt.getElementsByTagName("border");if(de)for(it=0;it<de.length;it++)if(Number(oe)==it){var ge=de[it].getElementsByTagName("left")[0],pe=de[it].getElementsByTagName("right")[0],fe=de[it].getElementsByTagName("top")[0],ue=de[it].getElementsByTagName("bottom")[0];ge&&De.excelBorder2canvas(Le,ge,"left",Yt,$t,Jt),pe&&De.excelBorder2canvas(Le,pe,"right",Yt,$t,Jt),fe&&De.excelBorder2canvas(Le,fe,"top",Yt,$t,Jt),ue&&De.excelBorder2canvas(Le,ue,"bottom",Yt,$t,Jt)}}if(Pt){var be=Pt.getElementsByTagName("font");if(be&&"1"==Zt)for(it=0;it<be.length;it++)if(Number(ie)==it){var we,ke,ve,me=be[it].getElementsByTagName("sz")[0],xe=be[it].getElementsByTagName("color")[0],ye=be[it].getElementsByTagName("name")[0],Se=be[it].getElementsByTagName("b")[0],Ce=be[it].getElementsByTagName("i")[0],He=be[it].getElementsByTagName("strike")[0],We=be[it].getElementsByTagName("u")[0];if(me){var Ae=me.getAttribute("val");Ae&&(we=De.pt2px(Ae))}if(xe){var Te=xe.getAttribute("rgb"),Re=xe.getAttribute("theme"),Be=xe.getAttribute("tint")||0;Te?ke="#"+Te.slice(2):Re&&(ke=De.getExcelThemeColor(Le,Number(Re),Number(Be)))}if(ye){var Oe=ye.getAttribute("val");Oe&&(ve=Oe)}Se&&De.setFontBold(Yt,$t,Yt,$t,!0,Jt),Ce&&De.setFontItalic(Yt,$t,Yt,$t,!0,Jt),He&&De.fontStrikeout(Yt,$t,Yt,$t,!0,Jt),We&&De.fontUnderline(Yt,$t,Yt,$t,!0,Jt),ke&&De.fontColor(Yt,$t,Yt,$t,ke,Jt),ve&&De.setFontName(Yt,$t,Yt,$t,ve,Jt),we&&De.setFontSize(Yt,$t,Yt,$t,we,Jt)}}if("1"==Qt&&1<=re&&zt){var Ne=zt.getElementsByTagName("numFmt");if(Ne)for(it=0;it<Ne.length;it++){if(Ne[it].getAttribute("numFmtId")==re){var Ee=Ne[it].getAttribute("formatCode");De.xmlFormat2JsonFormat(Yt,$t,Ee,Jt)}}}}}}Fe()})})},Workbook.prototype.getExcelThemeColor=function(t,e,o){var i=t.getElementsByTagName("a:clrScheme")[0];if(i){var r=i.childNodes;if(r&&1<=r.length){var s=e;0==e&&(s=1),1==e&&(s=0),2==e&&(s=3),3==e&&(s=2);var a=r[s].childNodes[0];if(a){var n;if(n=0==s||1==s?"#"+a.getAttribute("lastClr"):"#"+a.getAttribute("val"),0!=o){var h=this.colorHex2Rgb(n).replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),l=Math.floor(Number(h[0])*(1+o)),c=Math.floor(Number(h[1])*(1+o)),d=Math.floor(Number(h[2])*(1+o));255<l&&(l=255),255<c&&(c=255),255<d&&(d=255),n="rgb("+l+","+c+","+d+")"}return n}}}},Workbook.prototype.excelBorder2canvas=function(t,e,o,i,r,s){var a=e.getAttribute("style");a="thin"==a?1:"meduim"==a?2:"thick"==a?5:1;var n=e.getElementsByTagName("color")[0],h="#000";if(n){var l=n.getAttribute("rgb"),c=n.getAttribute("theme"),d=n.getAttribute("tint")||0;l?h="#"+l.slice(2):c&&(h=this.getExcelThemeColor(t,Number(c),Number(d))),"left"==o&&this.setLeftBorder(i,r,i,r,a,h,s),"right"==o&&this.setRightBorder(i,r,i,r,a,h,s),"top"==o&&this.setTopBorder(i,r,i,r,a,h,s),"bottom"==o&&this.setBottomBorder(i,r,i,r,a,h,s)}},Workbook.prototype.jsonFormat2XmlFormat=function(t,e,o,i){var r=o,s=Number(this.getValue(t,e,t,e,i));"yyyy年m月d日"==o&&(r='yyyy"年"m"月"d"日"'),"yyyy年m月"==o&&(r='yyyy"年"m"月"'),"m月d日"==o&&(r='m"月"d"日"'),"星期n"==o&&(r="[$-804]aaaa"),"m/d"==o&&(r="m/d");if(/^0*(P\+%)$/.test(o)){var a=o.indexOf("P"),n=o.slice(0,a),h=0;n&&(h=n.length),r="0."+Array(h+1).join("0")+"%"}if(/^0*NR?\(?A?(\+thousands)?/.test(o)){var l=o.indexOf("N"),c=o.slice(0,l),d=0;c&&(d=c.length);var g="."+Array(d+1).join("0"),p=-1!=o.indexOf("+thousands")?"#,##":"";if(0<=s)r=p+"0"+g+"_";else{var f=-1!=o.indexOf("R")?"[Red]":"",u=o.indexOf("("),b=o.indexOf("A");r=-1!=u?p+"0"+g+"_);"+f+"\\("+p+"0"+g+"\\)":-1!=b?p+"0"+g+";"+f+p+"0"+g:f?p+"0"+g+"_;"+f+"\\-0"+g+"\\":p+"0"+g+"_"}}if(/^0*MR?\(?A?(\+[¥|$|€|￡|₣|₩])?/.test(o)){var w=o.indexOf("M"),k=o.slice(0,w),v=0;k&&(v=k.length);var m="."+Array(v+1).join("0"),x=o.match(/[¥|$|€|￡|₣|₩]/g)||"";x=x&&x[0];var y=o.indexOf("("),S=o.indexOf("A"),C=-1!=o.indexOf("R")?"[Red]":"";-1!=y?r='"'+x+'"#,##0'+m+"_);"+C+'\\("'+x+'"#,##0'+m+"\\)":s<0&&C&&-1!=S?r='"'+x+'"#,##0'+m+";"+C+'"'+x+'"#,##0'+m:(0<=s||s<0&&-1==S)&&(r='"'+x+'"#,##0'+m+";"+C+'"'+x+'"-#,##0'+m)}return r},Workbook.prototype.xmlFormat2JsonFormat=function(t,e,o,i){if(/^(yyyy\"年\"m\"月\"d\"日\")(;@)?$/.test(o)){this.setCellFormat(t,e,t,e,"yyyy年m月d日",i);var r=this.getValue(t,e,t,e,i);if(null!=r){var s=this.excelDateToJSDate(r,"/");s&&this.setText(t,e,s,i)}}if(/^(yyyy\"年\"m\"月\")(;@)?$/.test(o)){this.setCellFormat(t,e,t,e,"yyyy年m月",i);var a=this.getValue(t,e,t,e,i);if(null!=a){var n=this.excelDateToJSDate(a,"/");n&&this.setText(t,e,n,i)}}if(/^(m\"月\"d\"日\")(;@)?$/.test(o)){this.setCellFormat(t,e,t,e,"m月d日",i);var h=this.getValue(t,e,t,e,i);if(null!=h){var l=this.excelDateToJSDate(h,"/");l&&this.setText(t,e,l,i)}}if(/^((#,##)?0\.?0*)(_?\s*\)?;?(\[Red\])?\\?\(?-?(#,##)?0?\.?0*\\?\)?\s*)$/.test(o)){var c=this.getValue(t,e,t,e,i),d=-1!=o.indexOf("#,##")?"+thousands":"",g=-1!=o.indexOf("[Red]")&&Number(c)<0&&c<0?"R":"",p=o.match(/\(-?(#,##)?0?\.?0*\\?\)/g),f=o.match(/0\.?0*/g),u=0;(f=f&&f[0])&&(u=f.slice(f.indexOf(".")+1).length),p&&p.join("");var b=-1!=o.indexOf(p)&&Number(c)<0&&c<0?"(":"",w=-1==o.indexOf("-")&&Number(c)<0&&(-1!=o.indexOf("-")||!/^((#,##)?0\.?0*)_\s*$/.test(o))?"A":"",k=Array(u+1).join("0")+"N"+g+b+w+d;this.setCellFormat(t,e,t,e,k,i)}if(/^(("[¥|$|€|￡|₣|₩]")(#,##)?0\.?0*)(_?\s*\)?;?(\[Red\])?("[¥|$|€|￡|₣|₩]")?\\?\(?-?("[¥|$|€|￡|₣|₩]")?(#,##)?0?\.?0*\\?\)?\s*)$/.test(o)){var v=this.getValue(t,e,t,e,i),m=o.slice(1,2),x=-1!=o.indexOf("[Red]")&&"number"==typeof v&&v<0?"R":"",y=o.match(/\(-?("[¥|$|€|￡|₣|₩]")?(#,##)?0?\.?0*\\?\)/g);y&&y.join("");var S=-1!=o.indexOf(y)&&"number"==typeof v&&v<0?"(":"",C=-1==o.indexOf("-")&&"number"==typeof c&&c<0?"A":"",H=o.match(/0\.?0*/g),W=0;(H=H&&H[0])&&(W=H.slice(H.indexOf(".")+1).length);var A=Array(W+1).join("0")+"M"+x+S+C+"+"+m;this.setCellFormat(t,e,t,e,A,i)}if(/^(m\/d)(;@)?$/.test(o)){this.setCellFormat(t,e,t,e,"m/d",i);var T=this.getValue(t,e,t,e,i);if(null!=T){var R=this.excelDateToJSDate(T,"/");R&&this.setText(t,e,R,i)}}if(/^(\[\$-804\]aaaa)(;@)?$/.test(o)){this.setCellFormat(t,e,t,e,"星期n",i);var B=this.getValue(t,e,t,e,i);if(null!=B){var O=this.excelDateToJSDate(B,"/");O&&this.setText(t,e,O,i)}}if(/^(0\.)0*%$/.test(o)){var N=o.indexOf("."),E=o.indexOf("%"),F=o.slice(N+1,E),L=0;F&&(L=F.length);var I=Array(L+1).join("0")+"P+%";this.setCellFormat(t,e,t,e,I,i)}},Workbook.prototype.setChangeBorder=function(t,e,o,i,r){if(o&&""!=o.trim()){i=i.split("-"),o=o.trim().split(/\s+/);for(var s=/(none|hidden|dotted|dashed|solid|double|groove|ridge|inset|outset|inherit)/g,a=/^[0-9]*\.?[0-9]*(px|pt)?$|^(thin|medium|thick)$/g,n=1,h="#000",l=0;l<o.length;l++)s.test(o[l])||a.test(o[l])||(h=o[l]),o[l].match(s)&&o[l],o[l].match(a)&&(n=o[l]);/^\./.test(n="thin"==n?1:"medium"==n?2:"thick"==n?5:n)&&(n="0"+n),/(pt)$/.test(n)&&(n=this.pt2px(n.replace(/pt/,""))||1),n=5<=(n=parseInt(n))?5:3<=n&&n<=4?2:1,"LEFT"!=i[1]&&"BORDER"!=i||this.setLeftBorder(t,e,t,e,n,h,r),"RIGHT"!=i[1]&&"BORDER"!=i||this.setRightBorder(t,e,t,e,n,h,r),"TOP"!=i[1]&&"BORDER"!=i||this.setTopBorder(t,e,t,e,n,h,r),"BOTTOM"!=i[1]&&"BORDER"!=i||this.setBottomBorder(t,e,t,e,n,h,r)}},Workbook.prototype.string2XML=function(t){var e;return window.ActiveXObject?((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t),e):e=(new DOMParser).parseFromString(t,"text/xml")},Workbook.prototype.xml2String=function(t){return window.ActiveXObject?t.xml:(new XMLSerializer).serializeToString(t)},Workbook.prototype.createXmlDoc=function(){var t=null;return window.ActiveXObject?t=new ActiveXObject("Microsoft.XMLDOM"):document.implementation&&document.implementation.createDocument&&(t=document.implementation.createDocument("","",null)),t},Workbook.prototype.getXmlStyleValue=function(t,e){if(t){var o,i=t.getAttribute("style");if(i&&(o=i.split(e+":")[1])){var r=(o=o.split(":")[0].trim()).lastIndexOf(";");-1!=r&&(o=o.slice(0,r).trim())}return o}},Workbook.prototype.getXmlPageSetUpValue=function(t,e){var o;return t&&(o=(o=t.split(e+":")[1])&&((o=(o=o.split(",")[0].trim()).match(/[^"']/g))&&o.join(""))),o},Workbook.prototype.pt2px=function(t){return Math.floor(Number(t)/72*this.dpi)},Workbook.prototype.px2pt=function(t){return(Number(t)/this.dpi*72).toFixed(2)-0},Workbook.prototype.stopDefault=function(t){t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1},Workbook.prototype.stopBubble=function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},Workbook.prototype.typeObj=function(t){var e=Object.prototype.toString.call(t);return"[object Array]"==e?"Array":"[object Object]"==e?"Object":"obj is not object or array"},Workbook.prototype.getStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e]},Workbook.prototype.throttle=function(r,s,a){var n=null,h=new Date,l=this;return function(t){l.isHasVBar()&&l.isShowBar&&(l.stopDefault(t),l.stopBubble(t));var e=this,o=arguments,i=new Date;a<=i-h?(r.apply(e,o),h=i):(clearTimeout(n),n=setTimeout(function(){r.apply(e,o)},s))}},Workbook.prototype.getPixelRatio=function(){var t=this.ctx.backingStorePixelRatio||this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},Workbook.prototype.addEvent=function(t,e,o){t.addEventListener?t.addEventListener(e,o,!1):t.attachEvent?t.attachEvent("on"+e,o):t["on"+e]=o},Workbook.prototype.removeEvent=function(t,e,o){t.removeEventListener?t.removeEventListener(e,o,!1):t.detachEvent?t.detachEvent("on"+e,o):t["on"+e]=null},Workbook.prototype.num2ExcelLetter=function(t){var s=[];return function t(e){var o=e-1,i=parseInt(o/26),r=o%26;s.push(String.fromCharCode(64+parseInt(1+r))),0<i&&t(i)}(t),s.reverse().join("")},Workbook.prototype.excelLetter2Num=function(t){for(var e=t.toLowerCase().split(""),o=e.length,i=0,r=0;r<o;r++)i+=(e[r].charCodeAt()-96)*Math.pow(26,o-r-1);return i},Workbook.prototype.colorHex2Rgb=function(t){if(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t)){var e=t.toLowerCase();if(4==e.length){for(var o="#",i=1;i<4;i++)o+=e.slice(i,i+1).concat(e.slice(i,i+1));e=o}for(var r=[],s=1;s<7;s+=2)r.push(parseInt(e.slice(s,s+2),16));return"rgb("+r.join(",")+")"}return t},Workbook.prototype.colorRgb2Hex=function(t){if(/^(rgb|RGB)/.test(t)){for(var e="#",o=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(","),i=0;i<o.length;i++){var r=Number(o[i]).toString(16);1==r.length&&(r="0"+r),e+=r}return e}return String(t)},Workbook.prototype.getScrollBarWidth=function(){var t,e,o=document.createElement("div"),i={width:"100px",height:"100px",overflowY:"scroll"};for(t in i)o.style[t]=i[t];return document.body.appendChild(o),e=o.offsetWidth-o.clientWidth,document.body.removeChild(o),e},Object.defineProperty(Workbook.prototype,"checkBoxBorderColor",{value:"#C5C1AA",writable:!0}),Object.defineProperty(Workbook.prototype,"checkBoxFillColor",{value:"#F0F0F0",writable:!0}),Object.defineProperty(Workbook.prototype,"checkBoxBorderColorH",{value:"rgba(30,144,255,.4)",writable:!0}),Object.defineProperty(Workbook.prototype,"checkBoxFillColorH",{value:"rgba(240,248,255)",writable:!0}),Object.defineProperty(Workbook.prototype,"editSelStart",{value:0,writable:!0}),Object.defineProperty(Workbook.prototype,"editSelEnd",{value:0,writable:!0}),Object.defineProperty(Workbook.prototype,"document",{value:document,writable:!0}),Object.defineProperty(Workbook.prototype,"checkBoxW",{value:13,writable:!1}),Object.defineProperty(Workbook.prototype,"checkBoxH",{value:13,writable:!1}),Object.defineProperty(Workbook.prototype,"numColW",{get:function(){return this.activeSheet.rowHeaderData.showRowHeading?this.activeSheet.rowHeaderData.defaultW:0}}),Object.defineProperty(Workbook.prototype,"numRowH",{get:function(){return this.activeSheet.colHeaderData.showColHeading?this.activeSheet.colHeaderData.defaultH:0}}),Object.defineProperty(Workbook.prototype,"defaultCellStyle",{get:function(){return this._defaultCellStyle},set:function(t){this._defaultCellStyle.fontColor=t.fontColor||this._defaultCellStyle.fontColor,this._defaultCellStyle.hAlign=t.hAlign||this._defaultCellStyle.hAlign,this._defaultCellStyle.cellType=t.cellType||this._defaultCellStyle.cellType,this._defaultCellStyle.lock=t.lock||this._defaultCellStyle.lock,this._defaultCellStyle.vAlign=t.vAlign||this._defaultCellStyle.vAlign,this._defaultCellStyle.formatter=t.formatter||this._defaultCellStyle.formatter,this._defaultCellStyle.font=t.font||this._defaultCellStyle.font,this._defaultCellStyle.wordWrap=t.wordWrap||this._defaultCellStyle.wordWrap}}),Object.defineProperty(Workbook.prototype,"scrollSize",{value:7,writable:!0}),Object.defineProperty(Workbook.prototype,"bottomBtn",{value:[],writable:!0}),Object.defineProperty(Workbook.prototype,"tabsHeight",{get:function(){return 0==this.workbook.showTabs?0:this._tabsHeight},set:function(t){this._tabsHeight=t}}),Object.defineProperty(Workbook.prototype,"tabArrowWidth",{value:5,writable:!0}),Object.defineProperty(Workbook.prototype,"tabArrowHeight",{value:8,writable:!0}),Object.defineProperty(Workbook.prototype,"tabArrowStartX",{value:15,writable:!0}),Object.defineProperty(Workbook.prototype,"isEdit",{value:!1,writable:!0}),Object.defineProperty(Workbook.prototype,"isFocus",{value:!1,writable:!0}),Object.defineProperty(Workbook.prototype,"clipBoard",{value:[],writable:!0,enumerable:!0}),Object.defineProperty(Workbook.prototype,"clipBoardTxt",{value:"",writable:!0}),Object.defineProperty(Workbook.prototype,"cellBtnWidth",{value:10}),Object.defineProperty(Workbook.prototype,"cellBtnHeight",{value:10}),Object.defineProperty(Workbook.prototype,"cellBtnAreaWidth",{value:13}),Object.defineProperty(Workbook.prototype,"isStopPainted",{get:function(){return 0!=this.workbook.stopPaintedCount}}),Object.defineProperty(Workbook.prototype,"btnBorderColor",{value:"#C5C1AA",writable:!0}),Object.defineProperty(Workbook.prototype,"enterToRight",{value:!1,writable:!0}),Object.defineProperty(Workbook.prototype,"btnFillColor",{value:"#F0F0F0",writable:!0}),Object.defineProperty(Workbook.prototype,"btnBorderColorH",{value:"rgba(30,144,255,.4)",writable:!0}),Object.defineProperty(Workbook.prototype,"btnFillColorH",{value:"rgba(240,248,255)",writable:!0}),Object.defineProperty(Workbook.prototype,"newSheetRow",{value:8,writable:!0}),Object.defineProperty(Workbook.prototype,"newSheetCol",{value:8,writable:!0}),Object.defineProperty(Workbook.prototype,"dpi",{value:96,writable:!0}),Object.defineProperty(Workbook.prototype,"widthDiff",{get:function(){return window.screen.width-this.workbook.devScreenWidth}}),Object.defineProperty(Workbook.prototype,"heightDiff",{get:function(){return window.screen.height-this.workbook.devScreenHeight}}),Object.defineProperty(Workbook.prototype,"width",{get:function(){return this.workbook.width}}),Object.defineProperty(Workbook.prototype,"height",{get:function(){return this.workbook.height}});